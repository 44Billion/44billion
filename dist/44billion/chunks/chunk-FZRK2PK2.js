import{A as qn,C as Mn,D as zn,F as ne,G as Qe,H as Ht,I as Kt,K as Dn,L as ve,M as Hn,b as Zi,d as T,e as F,f as zt,g as J,h as Tt,i as Ge,j as Ye,l as Je,o as ft,p as Dt,q as ge,r as xe,t as ee,w as V,x as be,y as Nn,z as It}from"./chunk-6C3T4FJN.js";var bt,Vt,ye,Kn,ie=class{constructor(){F(this,ye);F(this,bt,new Map);F(this,Vt,new FinalizationRegistry(J(this,ye,Kn).bind(this)))}set(t,n){if(this.get(t)===n)return this;let i=new WeakRef(n);return T(this,Vt).unregister(i),T(this,bt).set(t,i),T(this,Vt).register(n,t,i),this}get(t){return T(this,bt).get(t)?.deref?.()}delete(t){let n=T(this,bt).get(t);return n?(T(this,Vt).unregister(n),T(this,bt).delete(t),!0):!1}has(t){return this.get(t)!==void 0}get[Symbol.toStringTag](){return"WeakValueMap"}};bt=new WeakMap,Vt=new WeakMap,ye=new WeakSet,Kn=function(t){T(this,bt).delete(t)};function Gi(e){return/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)}function Wt(e=localStorage,t,{shouldUseStrictKeys:n=!1,shouldReplaceInvalidValues:i=!1}={}){let o=Dt({},{shouldCache:!1,isStatic:!1}),s=Ge(()=>({})),a=xe("useWebStorage_signalByKeyMap",()=>new ie,{shouldCache:!1}),r=Ge(()=>{function c(d){return{get(p,u,h){return u!=="set"?Reflect.get(p,u,h):function(...g){let f=Reflect.get(p,u,h)(...g);return f===void 0?e.removeItem(d.slice(0,-1)):e.setItem(d.slice(0,-1),JSON.stringify(f)),f}},apply(p,u,h){if(!h.length)return Reflect.apply(p,u,h);let g=Reflect.apply(p,u,h);return g===void 0?e.removeItem(d.slice(0,-1)):e.setItem(d.slice(0,-1),JSON.stringify(g)),g}}}let l={set(d,p,u,h){try{if(!p.endsWith("$"))throw new Error('(useWebStorage) Append a "$" to the original storage key');if(n&&!Gi(p))throw new Error("(useWebStorage) Key name failed /^[a-zA-Z_$][a-zA-Z0-9_$]*$/ test");let g,f=p.slice(0,-1),m=Object.prototype.hasOwnProperty.call(e,f);return m&&(()=>{try{return g=JSON.parse(e.getItem(f)),!0}catch(x){if(console.log(x),i)return!1;throw new Error(`(useWebStorage) Can't JSON.parse value ${e.getItem(f)} stored at key ${p}`)}})()?Object.prototype.hasOwnProperty.call(d,p)?g:Reflect.set(d,p,Je([function(){return g}].map(x=>(x.strategy="signal")&&x)[0]),h):(typeof u=="function"&&(u=u()),Reflect.set(d,p,Je([function(){return u}].map(x=>(x.strategy="signal")&&x)[0]),h)?(u===void 0?m&&e.removeItem(f):e.setItem(f,JSON.stringify(u)),!0):!1)}catch(g){return console.error(g),!1}},get(d,p,u){return Object.prototype.hasOwnProperty.call(d,p)?s[p]??=a().get(p)??a().set(p,new Proxy(Reflect.get(d,p,u),c(p))).get(p):Reflect.set(u,p,void 0,u)?u[p]:void 0}};return new Proxy(o,l)});return V(()=>{t&&Object.entries(typeof t=="function"?t():t).forEach(([c,l])=>{r[c]=l})}),V(({cleanup:c})=>{let l;function d(p){if(p.storageArea!==e)return;let{key:u}=p,h=`${u}$`;if(u===null)return Object.keys(r).filter(g=>g.endsWith("$")).forEach(g=>r[g](void 0));Object.prototype.hasOwnProperty.call(r,h)&&r[h](p.newValue===null?void 0:JSON.parse(p.newValue))}window.addEventListener("storage",d,{signal:(l=new AbortController).signal}),c(()=>l.abort())}),r}function vt(e=localStorage,t,n){let i=e.getItem(t),o;n===void 0?(e.removeItem(t),o=null):(o=JSON.stringify(n),e.setItem(t,o));let s=new StorageEvent("storage",{key:t,oldValue:i,newValue:o,storageArea:e,url:window.location.href});return window.dispatchEvent(s),n}function Vn(e){if(e instanceof Error)return e;let t=new Error(e.message);return t.name=e.name||"Error",t.stack=e.stack,Object.assign(t,e.context||{}),t}var Wn=!1,Yi=Wn?"http://":"https://",Ji=Wn?"localhost:10000":"44billion.net",Zs=`${Yi}${Ji}`;var oe={};function Qi(){return Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)}function Xi(e,t,n=5e3){if(!e||!t)throw new Error("Missing request id or code");let{promise:i,resolve:o,reject:s}=Promise.withResolvers();oe[e]={resolve:o,reject:s};let a;return n!=null&&(n>0?a=setTimeout(()=>{oe[e]?.reject?.(`Timeout for ${t} reqId: ${e}`)},n):oe[e]?.reject?.(`Timeout for ${t} reqId: ${e}`)),i.finally(()=>{clearTimeout(a),delete oe[e]})}function to(e){let t=oe[e.data.reqId];if(!t){console.log(`Unhandled response for reqId ${e.data.reqId} (may have timed out)`,JSON.stringify(e.data));return}e.data.error?t.reject(Vn(e.data.error)):t.resolve({payload:e.data.payload,isLast:e.data.isLast??!0,ports:e.ports})}var eo=((e,t=new WeakMap,n=new FinalizationRegistry(i=>i.abort()))=>i=>{let o=i instanceof MessagePort;if(e=o?i:globalThis,t.has(e))return;let s=new AbortController;t.set(e,s),e.addEventListener("message",async a=>{if(a.data.code==="REPLY")return to(a)},{signal:s.signal}),o&&e.start(),n.register(e,s)})();async function Xe(e,t,n,i){if(!t.code&&!("payload"in t))throw new Error("Missing args");(!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),eo(e);let o=Qi(),s=Xi(o,t.code,n.timeout);return e.postMessage({...t,reqId:o},n),s.then(({payload:a,ports:r})=>({code:t.code,payload:a,ports:r})).catch(a=>({code:t.code,payload:null,error:a}))}function Q(e,t,n,i){if(!("payload"in t)&&!("error"in t))throw new Error("Missing args");if((!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),n.targetOrigin??=e.origin,!n.to&&!e.source)throw new Error("Set port to options.to");n.to??=e.source,n.to.postMessage({...t,reqId:e.data.reqId,code:"REPLY"},n)}function jt(e,t,n,i){if(!t.code||!("payload"in t)&&!("error"in t))throw new Error("Missing args");(!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),e.postMessage(t,n)}var no=(e=>async()=>e??=await io())(),io=()=>{let e=Promise.withResolvers(),t=indexedDB.open("44billion_browser",1);return t.onerror=()=>e.reject(t.error),t.onsuccess=()=>{let n=t.result;n.onversionchange=()=>{n.close(),location.reload(!0)},n.onerror=()=>{console.log(`[${n.name}DB v${n.version}] IndexedDB error. Code: ${t.errorCode} - ${t.error.stack}`)},e.resolve(n)},t.onupgradeneeded=n=>{let i=n.target.result,o=n.target.transaction,s;i.objectStoreNames.contains("fileChunks")?s=o.objectStore("fileChunks"):s=i.createObjectStore("fileChunks",{keyPath:["appId","fx","pos"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("bundles")?s=o.objectStore("bundles"):s=i.createObjectStore("bundles",{keyPath:["c","p","d"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("permissions")?s=o.objectStore("permissions"):s=i.createObjectStore("permissions",{keyPath:["appId","name","eKind"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`)},e.promise};async function pt(e,t=[],n,i,{p:o=Promise.withResolvers(),tx:s,txMode:a=s?.mode,storeOrIndex:r}={}){if(!s){let l=await no();a??=["get","getKey","count"].includes(e)?"readonly":"readwrite",s=l.transaction([n],a)}if(!r){let l=s.objectStore(n);r=i?l.index(i):l}let c=r[e](...t);return c.onsuccess=()=>{o.resolve({result:c.result,tx:s,storeOrIndex:r})},c.onerror=()=>{o.reject(c.error),s.abort()},o.promise}async function we(e,t){let n=null;for await(let o of mt(e,t)){let s=o.evt.tags.find(r=>r[0]==="c"&&r[1].startsWith(`${t}:`));if(!s)continue;let a=parseInt(s[2]);if(!Number.isNaN(a)&&a>0){n=a;break}}if(!n)return{count:0,total:n};let i=IDBKeyRange.bound([e,t,-1/0],[e,t,1/0]);return pt("count",[i],"fileChunks").then(o=>({count:o.result,total:n}))}async function ke(e,t){if(!e)throw new Error("Missing bundle id");let n=IDBKeyRange.bound([e,t??"\0",-1/0],[e,t??"\uFFFF",1/0]);return pt("delete",[n],"fileChunks").then(i=>i.result)}async function Fn(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let s=n!==void 0?n:-1/0,a=i!==void 0?i:1/0,r=IDBKeyRange.bound([e,t,s],[e,t,a]);return pt(o?"getAllKeys":"getAll",[r],"fileChunks").then(c=>c.result)}async function*mt(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let s=n!==void 0?n:-1/0,a=i!==void 0?i:1/0,r=IDBKeyRange.bound([e,t,s],[e,t,a]),c=Promise.withResolvers();await pt(o?"openKeyCursor":"openCursor",[r],"fileChunks",null,{p:c});let l=o?"key":"value",d;for(;d=(await c.promise).result;)yield d[l],Object.assign(c,Promise.withResolvers()),d.continue()}async function Zn(e,t,n){let i=e.tags.filter(s=>s[0]==="file"&&!!s[1]).map(s=>s[1]).reduce((s,a)=>({...s,[a]:!0}),{}),o;for(let s of t){if(s.kind!==34600)throw new Error("Wrong chunk kind");let a,r=[];for(let c of s.tags)if(c[0]==="d"&&(a=c),c[0]==="c"){let[l,d]=c[1].split(":");d!==void 0&&i[l]&&r.push([l,parseInt(d)])}n??=Ht({kind:e.kind,pubkey:e.pubkey,dTag:e.tags.find(c=>c[0]==="d")[1]});for(let[c,l]of r){let d={appId:n,x:a[1],fx:c,pos:l,evt:s};o=await pt("put",[d],"fileChunks",null,o)}}}function Gn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function tn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Yn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gn(e.outputLen),Gn(e.blockLen)}function Ft(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Jn(e,t){tn(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ee=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Qn=e=>e instanceof Uint8Array;var _e=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),at=(e,t)=>e<<32-t|e>>>t,oo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!oo)throw new Error("Non little-endian hardware is not supported");function so(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function se(e){if(typeof e=="string"&&(e=so(e)),!Qn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Xn(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!Qn(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}var Zt=class{clone(){return this._cloneInto()}},ia={}.toString;function ti(e){let t=i=>e().update(se(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Be(e=32){if(Ee&&typeof Ee.getRandomValues=="function")return Ee.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ao(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),s=BigInt(4294967295),a=Number(n>>o&s),r=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,a,i),e.setUint32(t+l,r,i)}var $e=class extends Zt{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=_e(this.buffer)}update(t){Ft(this);let{view:n,buffer:i,blockLen:o}=this;t=se(t);let s=t.length;for(let a=0;a<s;){let r=Math.min(o-this.pos,s-a);if(r===o){let c=_e(t);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(t.subarray(a,a+r),this.pos),this.pos+=r,a+=r,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ft(this),Jn(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:s}=this,{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let p=a;p<o;p++)n[p]=0;ao(i,o-8,BigInt(this.length*8),s),this.process(i,0);let r=_e(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)r.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:s,destroyed:a,pos:r}=this;return t.length=o,t.pos=r,t.finished=s,t.destroyed=a,o%n&&t.buffer.set(i),t}};var ro=(e,t,n)=>e&t^~e&n,co=(e,t,n)=>e&t^e&n^t&n,lo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=new Uint32Array(64),en=class extends $e{constructor(){super(64,32,8,!1),this.A=yt[0]|0,this.B=yt[1]|0,this.C=yt[2]|0,this.D=yt[3]|0,this.E=yt[4]|0,this.F=yt[5]|0,this.G=yt[6]|0,this.H=yt[7]|0}get(){let{A:t,B:n,C:i,D:o,E:s,F:a,G:r,H:c}=this;return[t,n,i,o,s,a,r,c]}set(t,n,i,o,s,a,r,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=r|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)wt[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let u=wt[p-15],h=wt[p-2],g=at(u,7)^at(u,18)^u>>>3,f=at(h,17)^at(h,19)^h>>>10;wt[p]=f+wt[p-7]+g+wt[p-16]|0}let{A:i,B:o,C:s,D:a,E:r,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let u=at(r,6)^at(r,11)^at(r,25),h=d+u+ro(r,c,l)+lo[p]+wt[p]|0,f=(at(i,2)^at(i,13)^at(i,22))+co(i,o,s)|0;d=l,l=c,c=r,r=a+h|0,a=s,s=o,o=i,i=h+f|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,r=r+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,s,a,r,c,l,d)}roundClean(){wt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Se=ti(()=>new en);var an={};Zi(an,{bitGet:()=>xo,bitLen:()=>go,bitMask:()=>ae,bitSet:()=>bo,bytesToHex:()=>Ct,bytesToNumberBE:()=>W,bytesToNumberLE:()=>Ie,concatBytes:()=>ht,createHmacDrbg:()=>sn,ensureBytes:()=>z,equalBytes:()=>mo,hexToBytes:()=>Ot,hexToNumber:()=>on,numberToBytesBE:()=>rt,numberToBytesLE:()=>je,numberToHexUnpadded:()=>ii,numberToVarBytesBE:()=>fo,utf8ToBytes:()=>ho,validateObject:()=>kt});var ni=BigInt(0),Ae=BigInt(1),po=BigInt(2),Te=e=>e instanceof Uint8Array,uo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ct(e){if(!Te(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=uo[e[n]];return t}function ii(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function on(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ot(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let i=0;i<n.length;i++){let o=i*2,s=e.slice(o,o+2),a=Number.parseInt(s,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");n[i]=a}return n}function W(e){return on(Ct(e))}function Ie(e){if(!Te(e))throw new Error("Uint8Array expected");return on(Ct(Uint8Array.from(e).reverse()))}function rt(e,t){return Ot(e.toString(16).padStart(t*2,"0"))}function je(e,t){return rt(e,t).reverse()}function fo(e){return Ot(ii(e))}function z(e,t,n){let i;if(typeof t=="string")try{i=Ot(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Te(t))i=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=i.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return i}function ht(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!Te(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}function mo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ho(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function go(e){let t;for(t=0;e>ni;e>>=Ae,t+=1);return t}function xo(e,t){return e>>BigInt(t)&Ae}var bo=(e,t,n)=>e|(n?Ae:ni)<<BigInt(t),ae=e=>(po<<BigInt(e-1))-Ae,nn=e=>new Uint8Array(e),ei=e=>Uint8Array.from(e);function sn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=nn(e),o=nn(e),s=0,a=()=>{i.fill(1),o.fill(0),s=0},r=(...p)=>n(o,i,...p),c=(p=nn())=>{o=r(ei([0]),p),i=r(),p.length!==0&&(o=r(ei([1]),p),i=r())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,u=[];for(;p<t;){i=r();let h=i.slice();u.push(h),p+=i.length}return ht(...u)};return(p,u)=>{a(),c(p);let h;for(;!(h=u(l()));)c();return a(),h}}var vo={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function kt(e,t,n={}){let i=(o,s,a)=>{let r=vo[s];if(typeof r!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=e[o];if(!(a&&c===void 0)&&!r(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(let[o,s]of Object.entries(t))i(o,s,!1);for(let[o,s]of Object.entries(n))i(o,s,!0);return e}var H=BigInt(0),U=BigInt(1),Rt=BigInt(2),yo=BigInt(3),rn=BigInt(4),oi=BigInt(5),si=BigInt(8),wo=BigInt(9),ko=BigInt(16);function D(e,t){let n=e%t;return n>=H?n:t+n}function Eo(e,t,n){if(n<=H||t<H)throw new Error("Expected power/modulo > 0");if(n===U)return H;let i=U;for(;t>H;)t&U&&(i=i*e%n),e=e*e%n,t>>=U;return i}function X(e,t,n){let i=e;for(;t-- >H;)i*=i,i%=n;return i}function Ce(e,t){if(e===H||t<=H)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=D(e,t),i=t,o=H,s=U,a=U,r=H;for(;n!==H;){let l=i/n,d=i%n,p=o-a*l,u=s-r*l;i=n,n=d,o=a,s=r,a=p,r=u}if(i!==U)throw new Error("invert: does not exist");return D(o,t)}function _o(e){let t=(e-U)/Rt,n,i,o;for(n=e-U,i=0;n%Rt===H;n/=Rt,i++);for(o=Rt;o<e&&Eo(o,t,e)!==e-U;o++);if(i===1){let a=(e+U)/rn;return function(c,l){let d=c.pow(l,a);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}let s=(n+U)/Rt;return function(r,c){if(r.pow(c,t)===r.neg(r.ONE))throw new Error("Cannot find square root");let l=i,d=r.pow(r.mul(r.ONE,o),n),p=r.pow(c,s),u=r.pow(c,n);for(;!r.eql(u,r.ONE);){if(r.eql(u,r.ZERO))return r.ZERO;let h=1;for(let f=r.sqr(u);h<l&&!r.eql(f,r.ONE);h++)f=r.sqr(f);let g=r.pow(d,U<<BigInt(l-h-1));d=r.sqr(g),p=r.mul(p,g),u=r.mul(u,d),l=h}return p}}function Bo(e){if(e%rn===yo){let t=(e+U)/rn;return function(i,o){let s=i.pow(o,t);if(!i.eql(i.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%si===oi){let t=(e-oi)/si;return function(i,o){let s=i.mul(o,Rt),a=i.pow(s,t),r=i.mul(o,a),c=i.mul(i.mul(r,Rt),a),l=i.mul(r,i.sub(c,i.ONE));if(!i.eql(i.sqr(l),o))throw new Error("Cannot find square root");return l}}return e%ko,_o(e)}var $o=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=$o.reduce((i,o)=>(i[o]="function",i),t);return kt(e,n)}function So(e,t,n){if(n<H)throw new Error("Expected power > 0");if(n===H)return e.ONE;if(n===U)return t;let i=e.ONE,o=t;for(;n>H;)n&U&&(i=e.mul(i,o)),o=e.sqr(o),n>>=U;return i}function Ao(e,t){let n=new Array(t.length),i=t.reduce((s,a,r)=>e.is0(a)?s:(n[r]=s,e.mul(s,a)),e.ONE),o=e.inv(i);return t.reduceRight((s,a,r)=>e.is0(a)?s:(n[r]=e.mul(s,n[r]),e.mul(s,a)),o),n}function ln(e,t){let n=t!==void 0?t:e.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function ai(e,t,n=!1,i={}){if(e<=H)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:s}=ln(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let a=Bo(e),r=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:ae(o),ZERO:H,ONE:U,create:c=>D(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return H<=c&&c<e},is0:c=>c===H,isOdd:c=>(c&U)===U,neg:c=>D(-c,e),eql:(c,l)=>c===l,sqr:c=>D(c*c,e),add:(c,l)=>D(c+l,e),sub:(c,l)=>D(c-l,e),mul:(c,l)=>D(c*l,e),pow:(c,l)=>So(r,c,l),div:(c,l)=>D(c*Ce(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ce(c,e),sqrt:i.sqrt||(c=>a(r,c)),invertBatch:c=>Ao(r,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>n?je(c,s):rt(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?Ie(c):W(c)}});return Object.freeze(r)}function ri(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function pn(e){let t=ri(e);return t+Math.ceil(t/2)}function ci(e,t,n=!1){let i=e.length,o=ri(t),s=pn(t);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);let a=n?W(e):Ie(e),r=D(a,t-U)+U;return n?je(r,o):rt(r,o)}var Io=BigInt(0),dn=BigInt(1);function li(e,t){let n=(o,s)=>{let a=s.negate();return o?a:s},i=o=>{let s=Math.ceil(t/o)+1,a=2**(o-1);return{windows:s,windowSize:a}};return{constTimeNegate:n,unsafeLadder(o,s){let a=e.ZERO,r=o;for(;s>Io;)s&dn&&(a=a.add(r)),r=r.double(),s>>=dn;return a},precomputeWindow(o,s){let{windows:a,windowSize:r}=i(s),c=[],l=o,d=l;for(let p=0;p<a;p++){d=l,c.push(d);for(let u=1;u<r;u++)d=d.add(l),c.push(d);l=d.double()}return c},wNAF(o,s,a){let{windows:r,windowSize:c}=i(o),l=e.ZERO,d=e.BASE,p=BigInt(2**o-1),u=2**o,h=BigInt(o);for(let g=0;g<r;g++){let f=g*c,m=Number(a&p);a>>=h,m>c&&(m-=u,a+=dn);let x=f,E=f+Math.abs(m)-1,k=g%2!==0,$=m<0;m===0?d=d.add(n(k,s[x])):l=l.add(n($,s[E]))}return{p:l,f:d}},wNAFCached(o,s,a,r){let c=o._WINDOW_SIZE||1,l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,r(l))),this.wNAF(c,l,a)}}}function un(e){return cn(e.Fp),kt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ln(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function jo(e){let t=un(e);kt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:i,a:o}=t;if(n){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Co,hexToBytes:Oo}=an,Pt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=Pt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],i=e.subarray(2,n+2);if(!n||i.length!==n)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Co(i),l:e.subarray(n+2)}},toSig(e){let{Err:t}=Pt,n=typeof e=="string"?Oo(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let i=n.length;if(i<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==i-2)throw new t("Invalid signature: incorrect length");let{d:o,l:s}=Pt._parseInt(n.subarray(2)),{d:a,l:r}=Pt._parseInt(s);if(r.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(e){let t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let d=l.toString(16);return d.length&1?`0${d}`:d},i=t(n(e.s)),o=t(n(e.r)),s=i.length/2,a=o.length/2,r=n(s),c=n(a);return`30${n(a+s+4)}02${c}${o}02${r}${i}`}},gt=BigInt(0),et=BigInt(1),ba=BigInt(2),pi=BigInt(3),va=BigInt(4);function Ro(e){let t=jo(e),{Fp:n}=t,i=t.toBytes||((g,f,m)=>{let x=f.toAffine();return ht(Uint8Array.from([4]),n.toBytes(x.x),n.toBytes(x.y))}),o=t.fromBytes||(g=>{let f=g.subarray(1),m=n.fromBytes(f.subarray(0,n.BYTES)),x=n.fromBytes(f.subarray(n.BYTES,2*n.BYTES));return{x:m,y:x}});function s(g){let{a:f,b:m}=t,x=n.sqr(g),E=n.mul(x,g);return n.add(n.add(E,n.mul(g,f)),m)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return typeof g=="bigint"&&gt<g&&g<t.n}function r(g){if(!a(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(g){let{allowedPrivateKeyLengths:f,nByteLength:m,wrapPrivateKey:x,n:E}=t;if(f&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Ct(g)),typeof g!="string"||!f.includes(g.length))throw new Error("Invalid key");g=g.padStart(m*2,"0")}let k;try{k=typeof g=="bigint"?g:W(z("private key",g,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof g}`)}return x&&(k=D(k,E)),r(k),k}let l=new Map;function d(g){if(!(g instanceof p))throw new Error("ProjectivePoint expected")}class p{constructor(f,m,x){if(this.px=f,this.py=m,this.pz=x,f==null||!n.isValid(f))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(x==null||!n.isValid(x))throw new Error("z required")}static fromAffine(f){let{x:m,y:x}=f||{};if(!f||!n.isValid(m)||!n.isValid(x))throw new Error("invalid affine point");if(f instanceof p)throw new Error("projective point not allowed");let E=k=>n.eql(k,n.ZERO);return E(m)&&E(x)?p.ZERO:new p(m,x,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){let m=n.invertBatch(f.map(x=>x.pz));return f.map((x,E)=>x.toAffine(m[E])).map(p.fromAffine)}static fromHex(f){let m=p.fromAffine(o(z("pointHex",f)));return m.assertValidity(),m}static fromPrivateKey(f){return p.BASE.multiply(c(f))}_setWindowSize(f){this._WINDOW_SIZE=f,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:f,y:m}=this.toAffine();if(!n.isValid(f)||!n.isValid(m))throw new Error("bad point: x or y not FE");let x=n.sqr(m),E=s(f);if(!n.eql(x,E))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:f}=this.toAffine();if(n.isOdd)return!n.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){d(f);let{px:m,py:x,pz:E}=this,{px:k,py:$,pz:j}=f,_=n.eql(n.mul(m,j),n.mul(k,E)),A=n.eql(n.mul(x,j),n.mul($,E));return _&&A}negate(){return new p(this.px,n.neg(this.py),this.pz)}double(){let{a:f,b:m}=t,x=n.mul(m,pi),{px:E,py:k,pz:$}=this,j=n.ZERO,_=n.ZERO,A=n.ZERO,C=n.mul(E,E),G=n.mul(k,k),P=n.mul($,$),R=n.mul(E,k);return R=n.add(R,R),A=n.mul(E,$),A=n.add(A,A),j=n.mul(f,A),_=n.mul(x,P),_=n.add(j,_),j=n.sub(G,_),_=n.add(G,_),_=n.mul(j,_),j=n.mul(R,j),A=n.mul(x,A),P=n.mul(f,P),R=n.sub(C,P),R=n.mul(f,R),R=n.add(R,A),A=n.add(C,C),C=n.add(A,C),C=n.add(C,P),C=n.mul(C,R),_=n.add(_,C),P=n.mul(k,$),P=n.add(P,P),C=n.mul(P,R),j=n.sub(j,C),A=n.mul(P,G),A=n.add(A,A),A=n.add(A,A),new p(j,_,A)}add(f){d(f);let{px:m,py:x,pz:E}=this,{px:k,py:$,pz:j}=f,_=n.ZERO,A=n.ZERO,C=n.ZERO,G=t.a,P=n.mul(t.b,pi),R=n.mul(m,k),K=n.mul(x,$),Z=n.mul(E,j),S=n.add(m,x),v=n.add(k,$);S=n.mul(S,v),v=n.add(R,K),S=n.sub(S,v),v=n.add(m,E);let b=n.add(k,j);return v=n.mul(v,b),b=n.add(R,Z),v=n.sub(v,b),b=n.add(x,E),_=n.add($,j),b=n.mul(b,_),_=n.add(K,Z),b=n.sub(b,_),C=n.mul(G,v),_=n.mul(P,Z),C=n.add(_,C),_=n.sub(K,C),C=n.add(K,C),A=n.mul(_,C),K=n.add(R,R),K=n.add(K,R),Z=n.mul(G,Z),v=n.mul(P,v),K=n.add(K,Z),Z=n.sub(R,Z),Z=n.mul(G,Z),v=n.add(v,Z),R=n.mul(K,v),A=n.add(A,R),R=n.mul(b,v),_=n.mul(S,_),_=n.sub(_,R),R=n.mul(S,K),C=n.mul(b,C),C=n.add(C,R),new p(_,A,C)}subtract(f){return this.add(f.negate())}is0(){return this.equals(p.ZERO)}wNAF(f){return h.wNAFCached(this,l,f,m=>{let x=n.invertBatch(m.map(E=>E.pz));return m.map((E,k)=>E.toAffine(x[k])).map(p.fromAffine)})}multiplyUnsafe(f){let m=p.ZERO;if(f===gt)return m;if(r(f),f===et)return this;let{endo:x}=t;if(!x)return h.unsafeLadder(this,f);let{k1neg:E,k1:k,k2neg:$,k2:j}=x.splitScalar(f),_=m,A=m,C=this;for(;k>gt||j>gt;)k&et&&(_=_.add(C)),j&et&&(A=A.add(C)),C=C.double(),k>>=et,j>>=et;return E&&(_=_.negate()),$&&(A=A.negate()),A=new p(n.mul(A.px,x.beta),A.py,A.pz),_.add(A)}multiply(f){r(f);let m=f,x,E,{endo:k}=t;if(k){let{k1neg:$,k1:j,k2neg:_,k2:A}=k.splitScalar(m),{p:C,f:G}=this.wNAF(j),{p:P,f:R}=this.wNAF(A);C=h.constTimeNegate($,C),P=h.constTimeNegate(_,P),P=new p(n.mul(P.px,k.beta),P.py,P.pz),x=C.add(P),E=G.add(R)}else{let{p:$,f:j}=this.wNAF(m);x=$,E=j}return p.normalizeZ([x,E])[0]}multiplyAndAddUnsafe(f,m,x){let E=p.BASE,k=(j,_)=>_===gt||_===et||!j.equals(E)?j.multiplyUnsafe(_):j.multiply(_),$=k(this,m).add(k(f,x));return $.is0()?void 0:$}toAffine(f){let{px:m,py:x,pz:E}=this,k=this.is0();f==null&&(f=k?n.ONE:n.inv(E));let $=n.mul(m,f),j=n.mul(x,f),_=n.mul(E,f);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:$,y:j}}isTorsionFree(){let{h:f,isTorsionFree:m}=t;if(f===et)return!0;if(m)return m(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:f,clearCofactor:m}=t;return f===et?this:m?m(p,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return this.assertValidity(),i(p,this,f)}toHex(f=!0){return Ct(this.toRawBytes(f))}}p.BASE=new p(t.Gx,t.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);let u=t.nBitLength,h=li(p,t.endo?Math.ceil(u/2):u);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function Po(e){let t=un(e);return kt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function di(e){let t=Po(e),{Fp:n,n:i}=t,o=n.BYTES+1,s=2*n.BYTES+1;function a(v){return gt<v&&v<n.ORDER}function r(v){return D(v,i)}function c(v){return Ce(v,i)}let{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:p,isWithinCurveOrder:u}=Ro({...t,toBytes(v,b,y){let w=b.toAffine(),B=n.toBytes(w.x),O=ht;return y?O(Uint8Array.from([b.hasEvenY()?2:3]),B):O(Uint8Array.from([4]),B,n.toBytes(w.y))},fromBytes(v){let b=v.length,y=v[0],w=v.subarray(1);if(b===o&&(y===2||y===3)){let B=W(w);if(!a(B))throw new Error("Point is not on curve");let O=p(B),I=n.sqrt(O),L=(I&et)===et;return(y&1)===1!==L&&(I=n.neg(I)),{x:B,y:I}}else if(b===s&&y===4){let B=n.fromBytes(w.subarray(0,n.BYTES)),O=n.fromBytes(w.subarray(n.BYTES,2*n.BYTES));return{x:B,y:O}}else throw new Error(`Point of length ${b} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),h=v=>Ct(rt(v,t.nByteLength));function g(v){let b=i>>et;return v>b}function f(v){return g(v)?r(-v):v}let m=(v,b,y)=>W(v.slice(b,y));class x{constructor(b,y,w){this.r=b,this.s=y,this.recovery=w,this.assertValidity()}static fromCompact(b){let y=t.nByteLength;return b=z("compactSignature",b,y*2),new x(m(b,0,y),m(b,y,2*y))}static fromDER(b){let{r:y,s:w}=Pt.toSig(z("DER",b));return new x(y,w)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new x(this.r,this.s,b)}recoverPublicKey(b){let{r:y,s:w,recovery:B}=this,O=A(z("msgHash",b));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");let I=B===2||B===3?y+t.n:y;if(I>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let L=(B&1)===0?"02":"03",q=l.fromHex(L+h(I)),M=c(I),tt=r(-O*M),At=r(w*M),Y=l.BASE.multiplyAndAddUnsafe(q,tt,At);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new x(this.r,r(-this.s),this.recovery):this}toDERRawBytes(){return Ot(this.toDERHex())}toDERHex(){return Pt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ot(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}let E={isValidPrivateKey(v){try{return d(v),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{let v=pn(t.n);return ci(t.randomBytes(v),t.n)},precompute(v=8,b=l.BASE){return b._setWindowSize(v),b.multiply(BigInt(3)),b}};function k(v,b=!0){return l.fromPrivateKey(v).toRawBytes(b)}function $(v){let b=v instanceof Uint8Array,y=typeof v=="string",w=(b||y)&&v.length;return b?w===o||w===s:y?w===2*o||w===2*s:v instanceof l}function j(v,b,y=!0){if($(v))throw new Error("first arg must be private key");if(!$(b))throw new Error("second arg must be public key");return l.fromHex(b).multiply(d(v)).toRawBytes(y)}let _=t.bits2int||function(v){let b=W(v),y=v.length*8-t.nBitLength;return y>0?b>>BigInt(y):b},A=t.bits2int_modN||function(v){return r(_(v))},C=ae(t.nBitLength);function G(v){if(typeof v!="bigint")throw new Error("bigint expected");if(!(gt<=v&&v<C))throw new Error(`bigint expected < 2^${t.nBitLength}`);return rt(v,t.nByteLength)}function P(v,b,y=R){if(["recovered","canonical"].some(lt=>lt in y))throw new Error("sign() legacy options not supported");let{hash:w,randomBytes:B}=t,{lowS:O,prehash:I,extraEntropy:L}=y;O==null&&(O=!0),v=z("msgHash",v),I&&(v=z("prehashed msgHash",w(v)));let q=A(v),M=d(b),tt=[G(M),G(q)];if(L!=null){let lt=L===!0?B(n.BYTES):L;tt.push(z("extraEntropy",lt))}let At=ht(...tt),Y=q;function qt(lt){let ut=_(lt);if(!u(ut))return;let me=c(ut),N=l.BASE.multiply(ut).toAffine(),ot=r(N.x);if(ot===gt)return;let st=r(me*r(Y+ot*M));if(st===gt)return;let he=(N.x===ot?0:2)|Number(N.y&et),Mt=st;return O&&g(st)&&(Mt=f(st),he^=1),new x(ot,Mt,he)}return{seed:At,k2sig:qt}}let R={lowS:t.lowS,prehash:!1},K={lowS:t.lowS,prehash:!1};function Z(v,b,y=R){let{seed:w,k2sig:B}=P(v,b,y),O=t;return sn(O.hash.outputLen,O.nByteLength,O.hmac)(w,B)}l.BASE._setWindowSize(8);function S(v,b,y,w=K){let B=v;if(b=z("msgHash",b),y=z("publicKey",y),"strict"in w)throw new Error("options.strict was renamed to lowS");let{lowS:O,prehash:I}=w,L,q;try{if(typeof B=="string"||B instanceof Uint8Array)try{L=x.fromDER(B)}catch(N){if(!(N instanceof Pt.Err))throw N;L=x.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){let{r:N,s:ot}=B;L=new x(N,ot)}else throw new Error("PARSE");q=l.fromHex(y)}catch(N){if(N.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(O&&L.hasHighS())return!1;I&&(b=t.hash(b));let{r:M,s:tt}=L,At=A(b),Y=c(tt),qt=r(At*Y),lt=r(M*Y),ut=l.BASE.multiplyAndAddUnsafe(q,qt,lt)?.toAffine();return ut?r(ut.x)===M:!1}return{CURVE:t,getPublicKey:k,getSharedSecret:j,sign:Z,verify:S,ProjectivePoint:l,Signature:x,utils:E}}var Oe=class extends Zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Yn(t);let i=se(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?t.create().update(i).digest():i);for(let a=0;a<s.length;a++)s[a]^=54;this.iHash.update(s),this.oHash=t.create();for(let a=0;a<s.length;a++)s[a]^=106;this.oHash.update(s),s.fill(0)}update(t){return Ft(this),this.iHash.update(t),this}digestInto(t){Ft(this),tn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:i,finished:o,destroyed:s,blockLen:a,outputLen:r}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=a,t.outputLen=r,t.oHash=n._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},fn=(e,t,n)=>new Oe(e,t).update(n).digest();fn.create=(e,t)=>new Oe(e,t);function Lo(e){return{hash:e,hmac:(t,...n)=>fn(e,t,Xn(...n)),randomBytes:Be}}function ui(e,t){let n=i=>di({...e,...Lo(i)});return Object.freeze({...n(t),create:n})}var Ue=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Re=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),hi=BigInt(1),Pe=BigInt(2),fi=(e,t)=>(e+t/Pe)/t;function gi(e){let t=Ue,n=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),a=BigInt(23),r=BigInt(44),c=BigInt(88),l=e*e*e%t,d=l*l*e%t,p=X(d,n,t)*d%t,u=X(p,n,t)*d%t,h=X(u,Pe,t)*l%t,g=X(h,o,t)*h%t,f=X(g,s,t)*g%t,m=X(f,r,t)*f%t,x=X(m,c,t)*m%t,E=X(x,r,t)*f%t,k=X(E,n,t)*d%t,$=X(k,a,t)*g%t,j=X($,i,t)*l%t,_=X(j,Pe,t);if(!hn.eql(hn.sqr(_),e))throw new Error("Cannot find square root");return _}var hn=ai(Ue,void 0,void 0,{sqrt:gi}),bn=ui({a:BigInt(0),b:BigInt(7),Fp:hn,n:Re,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=Re,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-hi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,a=BigInt("0x100000000000000000000000000000000"),r=fi(s*e,t),c=fi(-i*e,t),l=D(e-r*n-c*o,t),d=D(-r*i-c*s,t),p=l>a,u=d>a;if(p&&(l=t-l),u&&(d=t-d),l>a||d>a)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:p,k1:l,k2neg:u,k2:d}}}},Se),Ne=BigInt(0),xi=e=>typeof e=="bigint"&&Ne<e&&e<Ue,Uo=e=>typeof e=="bigint"&&Ne<e&&e<Re,mi={};function Le(e,...t){let n=mi[e];if(n===void 0){let i=Se(Uint8Array.from(e,o=>o.charCodeAt(0)));n=ht(i,i),mi[e]=n}return Se(ht(n,...t))}var vn=e=>e.toRawBytes(!0).slice(1),gn=e=>rt(e,32),mn=e=>D(e,Ue),re=e=>D(e,Re),yn=bn.ProjectivePoint,No=(e,t,n)=>yn.BASE.multiplyAndAddUnsafe(e,t,n);function xn(e){let t=bn.utils.normPrivateKeyToScalar(e),n=yn.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:re(-t),bytes:vn(n)}}function bi(e){if(!xi(e))throw new Error("bad x: need 0 < x < p");let t=mn(e*e),n=mn(t*e+BigInt(7)),i=gi(n);i%Pe!==Ne&&(i=mn(-i));let o=new yn(e,i,hi);return o.assertValidity(),o}function vi(...e){return re(W(Le("BIP0340/challenge",...e)))}function qo(e){return xn(e).bytes}function Mo(e,t,n=Be(32)){let i=z("message",e),{bytes:o,scalar:s}=xn(t),a=z("auxRand",n,32),r=gn(s^W(Le("BIP0340/aux",a))),c=Le("BIP0340/nonce",r,o,i),l=re(W(c));if(l===Ne)throw new Error("sign failed: k is zero");let{bytes:d,scalar:p}=xn(l),u=vi(d,o,i),h=new Uint8Array(64);if(h.set(d,0),h.set(gn(re(p+u*s)),32),!yi(h,i,o))throw new Error("sign: Invalid signature produced");return h}function yi(e,t,n){let i=z("signature",e,64),o=z("message",t),s=z("publicKey",n,32);try{let a=bi(W(s)),r=W(i.subarray(0,32));if(!xi(r))return!1;let c=W(i.subarray(32,64));if(!Uo(c))return!1;let l=vi(gn(r),vn(a),o),d=No(a,c,re(-l));return!(!d||!d.hasEvenY()||d.toAffine().x!==r)}catch{return!1}}var Gt={getPublicKey:qo,sign:Mo,verify:yi,utils:{randomPrivateKey:bn.utils.randomPrivateKey,lift_x:bi,pointToBytes:vn,numberToBytesBE:rt,bytesToNumberBE:W,taggedHash:Le,mod:D}};var zo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var wi=e=>e instanceof Uint8Array;var Me=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ct=(e,t)=>e<<32-t|e>>>t,Do=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Do)throw new Error("Non little-endian hardware is not supported");var Ho=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ce(e){if(!wi(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ho[e[n]];return t}function Ko(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function wn(e){if(typeof e=="string"&&(e=Ko(e)),!wi(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var qe=class{clone(){return this._cloneInto()}};function kn(e){let t=i=>e().update(wn(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function En(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Vo(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function ki(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Wo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");En(e.outputLen),En(e.blockLen)}function Fo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Zo(e,t){ki(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Go={number:En,bool:Vo,bytes:ki,hash:Wo,exists:Fo,output:Zo},ze=Go;function Yo(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),s=BigInt(4294967295),a=Number(n>>o&s),r=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,a,i),e.setUint32(t+l,r,i)}var De=class extends qe{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Me(this.buffer)}update(t){ze.exists(this);let{view:n,buffer:i,blockLen:o}=this;t=wn(t);let s=t.length;for(let a=0;a<s;){let r=Math.min(o-this.pos,s-a);if(r===o){let c=Me(t);for(;o<=s-a;a+=o)this.process(c,a);continue}i.set(t.subarray(a,a+r),this.pos),this.pos+=r,a+=r,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ze.exists(this),ze.output(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:s}=this,{pos:a}=this;n[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>o-a&&(this.process(i,0),a=0);for(let p=a;p<o;p++)n[p]=0;Yo(i,o-8,BigInt(this.length*8),s),this.process(i,0);let r=Me(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)r.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:s,destroyed:a,pos:r}=this;return t.length=o,t.pos=r,t.finished=s,t.destroyed=a,o%n&&t.buffer.set(i),t}};var Jo=(e,t,n)=>e&t^~e&n,Qo=(e,t,n)=>e&t^e&n^t&n,Xo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Et=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_t=new Uint32Array(64),He=class extends De{constructor(){super(64,32,8,!1),this.A=Et[0]|0,this.B=Et[1]|0,this.C=Et[2]|0,this.D=Et[3]|0,this.E=Et[4]|0,this.F=Et[5]|0,this.G=Et[6]|0,this.H=Et[7]|0}get(){let{A:t,B:n,C:i,D:o,E:s,F:a,G:r,H:c}=this;return[t,n,i,o,s,a,r,c]}set(t,n,i,o,s,a,r,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=a|0,this.G=r|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)_t[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let u=_t[p-15],h=_t[p-2],g=ct(u,7)^ct(u,18)^u>>>3,f=ct(h,17)^ct(h,19)^h>>>10;_t[p]=f+_t[p-7]+g+_t[p-16]|0}let{A:i,B:o,C:s,D:a,E:r,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let u=ct(r,6)^ct(r,11)^ct(r,25),h=d+u+Jo(r,c,l)+Xo[p]+_t[p]|0,f=(ct(i,2)^ct(i,13)^ct(i,22))+Qo(i,o,s)|0;d=l,l=c,c=r,r=a+h|0,a=s,s=o,o=i,i=h+f|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,a=a+this.D|0,r=r+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,s,a,r,c,l,d)}roundClean(){_t.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},_n=class extends He{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Ei=kn(()=>new He),Ha=kn(()=>new _n);var Yt=Symbol("verified"),ts=e=>e instanceof Object;function es(e){if(!ts(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let i=0;i<n.length;i++)if(typeof n[i]!="string")return!1}return!0}var Ja=new TextDecoder("utf-8"),ns=new TextEncoder;function is(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var os=class{value;next=null;prev=null;constructor(e){this.value=e}},ss=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new os(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},as=class{generateSecretKey(){return Gt.utils.randomPrivateKey()}getPublicKey(e){return ce(Gt.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=ce(Gt.getPublicKey(t)),n.id=Bn(n),n.sig=ce(Gt.sign(Bn(n),t)),n[Yt]=!0,n}verifyEvent(e){if(typeof e[Yt]=="boolean")return e[Yt];let t=Bn(e);if(t!==e.id)return e[Yt]=!1,!1;try{let n=Gt.verify(e.sig,t,e.pubkey);return e[Yt]=n,n}catch{return e[Yt]=!1,!1}}};function rs(e){if(!es(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Bn(e){let t=Ei(ns.encode(rs(e)));return ce(t)}var Ke=new as,Qa=Ke.generateSecretKey,Xa=Ke.getPublicKey,tr=Ke.finalizeEvent,cs=Ke.verifyEvent,ls=22242;function ps(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let i=n.slice(1),o=e[`#${i}`];if(o&&!t.tags.find(([s,a])=>s===n.slice(1)&&o.indexOf(a)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function ds(e,t){for(let n=0;n<e.length;n++)if(ps(e[n],t))return!0;return!1}function us(e,t){let n=t.length+3,i=e.indexOf(`"${t}":`)+n,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function fs(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let i=t+7+1+n,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let s=i+1+o;return e.slice(i+1,s)}function ms(e,t){return{kind:ls,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function hs(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var _i=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Bi=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new ss;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=is(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){let n=new Bi(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{let n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,this.ws?.close(),this.onclose?.()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await hs();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=fs(e);if(t){let n=this.openSubs.get(t);if(!n)return;let i=us(e,"id"),o=n.alreadyHaveEvent?.(i);if(n.receivedEvent?.(this,i),o)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{let i=this.openSubs.get(n[1]),o=n[2];this.verifyEvent(o)&&ds(i.filters,o)&&i.onevent(o);return}case"COUNT":{let i=n[1],o=n[2],s=this.openCountRequests.get(i);s&&(s.resolve(o.count),this.openCountRequests.delete(i));return}case"EOSE":{let i=this.openSubs.get(n[1]);if(!i)return;i.receivedEose();return}case"OK":{let i=n[1],o=n[2],s=n[3],a=this.openEventPublishes.get(i);a&&(clearTimeout(a.timeout),o?a.resolve(s):a.reject(new Error(s)),this.openEventPublishes.delete(i));return}case"CLOSED":{let i=n[1],o=this.openSubs.get(i);if(!o)return;o.closed=!0,o.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new _i(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){let t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,i)=>{try{let o=await e(ms(this.url,t)),s=setTimeout(()=>{let a=this.openEventPublishes.get(o.id);a&&(a.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:i,timeout:s}),this.send('["AUTH",'+JSON.stringify(o)+"]")}catch(o){console.warn("subscribe auth function failed:",o)}}),this.authPromise)}async publish(e){let t=new Promise((n,i)=>{let o=setTimeout(()=>{let s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:i,timeout:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,i=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),i}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||(t.label?t.label+":":"sub:")+this.serial,i=new gs(this,n,e,t);return this.openSubs.set(n,i),i}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close(),this.onclose?.()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},gs=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,i){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=i.alreadyHaveEvent,this.receivedEvent=i.receivedEvent,this.eoseTimeout=i.eoseTimeout||e.baseEoseTimeout,this.oneose=i.oneose,this.onclose=i.onclose,this.onevent=i.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof _i))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},$i;try{$i=WebSocket}catch{}var $n=class extends Bi{constructor(e){super(e,{verifyEvent:cs,websocketImplementation:$i})}static async connect(e){let t=new $n(e);return await t.connect(),t}};function Jt(e){return typeof window>"u"&&e.unref(),e}var Si=["wss://purplepag.es","wss://user.kindpag.es","wss://relay.nos.social","wss://relay.nostr.band","wss://nostr.land","wss://indexer.coracle.social"];var dt,Bt,le,Qt,Ve,Sn=class{constructor(){F(this,Qt);F(this,dt,new Map);F(this,Bt,new Map);F(this,le,3e4)}async disconnect(t){if(T(this,dt).has(t)){let n=T(this,dt).get(t);n.ws.readyState<2&&await n.close()?.catch(console.log),T(this,dt).delete(t),clearTimeout(T(this,Bt).get(t)),T(this,Bt).delete(t)}}async disconnectAll(){for(let t of T(this,dt).keys())await this.disconnect(t)}async getEvents(t,n,i=5e3){let o=[],s=n.map(async r=>{try{let c=await J(this,Qt,Ve).call(this,r);return new Promise(l=>{let d=c.subscribe([t],{onevent:u=>{o.push(u)},onclose:()=>{clearTimeout(p),l()},oneose:()=>{clearTimeout(p),l()}}),p=Jt(setTimeout(()=>{d.close(),l()},i))})}catch(c){console.error(`Failed to get events from ${r}`,c)}}),a=await Promise.allSettled(s);if(a.some(r=>r.status==="rejected"))throw new Error(a[0].reason);return o}async getEventsAsap(t,n,i=5e3){return new Promise(o=>{let s=new Map,a=null,r=Jt(setTimeout(()=>{s.forEach(l=>l.close()),o([])},i)),c=0;for(let l of n)J(this,Qt,Ve).call(this,l).then(d=>{if(a)return;let p=[],u=d.subscribe([t],{onevent:h=>{a||(a=u,s.forEach(g=>{g!==a&&g.close()}),clearTimeout(r)),u===a&&p.push(h)},onclose:()=>{(++c).length<n.length||(clearTimeout(r),o(p))},oneose:()=>{u===a&&(clearTimeout(r),o(p)),u.close()}});s.set(l,u)}).catch(d=>{console.error(`Nostr relay error at ${l}: ${d}`)})})}async sendEvent(t,n,i=3e3){let o=n.map(async a=>{try{let r=await J(this,Qt,Ve).call(this,a),c=Jt(setTimeout(()=>{throw new Error(`Timeout sending event to ${a}`)},i));await r.publish(t),clearTimeout(c)}catch(r){console.error(`Failed to send event to ${a}`,r)}}),s=await Promise.allSettled(o);if(s.some(a=>a.status==="rejected"))throw new Error(s[0].reason)}};dt=new WeakMap,Bt=new WeakMap,le=new WeakMap,Qt=new WeakSet,Ve=async function(t){if(T(this,dt).has(t)){clearTimeout(T(this,Bt).get(t)),T(this,Bt).set(t,Jt(setTimeout(()=>this.disconnect(t),T(this,le))));let i=T(this,dt).get(t);return await i.connect(),i}let n=new $n(t);return T(this,dt).set(t,n),await n.connect(),T(this,Bt).set(t,Jt(setTimeout(()=>this.disconnect(t),T(this,le)))),n};var pe=new Sn;async function Ai(e,t){if(!e.pubkey||!e.kind||!e.dTag)throw new Error("Missing args");return t??=(await Ii(e.pubkey))[e.pubkey],t.write.length===0?void 0:(await pe.getEvents({authors:[e.pubkey],kinds:[e.kind],"#d":[e.dTag],limit:1},t.write)).sort((i,o)=>o.created_at-i.created_at)[0]}async function Ti(e,t){switch(t.code){case"WRITE_RELAYS":{if((e.authors?.length??0)===0&&(t.authors?.length??0)===0)throw new Error("Missing authors");let n=t.authors||e.authors,i=Object.entries(await Ii(n)).map(([r,c])=>[r,c.write]),o={};i.forEach(r=>r[1].forEach(c=>{o[c]??=0,o[c]++}));let s=Object.entries(o).sort(([,r],[,c])=>c-r).map(([r])=>r),a=t.maxRelaysPerUser||2;if(e.authors){let r={},c={};s.forEach(m=>{i.forEach(([x,E])=>{E.includes(m)&&(r[x]??=0,!(++r[x]>a)&&(c[m]??=[],c[m].push(x)))})});let l=Object.entries(c).map(([m,x])=>pe.getEventsAsap({...e,authors:x},[m])),p=(await Promise.allSettled(l)).filter(m=>m.status==="fulfilled"&&m.value).flatMap(m=>m.value).sort((m,x)=>x.created_at-m.created_at),u=[],h=new Set,g=new Set,f=m=>{let x;if(m.kind>=1e4&&m.kind<2e4||m.kind===0||m.kind===3?x="":x=m.tags.find(k=>k[0]==="d")?.[1],typeof x=="string")return`${m.kind}:${m.pubkey}:${x}`};for(let m of p){if(e.limit&&u.length===e.limit)break;if(h.has(m.id))continue;let x=f(m);if(x){if(g.has(x))continue;g.add(x)}h.add(m.id),u.push(m)}return u}else{let r=new Set;return i.forEach(c=>{let l=0;for(let d of s){if(l===a)break;c[1].includes(d)&&(l++,r.add(d))}}),pe.getEventsAsap(e,[...r])}}default:throw new Error("Pick a strategy")}}async function Ii(e){Array.isArray(e)||(e=[e]);let t=await pe.getEvents({authors:e,kinds:[10002],limit:e.length},Si),n={},i={read:!0,write:!0},o=Object.keys(i),s,a=e.reduce((c,l)=>({...c,[l]:{read:new Set,write:new Set}}),{}),r=t.sort((c,l)=>l.created_at-c.created_at).filter(c=>(!n[c.pubkey]&&e.includes(c.pubkey)&&(n[c.pubkey]=!0),n[c.pubkey])).reduce((c,l)=>((l.tags??[]).filter(d=>d[0]==="r"&&/^wss?:\/\//.test(d[1])).forEach(d=>{s=[d[2]].filter(p=>i[p]),s.length===0&&(s=o),s.forEach(p=>c[l.pubkey][p].add(d[1]))}),c),a);for(let c in r)o.forEach(l=>{r[c][l]=[...r[c][l]]});return r}async function ji(e){let t=Qe(e);return pt("get",[t],"bundles").then(n=>n.result&&bs(n.result))}async function Ci(e){let t=Qe(e);return pt("delete",[t],"bundles")}async function We(e,t){let n=xs(e,t);return pt("put",[n],"bundles")}function xs(e,{hasUpdate:t=!1,lastOpenedAsSingleNappAt:n=0}={}){let i=e.tags.find(l=>l[0]==="d")?.[1]??"";if(!zn(i))throw new Error("Invalid d tag");let{kind:o,pubkey:s,meta:a,...r}=e,c={37448:"a",37449:"b",37450:"c"}[o];if(!c)throw new Error("Invalid kind");return{c,p:Nn(s),d:i,u:t,s:n,evt:r}}function bs(e){let t={a:37448,b:37449,c:37450}[e.c];if(!t)throw new Error("Invalid channel");return{kind:t,pubkey:be(e.p),...e.evt,meta:{hasUpdate:e.u,lastOpenedAsSingleNappAt:e.s}}}async function An(e,t){let n=await ji(e);return n||(n=await Ai(t),n&&await We(n),n)}async function*Tn(e,t,n,i){if(i??=Kt(n,t.tags),!i)throw new Error(`No matching file tag found for path: ${n}`);let o=i[1],s=await we(e,o);if(s.count===s.total){yield{progress:100,newlyCachedChunkIndexRanges:[]};return}let r=[i[4]?.trim(),t.pubkey].filter(Boolean);if(!s.total&&(s.count&&(await ke(e,o),s.count=0),s=yield*Oi(o,[0,1,2,3],r,t,e,s),!s.total))throw new Error("Some chunks are missing");let c={};for await(let d of mt(e,o,{justKeys:!0}))c[d[2]]=!0;let l=[...Array(s.total).keys()].filter(d=>!c[d]);if(s=yield*Oi(o,l,r,t,e,s),!s.total||s.count<s.total)throw new Error("Some chunks are missing")}async function*Oi(e,t,n,i,o,s){let a=0,r=s.total,c=[],l=()=>Math.floor((s.count+a)/r*100),d=p=>{if(p.length===0)return[];let u=[...p].sort((m,x)=>m-x),h=[],g=u[0],f=u[0];for(let m=1;m<u.length;m++)u[m]===f+1?f=u[m]:(h.push([g,f]),g=f=u[m]);return h.push([g,f]),h};for(let p=0;p<t.length;p+=4){let u=t.slice(p,p+4),h=0,g=!1;for(;!g&&h<20;){let f={authors:n,"#c":u.map(x=>`${e}:${x}`),limit:u.length},m=await Ti(f,{code:"WRITE_RELAYS",maxRelaysPerUser:7});if(m){if(g=!0,m.length>0){await Zn(i,m,o),a+=m.length;for(let E of m){let k=E.tags.find($=>$[0]==="c"&&$[1].startsWith(`${e}:`));if(k){let $=parseInt(k[1].split(":")[1]);Number.isNaN($)||c.push($)}}if(!r){for(let E of m)if(r=vs(E,e))break}if(!r)continue;let x=d(c);yield{progress:l(),newlyCachedChunkIndexRanges:x},c.length=0}}else h++,console.log(`Failed to fetch chunks (${h}). Retrying...`),await new Promise(x=>setTimeout(x,Math.pow(2,Math.min(10,h))*1e3))}if(!g){console.log("Failed to fetch chunks after multiple retries");break}}return{count:s.count+a,total:r}}function vs(e,t){let n=e.tags.find(o=>o[0]==="c"&&o[1].startsWith(`${t}:`));if(!n)return null;let i=parseInt(n[2]);if(Number.isNaN(i))return null;if(i>0)return i}var Ri={"application/prs.cww":["cww"],"application/prs.xsf+xml":["xsf"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["*xfdf"],"application/vnd.age":["age"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.autodesk.fbx":["fbx"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dcmp+xml":["dcmp"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["*fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.slides":["ggs"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.drawing":["gdraw"],"application/vnd.google-apps.form":["gform"],"application/vnd.google-apps.jam":["gjam"],"application/vnd.google-apps.map":["gmap"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.script":["gscript"],"application/vnd.google-apps.site":["gsite"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.gov.sk.xmldatacontainer+xml":["xdcf"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mapbox-vector-tile":["mvt"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["*mpp","mpt"],"application/vnd.ms-visio.viewer":["vdx"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.nato.bindingdataobject+xml":["bdo"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.procrate.brushset":["brushset"],"application/vnd.procreate.brush":["brush"],"application/vnd.procreate.dream":["drm"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.pwg-xhtml-print+xml":["xhtm"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml","uo"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw","vsdx","vtx"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blender":["blend"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-compressed":["*rar"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-ipynb+json":["ipynb"],"application/x-iso9660-image":["*iso"],"application/x-iwork-keynote-sffkey":["*key"],"application/x-iwork-numbers-sffnumbers":["*numbers"],"application/x-iwork-pages-sffpages":["*pages"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["*prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["*sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zip-compressed":["*zip"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["*aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif","btf"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-adobe-dng":["dng"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.bary":["bary"],"model/vnd.cld":["cld"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["*mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.pytha.pyox":["pyo","pyox"],"model/vnd.sap.vds":["vds"],"model/vnd.usda":["usda"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.familysearch.gedcom":["ged"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]};Object.freeze(Ri);var Pi=Ri;var Li={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Li);var Ui=Li;var nt=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Xt,de,Lt,In=class{constructor(...t){Xt.set(this,new Map),de.set(this,new Map),Lt.set(this,new Map);for(let n of t)this.define(n)}define(t,n=!1){for(let[i,o]of Object.entries(t)){i=i.toLowerCase(),o=o.map(r=>r.toLowerCase()),nt(this,Lt,"f").has(i)||nt(this,Lt,"f").set(i,new Set);let s=nt(this,Lt,"f").get(i),a=!0;for(let r of o){let c=r.startsWith("*");if(r=c?r.slice(1):r,s?.add(r),a&&nt(this,de,"f").set(i,r),a=!1,c)continue;let l=nt(this,Xt,"f").get(r);if(l&&l!=i&&!n)throw new Error(`"${i} -> ${r}" conflicts with "${l} -> ${r}". Pass \`force=true\` to override this definition.`);nt(this,Xt,"f").set(r,i)}}return this}getType(t){if(typeof t!="string")return null;let n=t.replace(/^.*[/\\]/s,"").toLowerCase(),i=n.replace(/^.*\./s,"").toLowerCase(),o=n.length<t.length;return!(i.length<n.length-1)&&o?null:nt(this,Xt,"f").get(i)??null}getExtension(t){return typeof t!="string"?null:(t=t?.split?.(";")[0],(t&&nt(this,de,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:nt(this,Lt,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(let t of nt(this,Lt,"f").values())Object.freeze(t);return this}_getTestState(){return{types:nt(this,Xt,"f"),extensions:nt(this,de,"f")}}};Xt=new WeakMap,de=new WeakMap,Lt=new WeakMap;var jn=In;var Cn=new jn(Ui,Pi)._freeze();var ys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&'()*+,-./:;<=>?@[]^_`{|}~ ",ws=(()=>{let e=new Int16Array(128);e.fill(93);for(let t=0;t<93;t++)e[ys.charCodeAt(t)]=t;return e})();function ue(e,t=0,n=-1){let i=t+n;(n<0||i>e.length)&&(i=e.length);let o=new Uint8Array(Math.ceil((i-t)*7/8)),s=0,a=0,r=-1,c=0;for(let l=t;l<i;l++){let d=e.charCodeAt(l);if(d>126)continue;let p=ws[d];if(p!==93)if(r===-1)r=p;else{let u=r+p*93;for(r=-1,s|=u<<a,a+=(u&8191)>456?13:14;a>7;)o[c++]=s&255,s>>>=8,a-=8}}return r!==-1&&(o[c++]=(s|r<<a)&255),o.subarray(0,c)}async function qi(e,t=!1){let i=e.getCachedMetadata(e.appId,["icon"])?.icon;return t&&i?(Ni(e,i),i):i||await Ni(e)}async function Mi(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.name;return t&&(i!==void 0||n?.description!==void 0)?(Fe(e),i):i!==void 0?i:(await Fe(e))?.name?.trim()||null}async function zi(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.description;return t&&(i!==void 0||n?.name!==void 0)?(Fe(e),i):i!==void 0?i:(await Fe(e))?.description?.trim()||null}async function Ni(e,t=null){let n=e.getFaviconMetadata();if(!n)return null;if(t&&t.fx===n.rootHash)return t;try{let i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0});i.isCached||(await e.cacheFile(null,n.tag),i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0}));let o=[];for await(let p of mt(e.appId,n.rootHash))o.push(p.evt.content);if(o.length===0)return null;let s=o.map(p=>ue(p)),a=new Blob(s,{type:n.contentType}),r=new FileReader,l=await new Promise((p,u)=>{r.onload=()=>p(r.result),r.onerror=u,r.readAsDataURL(a)}),d={fx:n.rootHash,url:l};return e.cacheMetadata(e.appId,{icon:d}),d}catch(i){return console.log("Failed to fetch icon:",i),null}}async function Fe(e){try{let t=await e.getFileCacheStatus("/",null,{withMeta:!0});t.isCached||await e.cacheFile("/",null);let n=[];for await(let p of mt(e.appId,t.fileRootHash))n.push(p.evt.content);if(n.length===0)return{name:void 0,description:void 0};let i=n.map(p=>ue(p)),o=new Blob(i,{type:t.contentType}),s=new FileReader,r=await new Promise((p,u)=>{s.onload=()=>p(s.result),s.onerror=u,s.readAsText(o)}),{name:c,description:l}=ks(r),d={};return c!==void 0&&(d.name=c),l!==void 0&&(d.description=l),Object.keys(d).length>0&&e.cacheMetadata(e.appId,d),{name:c,description:l}}catch(t){return console.log("Failed to fetch HTML metadata:",t),{name:void 0,description:void 0}}}function ks(e){let t,n;try{let i=/<title[^>]*>([\s\S]*?)<\/title>/i,o=e.match(i);o&&o[1]&&(t=o[1].trim());let s=/<meta\s+[^>]*name\s*=\s*["']description["'][^>]*content\s*=\s*["']([^"']+)["'][^>]*>/i,a=e.match(s);if(a&&a[1]&&(n=a[1].trim()),!n){let r=/<meta\s+[^>]*content\s*=\s*["']([^"']+)["'][^>]*name\s*=\s*["']description["'][^>]*>/i,c=e.match(r);c&&c[1]&&(n=c[1].trim())}}catch(i){console.log("Error parsing HTML metadata:",i)}return{name:t,description:n}}function Es(e,t){if(!e||!t)throw new Error("Missing args");["name","description","icon"].forEach(n=>{let i=t[n];switch(n){case"icon":i=i?.fx&&i?.url&&{fx:i.fx,url:i.url};break;case"description":i=(i?.length??0)>255?`${i.slice(0,252)}...`:i;break;case"name":i=(i?.length??0)>100?`${i.slice(0,97)}...`:i;break}i&&vt(localStorage,`session_appById_${e}_${n}`,i)})}function _s(e,t=["name","description","icon"]){if(!e)return;let n={};return t.forEach(i=>{let o=localStorage.getItem(`session_appById_${e}_${i}`);if(o){try{o=JSON.parse(o)}catch{console.log(`Error parsing "${i}" metadata from app "${e}"`);return}n[i]=o}}),n}function Di(e){return e?/^(?:text\/|application\/json)[^;]*$/.test(e)?`${e}; charset=utf-8`:e:"application/octet-stream"}var Hi=Symbol("createToken"),Ut,it,Ki,te,Nt,On,Rn,$t,xt,Vi,St=class{constructor(t,n){F(this,it);F(this,te);F(this,Nt,{});F(this,$t,!1);F(this,xt,{});if(t!==Hi)throw new Error("Use AppFileCacher.create(appAddress) to instantiate this class.");Object.assign(this,n)}static async create(t,n,{cacheMetadata:i=Es,getCachedMetadata:o=_s}={}){if(T(this,Ut)[t])return T(this,Ut)[t];let s=Promise.withResolvers();T(this,Ut)[t]=s.promise,n??=ne(t);let a,r;do a=await An(t,n),a||(r++,console.log("Retrying bundle fetching"),await new Promise(l=>setTimeout(l,Math.pow(2,Math.min(10,r))*1e3)));while(!a&&r<20);a||(delete T(this,Ut)[t],s.reject(new Error(`Couldn't find bundle after ${r} attempts`)));let c=new this(Hi,{appId:t,addressObj:n,bundle:a,cacheMetadata:i,getCachedMetadata:o});return s.resolve(c),s.promise}async getIcon(t=!1){return qi(this,t)}async getName(t=!1){return Mi(this,t)}async getDescription(t=!1){return zi(this,t)}async clearAppFiles(){await J(this,it,Ki).call(this),await ke(this.appId),await Ci(this.appId)}updateBundleMetadata(t){if(!t)throw new Error("Missing metadata arg");return We(this.bundle,{...this.bundle.meta,...t})}getFaviconMetadata(){if(T(this,te))return T(this,te);let t,n=this.bundle.tags.find(i=>i[0]==="file"&&/^favicon\.\w{3,}$/.test(i[2])&&(!!i[3]&&i[3].startsWith("image/")&&(t=i[3])||((t=Cn.getType(i[2]))||"").startsWith("image/")));if(n)return zt(this,te,{rootHash:n[1],filename:n[2],mimeType:t,contentType:Di(t),relayHints:[n[4]].filter(Boolean),tag:n})}getFileRootHash(t,n){if(n??=Kt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);return n[1]}async getFileCacheStatus(t,n,{withMeta:i=!1}={}){if(n??=Kt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let o=this.getFileRootHash(null,n),s=await we(this.appId,o);if(!i)return{isCached:s.count===s.total};let a=n[3]&&n[3].startsWith("image/")?n[3]:Cn.getType(n[2]);return{...s,isCached:s.count===s.total,mimeType:a,contentType:Di(a),isHtml:/^text\/html\b/.test(a),fileRootHash:o,fileTag:n}}async cacheFile(t,n,i,{shouldCacheMissingFiles:o=!navigator.connection?.metered}={}){if(n??=Kt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let s=n[2],a=J(this,it,On).call(this,s);if(i&&(a.subscribers.add(i),a.result!==null&&i(a.result),a.error)){i({error:a.error});return}let r=Promise.withResolvers();return a.subscribers.add(({progress:c,error:l,newlyCachedChunkIndexRanges:d})=>{if(c>=100){if(r.resolve(),!o)return;this.cacheMissingAppFiles(s)}else l&&r.reject(l)}),J(this,it,Vi).call(this,s,n),r.promise}async cacheMissingAppFiles(t){if(!T(this,$t)){zt(this,$t,!0);try{let n={...t&&{[t]:!0}},i=this.bundle.tags.filter(o=>o[0]!=="file"||!o[1]||!o[2]||n[o[2]]?!1:n[o[2]]=!0);for(let o of i){if(!T(this,$t))break;await this.cacheFile(`/${o[2]}`,o,null,{shouldCacheMissingFiles:!1})}}finally{zt(this,$t,!1)}}}};Ut=new WeakMap,it=new WeakSet,Ki=async function(){zt(this,$t,!1);for(let t in T(this,Nt)){let n=T(this,Nt)[t],i=new Error("Cache operation aborted");n.error=i;for(let o of n.subscribers)try{o({error:i})}catch(s){console.log(s)}J(this,it,Rn).call(this,t)}zt(this,xt,{})},te=new WeakMap,Nt=new WeakMap,On=function(t){if(!t)throw new Error("No filename");return T(this,Nt)[t]??={subscribers:new Set,result:null,error:null}},Rn=function(t){delete T(this,Nt)[t]},$t=new WeakMap,xt=new WeakMap,Vi=async function(t,n){if(T(this,xt)[t])return;T(this,xt)[t]=!0;let i=Tn(this.appId,this.bundle,t,n),o=J(this,it,On).call(this,t);try{for await(let{progress:a,newlyCachedChunkIndexRanges:r}of i){if(!T(this,xt)[t])break;o.result={progress:a,newlyCachedChunkIndexRanges:r};for(let c of o.subscribers)try{c({progress:a,newlyCachedChunkIndexRanges:r})}catch(l){console.log(l)}}if(!T(this,xt)[t]||o.result?.progress>=100)return;let s=new Error(`File caching incomplete, stopped at ${o.result?.progress??0}%`);o.error=s;for(let a of o.subscribers)try{a({error:s})}catch(r){console.log(r)}}catch(s){o.error=s;for(let a of o.subscribers)try{a({error:s})}catch(r){console.log(r)}}finally{J(this,it,Rn).call(this,t),delete T(this,xt)[t]}},F(St,Ut,{});async function Bs(e,t,n){try{let i=n.map(l=>ue(l)),o=new Blob(i,{type:t.contentType}),s=new FileReader,r=await new Promise((l,d)=>{s.onload=()=>l(s.result),s.onerror=d,s.readAsDataURL(o)}),c={fx:t.rootHash,url:r};return vt(localStorage,`session_appById_${e}_icon`,c),c}catch(i){console.log("Failed to update icon storage:",i)}}async function oc(e,t,n,i,o,s,a,r,c,l,d,{signal:p,isSingleNapp:u=!1}={}){let h=Mn(e),g=It(h)===JSON.parse(localStorage.getItem("session_defaultUserPk")),f=new URL(JSON.parse(localStorage.getItem("config_vaultUrl")));document.querySelector(`iframe[src="${f.href.replace(/\/$/,"")}"]`)||console.warn("Vault iframe not found");let x=ne(t),E=await St.create(t,x);u&&E.updateBundleMetadata({lastOpenedAsSingleNappAt:Date.now()});let k=null,$=null;p?.addEventListener("abort",()=>{k&&(k.close(),k=null),$&&($.close(),$=null)},{once:!0});let j,_=location.origin.replace("//",`//${n}.`);window.addEventListener("message",S=>{S.data.code!=="TRUSTED_IFRAME_READY"||S.source!==o.contentWindow||S.origin!==_||(j?.abort(),j=new AbortController,k&&k.close(),k=S.ports[0],G(k,AbortSignal.any([p,j.signal])),C(n,i))},{signal:p});let A=!1;function C(S,v=""){if(A)return;A=!0;let b;window.addEventListener("message",w=>{w.data.code!=="APP_IFRAME_READY"||w.source!==s.contentWindow||w.origin!==_||(b?.abort(),b=new AbortController,$&&$.close(),$=w.ports[0],Z($,AbortSignal.any([p,b.signal])))},{signal:p});let y=window.location.host;a(`//${S}.${y}${v}`)}function G(S,v){S.addEventListener("message",async b=>{switch(b.data.code){case"STREAM_APP_FILE":{let y=(w,B=new Error("FILE_NOT_CACHED"))=>(w&&console.log(w),Q(b,{error:B,isLast:!0},{to:S}));try{let w=await E.getFileCacheStatus(b.data.payload.pathname,null,{withMeta:!0});if(!w.isCached)if(w.isHtml)y(null,new Error("HTML_FILE_NOT_CACHED"));else{let{fileRootHash:O,total:I}=w,L=0,q=-1,M=!1,tt=!1,At=async({progress:Y,newlyCachedChunkIndexRanges:qt,error:lt})=>{if(M||tt)return;if(lt){M=!0;let N=r(),{[b.data.payload.pathname]:ot,...st}=N;return r(st),y(lt)}let ut=b.data.payload.pathname,me=r();if(r({...me,[ut]:{progress:Y,totalByteSizeEstimate:I?(I-1)*51e3:0}}),Y>=100&&setTimeout(()=>{let N=r(),{[ut]:ot,...st}=N;r(st)},1e3),qt.length>0)for(let N of qt)q=Math.max(q,N[1]);else if(I!==null)q=I-1;else return y(new Error("No cached chunks"));for(;L<=q&&!M&&!tt;)try{let N=await Fn(t,O,{fromPos:L,toPos:L});if(N.length===0)return M=!0,y(new Error(`Missing chunk at index ${L} for rootHash ${O}`));let ot=N[0];if(I===null){let he=ot.evt.tags.find(Un=>Un[0]==="c"&&Un[1].startsWith(`${O}:`)),Mt=parseInt(he?.[2]);!Number.isNaN(Mt)&&Mt>0&&(I=Mt)}if(I===null)return M=!0,y(new Error("Unable to determine total chunks."));let st=I!=null&&L===I-1;Q(b,{payload:{content:ot.evt.content,...L===0&&{contentType:w.contentType}},isLast:st},{to:S}),L++,st&&(tt=!0)}catch(N){return M=!0,y(N)}};try{return E.cacheFile(b.data.payload.pathname,w.fileTag,At)}catch(Y){return y(Y)}}let B=0;for await(let O of mt(t,E.getFileRootHash(b.data.payload.pathname)))Q(b,{payload:{content:O.evt.content,...B===0&&{contentType:w.contentType}},isLast:++B===w.total},{to:S})}catch(w){return y(w,w)}break}}},{signal:v}),S.start(),jt(S,{code:"BROWSER_READY",payload:null})}let P=new Map,R=new Map;async function K(S,v){if(P.has(S))return P.get(S);R.has(S)||R.set(S,{icon:!1,name:!1,promise:null});let b=R.get(S);if(b.promise)return b.promise;v??=ne(S);let y=await St.create(S,v),w={id:S,napp:Dn(v)},B=[];!("icon"in w)&&!b.icon&&(b.icon=!0,B.push(y.getIcon().then(I=>I&&(w.icon=I)).finally(()=>{b.icon=!1}))),!("name"in w)&&!b.name&&(b.name=!0,B.push(y.getName().then(I=>I&&(w.name=I)).finally(()=>{b.name=!1})));let O=(async()=>(B.length>0&&await Promise.race([...B,new Promise(I=>setTimeout(I,1750))]),P.set(S,w),R.delete(S),w))();return b.promise=O,O}function Z(S,v){S.addEventListener("message",async b=>{switch(b.data.code){case"OPEN_APP":{let y;try{let{href:w}=b.data.payload,O=new URL(w,self.location.origin).pathname,I=/^\/(\+{1,3}[a-zA-Z0-9]{48,})/,L=O.match(I);if(!L){console.error("Invalid app URL format:",w);break}let q=L[1],M=ve(q);y=Ht(M);let tt=await K(y,M);await l({app:await K(t,x),name:"openApp",eKind:null,meta:{targetApp:tt}}),d(w)}catch(w){let B=!1;for(let O of JSON.parse(localStorage.getItem("session_workspaceKeys"))??[])if(B=Array.isArray(JSON.parse(localStorage.getItem(`session_workspaceByKey_${O}_appById_${y}_appKeys`))),B)break;B||(vt(localStorage,`session_appById_${y}_icon`,void 0),vt(localStorage,`session_appById_${y}_name`,void 0),vt(localStorage,`session_appById_${y}_description`,void 0),vt(localStorage,`session_appById_${y}_relayHints`,void 0),await(await St.create(y)).clearAppFiles()),console.error("Error in OPEN_APP handler:",w)}break}case"NIP07":{if(["peek_public_key","get_public_key"].includes(b.data.payload.method)&&b.data.payload.ns[0]===""&&b.data.payload.ns.length===1){Q(b,{payload:h},{to:S});break}let{ns:y,method:w,params:B=[]}=b.data.payload,O=await K(t,x),I;try{I=await Ts(c,h,y,w,B,{isDefaultUser:g,requestPermission:l,app:O})}catch(L){I={error:L}}Q(b,I,{to:S});break}case"WINDOW_NAPP":{$s(b);break}case"STREAM_APP_ICON":{try{let y=E.getFaviconMetadata();if(!y){Q(b,{error:new Error("No favicon"),isLast:!0},{to:S});break}let w=await E.getFileCacheStatus(null,y.tag,{withMeta:!0});w.isCached||(await E.cacheFile(null,y.tag),w=await E.getFileCacheStatus(null,y.tag,{withMeta:!0}));let O=JSON.parse(localStorage.getItem(`session_appById_${t}_icon`))?.fx!==y.rootHash,I=[],L=0;for await(let q of mt(t,y.rootHash))O&&I.push(q.evt.content),Q(b,{payload:{content:q.evt.content,...L===0&&{mimeType:y.mimeType||w.mimeType,contentType:y.contentType||w.contentType}},isLast:++L===w.total},{to:S});if(I.length>0){let{url:q}=await Bs(t,y,I);if(P.has(t)){let M=P.get(t);M.icon={fx:y.rootHash,url:q}}}}catch(y){console.log(y.stack),Q(b,{error:y,isLast:!0},{to:S})}break}case"CACHE_APP_FILE":{try{let y=({progress:w,error:B})=>{if(B)Q(b,{error:B,isLast:!0},{to:S});else{let O=w>=100;Q(b,{payload:w,isLast:O},{to:S})}};E.cacheFile(b.data.payload.pathname,null,y)}catch(y){console.log(b.data.payload.pathname,"error:",y.stack),Q(b,{error:y,isLast:!0},{to:S})}break}}},{signal:v}),S.start(),jt(S,{code:"BROWSER_READY",payload:null})}}function $s(e){return Q(e,{error:new Error("Not implemented yet")})}var Ss={getPublicKey:"readProfile",signEvent:"signEvent",nip04Encrypt:"encrypt",nip04Decrypt:"decrypt",nip44Encrypt:"encrypt",nip44Decrypt:"decrypt"};function As(e){return Ss[e]||(()=>{throw new Error(`Unknown method ${e}`)})()}async function Ts(e,t,n,i,o,{isDefaultUser:s,requestPermission:a,app:r}={}){if(s)throw new Error("Please login");if(a){let p=i.includes("_")?i.replace(/_([a-z0-9])/g,(h,g)=>g.toUpperCase()):i,u=(()=>{switch(p){case"signEvent":return o?.[0]?.kind;default:return null}})();await a({app:r,name:As(p),eKind:u,meta:{params:o}})}let{napp:c,...l}=r,d={code:"NIP07",payload:{app:{...l,id:c},pubkey:t,ns:n,method:i,params:o}};return e(d,{timeout:12e4})}function Pn(){return It(Is(),43)}function Is(){let e=crypto.getRandomValues(new Uint8Array(40)),n=2n**256n-0x14551231950b75fc4402da1732fc9bebfn;return(((a,r)=>{let c=a%r;return c>=0n?c:r+c})((a=>BigInt("0x"+(be(a)||"0")))(e),n-1n)+1n).toString(16).padStart(64,"0")}var Fi=["+33a0T7tbskjjdCMkBKV5Fn9obDCVLwdLlFbfthUcU0khDZh1eZVPL0mV","+cB3lFAQviXRJmg7z5TJJoPALS3CKwd2Pvs2rSVW5hflKR70lfbqbBklPQ"].map(ve).map(Ht);function js(){let e=Wt(localStorage);return xe("hardcoded_newAppIdsObj",{}),V(()=>{if(e.session_workspaceKeys$())return;let t=Pn();e.session_defaultUserPk$(t),Wi({userPk:t,storage:e,isFirstTimeUser:!0})}),V(()=>{if(!e.session_workspaceKeys$())return;let t=e.session_workspaceKeys$()||[],n=e.session_defaultUserPk$();t.forEach(i=>{let o=e[`session_workspaceByKey_${i}_userPk$`]();o!=null&&o!==n&&!(e[`session_accountByUserPk_${o}_isReadOnly$`]()??!1)&&e[`session_accountByUserPk_${o}_isLocked$`](!0)})}),V(({track:t})=>{if(t(()=>e.session_workspaceKeys$().length>0))return;let n=Pn();e.session_defaultUserPk$(n),Wi({userPk:n,storage:e,isFirstTimeUser:!0})}),e}function Wi({userPk:e,storage:t,isFirstTimeUser:n}){let i=Fi.map((a,r)=>({id:a,key:Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),visibility:"closed",isNew:!1})),o=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);t.config_isSingleWindow$()===void 0&&t.config_isSingleWindow$(!1);let s=[];t[`session_workspaceByKey_${o}_openAppKeys$`](s),t[`session_workspaceByKey_${o}_userPk$`](e),i.forEach(a=>{t[`session_workspaceByKey_${o}_appById_${a.id}_appKeys$`]([a.key]),t[`session_appByKey_${a.key}_id$`](a.id),t[`session_appByKey_${a.key}_visibility$`](a.visibility),t[`session_appByKey_${a.key}_route$`]("")}),t[`session_workspaceByKey_${o}_unpinnedCoreAppIdsObj$`]({}),t[`session_workspaceByKey_${o}_pinnedAppIds$`](i.map(({id:a})=>a)),t[`session_workspaceByKey_${o}_unpinnedAppIds$`]([]),t[`session_accountByUserPk_${e}_isReadOnly$`](!0),t[`session_accountByUserPk_${e}_isLocked$`](!1),t[`session_accountByUserPk_${e}_profile$`]({npub:Hn(qn(e)),meta:{events:[]}}),t[`session_accountByUserPk_${e}_relays$`]({meta:{events:[]}}),t.session_accountUserPks$([e]),t.session_workspaceKeys$([o]),t.session_openWorkspaceKeys$([o])}async function Ln(e,t){let n=t.session_workspaceKeys$()||[],i=t.session_defaultUserPk$(),o=n.length===1&&n.every(c=>t[`session_workspaceByKey_${c}_userPk$`]()===i);if(e.length===0&&o)return;let s=t.session_accountUserPks$()||[],a=e.map(c=>It(c.pubkey)),r;if(e.forEach(c=>{let l=It(c.pubkey);t[`session_accountByUserPk_${l}_isReadOnly$`](r=c.isReadOnly??!1),t[`session_accountByUserPk_${l}_isLocked$`](r?!1:c.isLocked??!0),t[`session_accountByUserPk_${l}_profile$`](c.profile),t[`session_accountByUserPk_${l}_relays$`](c.relays)}),o&&a.length===1){let c=n[0],l=a[0],d=t[`session_workspaceByKey_${c}_openAppKeys$`]()||[],p=[];d.forEach(u=>{t[`session_appByKey_${u}_visibility$`](h=>(h==="open"&&p.push(u),"closed"))}),t[`session_workspaceByKey_${c}_openAppKeys$`]([]),t[`session_workspaceByKey_${c}_userPk$`](l),await new Promise(u=>window.requestIdleCallback(()=>window.requestIdleCallback(u,{timeout:50}),{timeout:100})),p.forEach(u=>{t[`session_appByKey_${u}_visibility$`]("open")}),t[`session_workspaceByKey_${c}_openAppKeys$`](p),t.session_defaultUserPk$(void 0)}else{let c=a.filter(h=>!s.includes(h)),l=s.filter(h=>!a.includes(h));c.length>0&&i&&t.session_defaultUserPk$(void 0);let d=[];for(let h of l)d=d.concat(n.filter(g=>t[`session_workspaceByKey_${g}_userPk$`]()===h));let p=[];for(let h of c){let g=Fi.map(m=>({id:m,key:Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),visibility:"closed",isNew:!1})),f=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);p.push(f),t[`session_workspaceByKey_${f}_openAppKeys$`]([]),t[`session_workspaceByKey_${f}_userPk$`](h),g.forEach(m=>{t[`session_workspaceByKey_${f}_appById_${m.id}_appKeys$`]([m.key]),t[`session_appByKey_${m.key}_id$`](m.id),t[`session_appByKey_${m.key}_visibility$`](m.visibility),t[`session_appByKey_${m.key}_route$`]("")}),t[`session_workspaceByKey_${f}_unpinnedCoreAppIdsObj$`]({}),t[`session_workspaceByKey_${f}_pinnedAppIds$`](g.map(({id:m})=>m)),t[`session_workspaceByKey_${f}_unpinnedAppIds$`]([])}let u=n.filter(h=>!d.includes(h)).concat(p);t.session_openWorkspaceKeys$(u),t.session_workspaceKeys$(u);for(let h of d){let g=t[`session_workspaceByKey_${h}_pinnedAppIds$`]()||[],f=t[`session_workspaceByKey_${h}_unpinnedAppIds$`]()||[],m=[...new Set([...g,...f])];t[`session_workspaceByKey_${h}_unpinnedCoreAppIdsObj$`](void 0),t[`session_workspaceByKey_${h}_pinnedAppIds$`](void 0),t[`session_workspaceByKey_${h}_unpinnedAppIds$`](void 0),t[`session_workspaceByKey_${h}_userPk$`](void 0),t[`session_workspaceByKey_${h}_openAppKeys$`](void 0),m.forEach(x=>{(t[`session_workspaceByKey_${h}_appById_${x}_appKeys$`]()||[]).forEach(k=>{t[`session_appByKey_${k}_id$`](void 0),t[`session_appByKey_${k}_visibility$`](void 0),t[`session_appByKey_${k}_route$`](void 0)}),t[`session_workspaceByKey_${h}_appById_${x}_appKeys$`](void 0)})}}t.session_accountUserPks$(a),s.filter(c=>!a.includes(c)).forEach(c=>{t[`session_accountByUserPk_${c}_isReadOnly$`](void 0),t[`session_accountByUserPk_${c}_isLocked$`](void 0),t[`session_accountByUserPk_${c}_profile$`](void 0),t[`session_accountByUserPk_${c}_relays$`](void 0)})}function Cs(e){let t=`theme-${Math.random().toString(36).slice(2)}`,n={},i=`.${t} {
${Object.entries(e).map(([o,s],a,r)=>{let c=`--${o.replace(/([A-Z])/g,"-$1").toLowerCase()}`;return n[o]=`var(${c})`,`  ${c}: ${s};`+(r.length-1===a?"":`
`)}).join("")}
}
`;return[t,n,i]}var[Os,Rs,Ps]=Cs({bg:"oklch(0.12 0 256)",bgFont:"oklch(0.87 0.01 256)",header:"oklch(0.25 0.01 256)",headerBorder:"#101011",headerFont:"oklch(0.72 0 256)",subtleBg:"oklch(0.29 0.01 256)",mg:"oklch(0.22 0 256)",mgLighter:"oklch(0.25 0 256)",mgBorder:"oklch(0.35 0 256)",mgFont:"oklch(0.79 0 256)",fg:"oklch(0.35 0 256)",fgPrimary:"oklch(0.44 0.16 291.61)",fgSecondary:"oklch(0.53 0.13 56.36)",fgFont:"oklch(0.71 0.01 256)",ffg:"oklch(0.49 0.01 17.47)",accentPrimary:"oklch(0.56 0.25 302.32)",accentSecondary:"oklch(0.56 0.20 87.32)",primary:"oklch(0.65 0.20 280)",secondary:"oklch(0.70 0.15 65)",logo:"oklch(0.27 0.20 280)",counter:"oklch(0.63 0 0)",error:"oklch(0.55 0.22 25)"}),bc={defaultTheme:Ps},vc={defaultTheme:Os},yc={colors:Rs},fe={breakpoints:{mobile:"(max-width: 718px)",desktop:"(min-width: 719px)"}};var _c=Tt("aModal",function(){let e=Dt({dialogRef$:null,render:this.props.render,shouldAlwaysDisplay$:this.props.shouldAlwaysDisplay$??this.props.shouldAlwaysDisplay??!1,isOpen$:this.props.isOpen$,close:this.props.close,afterClose:this.props.afterClose});return V(({track:t})=>{t(()=>e.isOpen$.get())?e.dialogRef$().showModal():e.dialogRef$().close()},{after:"rendering"}),this.h`
    <dialog
      ref=${e.dialogRef$}
      data-name='modal'
      closedby='any'
      onclose=${e.close}
      class="scope_g7h2g1"
    >
      <style>
        .scope_g7h2g1 {
          & /* &:modal are those opened with showModal() instead of show() */ {
            container-type: normal;
            --duration: .3s;
            /* display: none; (default) */
            transition:
              overlay var(--duration) ease-in-out allow-discrete,
              display var(--duration) ease-in-out allow-discrete;
            /* reset [popover] */
            &:focus-visible { outline: 0; }
            color: initial;
            background-color: initial;
            padding: 0;
            border: 0;
            inset: initial;
            width: initial;
            height: initial;
            overflow: initial;
            /* reset [dialog] */
            inset-inline-start: initial;
            inset-inline-end: initial;
          }

          /* &:popover-open, */ &[open] /* after dialog.showModal() */ {
            /* --modal-state: open; /* only for dialog modal */
          }

          /* &:popover-open::backdrop, */ &[open]::backdrop {
            opacity: 0.6;
            backdrop-filter: blur(1px);

            @starting-style {
              opacity: 0;
              backdrop-filter: blur(0px);
            }
          }

          &::backdrop {
            /* display: none; (default) */
            opacity: 0;
            backdrop-filter: blur(0px);
            position: absolute;
            inset: 0;
            background-color: black;
            transition:
              opacity var(--duration) ease-in-out,
              backdrop-filter var(--duration) ease-in-out,
              overlay var(--duration) ease-in-out allow-discrete,
              display var(--duration) ease-in-out allow-discrete;
          }
        }
      </style>
      <div
        data-name='modalContentContainer'
        class="scope_f82h1k"
      >
        <style>
          ${`.scope_f82h1k {
            & {
              position: fixed;
              transition: var(--duration) ease-in-out;
              border-top-right-radius: 17px; /* for scrollbar */
              overflow: hidden; /* for scrollbar */

              @media ${fe.breakpoints.desktop} {
                transition-property: bottom, transform;
                bottom: 0;
                transform: translate(-50%, 100%);
                left: 50%;
                /* @container style(:popover-open), style(--modal-state: open) { */
                .scope_g7h2g1[open] & {
                  bottom: 50%;
                  transform: translate(-50%, 50%);
                  @starting-style {
                    bottom: 0;
                    transform: translate(-50%, 100%);
                  }
                }
                border-bottom-right-radius: 17px; /* for scrollbar */
              }

              @media ${fe.breakpoints.mobile} {
                transition-property: top, transform;
                transform: translate(0, 0);
                top: 100%;
                /* @container style(:popover-open), style(--modal-state: open) { */
                .scope_g7h2g1[open] & {
                  transform: translate(0, -100%);
                  @starting-style {
                    transform: translate(0, 0);
                  }
                }
              }
            }
          }`}
        </style>
        <div
          data-name='modalContent'
          class="scope_j3k1h2"
        >
          <style>
            ${`.scope_j3k1h2 {
              & {
                overflow-y: auto;
                /*
                  https://gist.github.com/adamcbrewer/5859738
                  https://stackoverflow.com/questions/5736503/how-to-make-css3-rounded-corners-hide-overflow-in-chrome-opera
                  the scroll without this ignores border-radius
                  but it will blur content
                  mask-image: -webkit-radial-gradient(circle, white, black);
                */

                display: flex;
                flex-direction: column;
                /* background-color: white; */
                min-height: 50px; /* when there is loading (dynamic content) */

                @media ${fe.breakpoints.desktop} {
                  border-radius: 17px;
                  min-width: 400px;
                  width: 800px;
                  max-width: 90vw;
                  max-width: 90dvw;
                  max-height: 90vh; /* leave 10 for browser collapsible header */
                  max-height: 90dvh;
                }

                @media ${fe.breakpoints.mobile} {
                  border-top-left-radius: 17px;
                  border-top-right-radius: 17px;
                  width: 100vw;
                  width: 100dvw;
                  max-height: 85vh;
                  max-height: 85dvh;
                }
              }

              ${(e.shouldAlwaysDisplay$.get()||"")&&`
                content-visibility: auto;
                contain-intrinsic-width: auto 400px;
                contain-intrinsic-height: auto 200px;
              `}
            }`}
          </style>
          ${(e.shouldAlwaysDisplay$.get()||e.isOpen$.get()||"")&&(e.render?.call(this)??"")}
        </div>
      </div>
    </dialog>
  `},{useShadowDOM:!1});function Ze(e){return e?Ls(e):ee("<a-modal>")}function Ls(e){return ee("<a-modal>",e)}Tt("vaultModal",function(){let e=Ze(),t=Dt(()=>({...e,shouldAlwaysDisplay$:!0,render:Ye(function(){return this.h`<vault-messenger />`})}));return this.h`<a-modal props=${t} />`});Tt("vaultMessenger",function(){let{isFirstRun$:e,vaultPort$:t,vaultIframeRef$:n,vaultIframeSrc$:i,isVaultMessengerReady$:o,widgetHeight$:s,isWorkarounEnabled$:a}=ge("vaultMessenger",()=>({isWorkarounEnabled$:!0,disableStartAtVaultHomeWorkaroundThisTime(){this.isWorkarounEnabled$(!1)},isFirstRun$:!0,vaultPort$:null,vaultIframeRef$:null,vaultIframeSrc$:"about:blank",isVaultMessengerReady$:!1,widgetHeight$:0})),r=Wt(localStorage),{config_vaultUrl$:c}=r;V(()=>{c()===void 0&&c("https://44billion.github.io/44b-vault")});let{cancelPreviousRequests:l,postVaultMessage:d}=qs(t),{isOpen$:p}=Ze();return V(({track:u})=>{let h=u(()=>p());e()||h||d({code:"CLOSED_VAULT_VIEW",payload:null},{instant:!0})}),V(({track:u})=>{let h=a();a(!0);let g=u(()=>!p());e()||g||!h||d({code:"OPEN_VAULT_HOME",payload:null},{instant:!0})}),V(()=>{e(!1)}),V(async({track:u,cleanup:h})=>{u(()=>c());let g=new AbortController;h(()=>{g.abort()});let f=new URL(c()).origin,m,x=()=>{m&&m.abort()},E=k=>{m=k,k&&k.signal.addEventListener("abort",()=>{m===k&&(m=null)},{once:!0})};n().addEventListener("load",()=>{x();let k=Ns({vaultIframe:n(),vaultOrigin:f,vaultPort$:t,abortSignal:g.signal});E(k)},{signal:g.signal}),Us({vaultIframe:n(),vaultOrigin:f,vaultPort$:t,componentSignal:g.signal,widgetHeight$:s,storage:r,stopRenderHandshake:x}),o(!0)},{after:"rendering"}),V(async({track:u})=>{let[h,g]=u(()=>[o(),c()]);h&&(i(g),l(new Error("Canceled due to new vault URL selection")))}),this.h`
    <style>
      #vault {
        border: none;
        width: 100%;
        height: 100%;
        display: block; /* ensure it's not inline */
      }
    </style>
    <iframe
      allow='clipboard-write;
             publickey-credentials-create;
             publickey-credentials-get'
      style=${{height:`${s()}px`}}
      id='vault'
      ref=${n}
      src=${i()}
    />
  `});function Us({vaultIframe:e,vaultOrigin:t,vaultPort$:n,componentSignal:i,widgetHeight$:o,storage:s,stopRenderHandshake:a}){let r=Ze(),c=null;i?.addEventListener("abort",()=>{c&&(c.close(),c=null)},{once:!0});let l;window.addEventListener("message",u=>{u.data.code!=="VAULT_READY"||u.source!==e.contentWindow||u.origin!==t||!u.ports[0]||(u.data.payload.accounts?Ln(u.data.payload.accounts,s):console.log("Missing account data on vault startup"),l?.abort(),l=new AbortController,c&&c.close(),c=u.ports[0],d({vaultPort:c,signal:AbortSignal.any([i,l.signal])}),a?.(),p(c),n(c))},{signal:i});function d({vaultPort:u,signal:h}){u.addEventListener("message",g=>{switch(g.data.code){case"CHANGE_DIMENSIONS":{o(g.data.payload.height);break}case"CLOSE_VAULT_VIEW":{r.close();break}case"SET_ACCOUNTS_STATE":{if(!g.data.payload.accounts){console.log("Missing account data on vault message");break}Ln(g.data.payload.accounts,s);break}}},{signal:h}),u.start()}function p(u){jt(u,{code:"BROWSER_READY",payload:null})}}function Ns({vaultIframe:e,vaultOrigin:t,vaultPort$:n,abortSignal:i}){if(i?.aborted)return null;let o=new AbortController,{signal:s}=o,a,r=()=>{o.signal.aborted||o.abort()};i&&i.addEventListener("abort",r,{once:!0}),s.addEventListener("abort",()=>{a&&clearTimeout(a)},{once:!0});let c=40,l=0,d=()=>{if(s.aborted)return;let p=e?.contentWindow;if(!p){r();return}if(jt(p,{code:"RENDER",payload:null},{targetOrigin:t}),n()){r();return}if(l>=c){r();return}l+=1;let u=Math.min(500,50*l);a=setTimeout(d,u)};return d(),o}function qs(e){return e&&Ms(e),ge("useRequestVaultMessage")}function Ms(e){let t=Wt(localStorage),{config_vaultUrl$:n}=t,{msgQueue$:i}=ge("useRequestVaultMessage",()=>({vaultPort$:e,vaultOrigin$(){return new URL(n()).origin},msgQueue$:{waiting:[],running:[]},postVaultMessage(l){if(!this.vaultPort$())return Promise.reject(new Error("Vault not connected"));jt(e(),l)},async requestVaultMessage(l,{timeout:d,instant:p=!1}={}){if(p)return this.vaultPort$()?Xe(this.vaultPort$(),l,{...d!=null&&{timeout:d}}):Promise.reject(new Error("Vault not connected"));let u=Date.now(),h=Promise.withResolvers();return h.promise.finally(()=>{this.msgQueue$(g=>(g.running=g.running.filter(f=>f.p!==h),{...g}))}),this.msgQueue$(g=>(g.waiting.push({msg:l,timeout:d,queuedAt:u,p:h}),{...g})),h.promise},cancelPreviousRequests(l){this.msgQueue$().running.forEach(d=>d.p.resolve({code:d.msg.code,payload:null,error:l||new Error("Canceled")}))}})),o=Ze(),{session_openWorkspaceKeys$:s}=t,a=ft(()=>{let l=s()[0];return t[`session_workspaceByKey_${l}_userPk$`]()}),r=ft(()=>a()!==t.session_defaultUserPk$()||s().length>1),c=Ye(l=>r()?!1:(o.open(),l.p.resolve({code:l.msg.code,payload:null,error:new Error("Not logged in")}),!0));V(({track:l})=>{let[d,p]=l(()=>[i(),e()]);if(!p)return;let u=Math.min(5-d.running.length,d.waiting.length),h=Date.now();for(let g=0;g<u;g++){let f=d.waiting.shift();if(d.running.push(f),c(f))return;let{msg:m,timeout:x,queuedAt:E,p:k}=d.running[d.running.length-u+g];Xe(p,m,{...x!=null&&{timeout:E+x-h}}).then($=>{k.resolve($)})}})}Tt("nappAssetsCachingProgressBar",function(){let e;try{({cachingProgress$:e}=ee("<napp-assets-caching-progress-bar>"))}catch(a){console.warn("No cachingProgress$ store found",a);return}let t=ft(()=>Object.entries(e()).filter(([a])=>!a.startsWith("_")&&(a.startsWith("/")||a.includes(".")))),n=ft(()=>t().length>0),i=ft(()=>{let a=t();if(a.length===0)return{overallProgress:0,fileList:"",fileCount:0};let r=a.reduce((p,[u,h])=>p+h.progress,0),c=Math.round(r/a.length),l=a.map(([p])=>{let u=p.split("/").pop()||p;return u.length>20?u.slice(0,17)+"...":u}),d=l.length>3?l.slice(0,3).join(", ")+`... (+${l.length-3} more)`:l.join(", ");return{overallProgress:c,fileList:d,fileCount:a.length}}),o=ft(()=>`
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: linear-gradient(90deg,
      oklch(0.62 0.22 297.62 / 0.9) 0%,
      oklch(0.62 0.22 297.1 / 0.9) ${i().overallProgress}%,
      rgba(0, 0, 0, 0.7) ${i().overallProgress}%,
      rgba(0, 0, 0, 0.7) 100%
    );
    height: 4px;
    transition: all 0.3s ease;
    opacity: ${n()?1:0};
    transform: translateY(${n()?"0":"-100%"});
  `),s=ft(()=>`
    position: absolute;
    top: 6px;
    left: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    backdrop-filter: blur(4px);
    transition: all 0.3s ease;
    opacity: ${n()?1:0};
    transform: translateY(${n()?"0":"-100%"});
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `);return this.h`
    <div style=${o()} />
    <div style=${s()}>
      Caching ${i().fileCount} asset${i().fileCount!==1?"s":""}
      (${i().overallProgress}%): ${i().fileList}
    </div>
  `});export{Wt as a,pt as b,St as c,oc as d,js as e,bc as f,vc as g,yc as h,fe as i,Ze as j,qs as k};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
