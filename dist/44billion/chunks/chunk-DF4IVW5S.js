import{a as cn,b as ln,j as pn,l as dn,m as ke,n as fn,o as At}from"./chunk-YCNW34TK.js";import{a as un}from"./chunk-KN6GOQRR.js";import{b as fi,d as A,e as V,f as Tt,g as Y}from"./chunk-K2UKPH6Q.js";function mn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Be(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function hn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");mn(e.outputLen),mn(e.blockLen)}function It(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function xn(e,t){Be(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Zt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var gn=e=>e instanceof Uint8Array;var Gt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Q=(e,t)=>e<<32-t|e>>>t,ui=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ui)throw new Error("Non little-endian hardware is not supported");function mi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Pt(e){if(typeof e=="string"&&(e=mi(e)),!gn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function vn(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!gn(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}var Ct=class{clone(){return this._cloneInto()}},Po={}.toString;function bn(e){let t=i=>e().update(Pt(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Yt(e=32){if(Zt&&typeof Zt.getRandomValues=="function")return Zt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function hi(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),a=BigInt(4294967295),r=Number(n>>o&a),s=Number(n&a),c=i?4:0,l=i?0:4;e.setUint32(t+c,r,i),e.setUint32(t+l,s,i)}var Qt=class extends Ct{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Gt(this.buffer)}update(t){It(this);let{view:n,buffer:i,blockLen:o}=this;t=Pt(t);let a=t.length;for(let r=0;r<a;){let s=Math.min(o-this.pos,a-r);if(s===o){let c=Gt(t);for(;o<=a-r;r+=o)this.process(c,r);continue}i.set(t.subarray(r,r+s),this.pos),this.pos+=s,r+=s,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){It(this),xn(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:a}=this,{pos:r}=this;n[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>o-r&&(this.process(i,0),r=0);for(let p=r;p<o;p++)n[p]=0;hi(i,o-8,BigInt(this.length*8),a),this.process(i,0);let s=Gt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)s.setUint32(4*p,d[p],a)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:a,destroyed:r,pos:s}=this;return t.length=o,t.pos=s,t.finished=a,t.destroyed=r,o%n&&t.buffer.set(i),t}};var xi=(e,t,n)=>e&t^~e&n,gi=(e,t,n)=>e&t^e&n^t&n,vi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),pt=new Uint32Array(64),Se=class extends Qt{constructor(){super(64,32,8,!1),this.A=lt[0]|0,this.B=lt[1]|0,this.C=lt[2]|0,this.D=lt[3]|0,this.E=lt[4]|0,this.F=lt[5]|0,this.G=lt[6]|0,this.H=lt[7]|0}get(){let{A:t,B:n,C:i,D:o,E:a,F:r,G:s,H:c}=this;return[t,n,i,o,a,r,s,c]}set(t,n,i,o,a,r,s,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=a|0,this.F=r|0,this.G=s|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)pt[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let h=pt[p-15],v=pt[p-2],x=Q(h,7)^Q(h,18)^h>>>3,u=Q(v,17)^Q(v,19)^v>>>10;pt[p]=u+pt[p-7]+x+pt[p-16]|0}let{A:i,B:o,C:a,D:r,E:s,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let h=Q(s,6)^Q(s,11)^Q(s,25),v=d+h+xi(s,c,l)+vi[p]+pt[p]|0,u=(Q(i,2)^Q(i,13)^Q(i,22))+gi(i,o,a)|0;d=l,l=c,c=s,s=r+v|0,r=a,a=o,o=i,i=v+u|0}i=i+this.A|0,o=o+this.B|0,a=a+this.C|0,r=r+this.D|0,s=s+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,a,r,s,c,l,d)}roundClean(){pt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Xt=bn(()=>new Se);var Ie={};fi(Ie,{bitGet:()=>Si,bitLen:()=>Bi,bitMask:()=>$t,bitSet:()=>ji,bytesToHex:()=>gt,bytesToNumberBE:()=>U,bytesToNumberLE:()=>te,concatBytes:()=>nt,createHmacDrbg:()=>Ae,ensureBytes:()=>z,equalBytes:()=>Ei,hexToBytes:()=>vt,hexToNumber:()=>Te,numberToBytesBE:()=>X,numberToBytesLE:()=>ee,numberToHexUnpadded:()=>En,numberToVarBytesBE:()=>yi,utf8ToBytes:()=>ki,validateObject:()=>dt});var yn=BigInt(0),Ft=BigInt(1),bi=BigInt(2),Jt=e=>e instanceof Uint8Array,wi=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function gt(e){if(!Jt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=wi[e[n]];return t}function En(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function Te(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function vt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let i=0;i<n.length;i++){let o=i*2,a=e.slice(o,o+2),r=Number.parseInt(a,16);if(Number.isNaN(r)||r<0)throw new Error("Invalid byte sequence");n[i]=r}return n}function U(e){return Te(gt(e))}function te(e){if(!Jt(e))throw new Error("Uint8Array expected");return Te(gt(Uint8Array.from(e).reverse()))}function X(e,t){return vt(e.toString(16).padStart(t*2,"0"))}function ee(e,t){return X(e,t).reverse()}function yi(e){return vt(En(e))}function z(e,t,n){let i;if(typeof t=="string")try{i=vt(t)}catch(a){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${a}`)}else if(Jt(t))i=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=i.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return i}function nt(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!Jt(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}function Ei(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ki(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Bi(e){let t;for(t=0;e>yn;e>>=Ft,t+=1);return t}function Si(e,t){return e>>BigInt(t)&Ft}var ji=(e,t,n)=>e|(n?Ft:yn)<<BigInt(t),$t=e=>(bi<<BigInt(e-1))-Ft,je=e=>new Uint8Array(e),wn=e=>Uint8Array.from(e);function Ae(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=je(e),o=je(e),a=0,r=()=>{i.fill(1),o.fill(0),a=0},s=(...p)=>n(o,i,...p),c=(p=je())=>{o=s(wn([0]),p),i=s(),p.length!==0&&(o=s(wn([1]),p),i=s())},l=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,h=[];for(;p<t;){i=s();let v=i.slice();h.push(v),p+=i.length}return nt(...h)};return(p,h)=>{r(),c(p);let v;for(;!(v=h(l()));)c();return r(),v}}var Ti={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function dt(e,t,n={}){let i=(o,a,r)=>{let s=Ti[a];if(typeof s!="function")throw new Error(`Invalid validator "${a}", expected function`);let c=e[o];if(!(r&&c===void 0)&&!s(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${a}`)};for(let[o,a]of Object.entries(t))i(o,a,!1);for(let[o,a]of Object.entries(n))i(o,a,!0);return e}var _=BigInt(0),O=BigInt(1),bt=BigInt(2),Ai=BigInt(3),Ce=BigInt(4),kn=BigInt(5),Bn=BigInt(8),Ii=BigInt(9),Ci=BigInt(16);function N(e,t){let n=e%t;return n>=_?n:t+n}function qi(e,t,n){if(n<=_||t<_)throw new Error("Expected power/modulo > 0");if(n===O)return _;let i=O;for(;t>_;)t&O&&(i=i*e%n),e=e*e%n,t>>=O;return i}function M(e,t,n){let i=e;for(;t-- >_;)i*=i,i%=n;return i}function ne(e,t){if(e===_||t<=_)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=N(e,t),i=t,o=_,a=O,r=O,s=_;for(;n!==_;){let l=i/n,d=i%n,p=o-r*l,h=a-s*l;i=n,n=d,o=r,a=s,r=p,s=h}if(i!==O)throw new Error("invert: does not exist");return N(o,t)}function Ri(e){let t=(e-O)/bt,n,i,o;for(n=e-O,i=0;n%bt===_;n/=bt,i++);for(o=bt;o<e&&qi(o,t,e)!==e-O;o++);if(i===1){let r=(e+O)/Ce;return function(c,l){let d=c.pow(l,r);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}let a=(n+O)/bt;return function(s,c){if(s.pow(c,t)===s.neg(s.ONE))throw new Error("Cannot find square root");let l=i,d=s.pow(s.mul(s.ONE,o),n),p=s.pow(c,a),h=s.pow(c,n);for(;!s.eql(h,s.ONE);){if(s.eql(h,s.ZERO))return s.ZERO;let v=1;for(let u=s.sqr(h);v<l&&!s.eql(u,s.ONE);v++)u=s.sqr(u);let x=s.pow(d,O<<BigInt(l-v-1));d=s.sqr(x),p=s.mul(p,x),h=s.mul(h,d),l=v}return p}}function Oi(e){if(e%Ce===Ai){let t=(e+O)/Ce;return function(i,o){let a=i.pow(o,t);if(!i.eql(i.sqr(a),o))throw new Error("Cannot find square root");return a}}if(e%Bn===kn){let t=(e-kn)/Bn;return function(i,o){let a=i.mul(o,bt),r=i.pow(a,t),s=i.mul(o,r),c=i.mul(i.mul(s,bt),r),l=i.mul(s,i.sub(c,i.ONE));if(!i.eql(i.sqr(l),o))throw new Error("Cannot find square root");return l}}return e%Ci,Ri(e)}var zi=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qe(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=zi.reduce((i,o)=>(i[o]="function",i),t);return dt(e,n)}function Ni(e,t,n){if(n<_)throw new Error("Expected power > 0");if(n===_)return e.ONE;if(n===O)return t;let i=e.ONE,o=t;for(;n>_;)n&O&&(i=e.mul(i,o)),o=e.sqr(o),n>>=O;return i}function _i(e,t){let n=new Array(t.length),i=t.reduce((a,r,s)=>e.is0(r)?a:(n[s]=a,e.mul(a,r)),e.ONE),o=e.inv(i);return t.reduceRight((a,r,s)=>e.is0(r)?a:(n[s]=e.mul(a,n[s]),e.mul(a,r)),o),n}function Re(e,t){let n=t!==void 0?t:e.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function Sn(e,t,n=!1,i={}){if(e<=_)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:a}=Re(e,t);if(a>2048)throw new Error("Field lengths over 2048 bytes are not supported");let r=Oi(e),s=Object.freeze({ORDER:e,BITS:o,BYTES:a,MASK:$t(o),ZERO:_,ONE:O,create:c=>N(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return _<=c&&c<e},is0:c=>c===_,isOdd:c=>(c&O)===O,neg:c=>N(-c,e),eql:(c,l)=>c===l,sqr:c=>N(c*c,e),add:(c,l)=>N(c+l,e),sub:(c,l)=>N(c-l,e),mul:(c,l)=>N(c*l,e),pow:(c,l)=>Ni(s,c,l),div:(c,l)=>N(c*ne(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ne(c,e),sqrt:i.sqrt||(c=>r(s,c)),invertBatch:c=>_i(s,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>n?ee(c,a):X(c,a),fromBytes:c=>{if(c.length!==a)throw new Error(`Fp.fromBytes: expected ${a}, got ${c.length}`);return n?te(c):U(c)}});return Object.freeze(s)}function jn(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Oe(e){let t=jn(e);return t+Math.ceil(t/2)}function Tn(e,t,n=!1){let i=e.length,o=jn(t),a=Oe(t);if(i<16||i<a||i>1024)throw new Error(`expected ${a}-1024 bytes of input, got ${i}`);let r=n?U(e):te(e),s=N(r,t-O)+O;return n?ee(s,o):X(s,o)}var Ui=BigInt(0),ze=BigInt(1);function An(e,t){let n=(o,a)=>{let r=a.negate();return o?r:a},i=o=>{let a=Math.ceil(t/o)+1,r=2**(o-1);return{windows:a,windowSize:r}};return{constTimeNegate:n,unsafeLadder(o,a){let r=e.ZERO,s=o;for(;a>Ui;)a&ze&&(r=r.add(s)),s=s.double(),a>>=ze;return r},precomputeWindow(o,a){let{windows:r,windowSize:s}=i(a),c=[],l=o,d=l;for(let p=0;p<r;p++){d=l,c.push(d);for(let h=1;h<s;h++)d=d.add(l),c.push(d);l=d.double()}return c},wNAF(o,a,r){let{windows:s,windowSize:c}=i(o),l=e.ZERO,d=e.BASE,p=BigInt(2**o-1),h=2**o,v=BigInt(o);for(let x=0;x<s;x++){let u=x*c,f=Number(r&p);r>>=v,f>c&&(f-=h,r+=ze);let m=u,w=u+Math.abs(f)-1,E=x%2!==0,j=f<0;f===0?d=d.add(n(E,a[m])):l=l.add(n(j,a[w]))}return{p:l,f:d}},wNAFCached(o,a,r,s){let c=o._WINDOW_SIZE||1,l=a.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&a.set(o,s(l))),this.wNAF(c,l,r)}}}function Ne(e){return qe(e.Fp),dt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Re(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function Pi(e){let t=Ne(e);dt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:i,a:o}=t;if(n){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:$i,hexToBytes:Hi}=Ie,wt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=wt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],i=e.subarray(2,n+2);if(!n||i.length!==n)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:$i(i),l:e.subarray(n+2)}},toSig(e){let{Err:t}=wt,n=typeof e=="string"?Hi(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let i=n.length;if(i<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==i-2)throw new t("Invalid signature: incorrect length");let{d:o,l:a}=wt._parseInt(n.subarray(2)),{d:r,l:s}=wt._parseInt(a);if(s.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:r}},hexFromSig(e){let t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let d=l.toString(16);return d.length&1?`0${d}`:d},i=t(n(e.s)),o=t(n(e.r)),a=i.length/2,r=o.length/2,s=n(a),c=n(r);return`30${n(r+a+4)}02${c}${o}02${s}${i}`}},it=BigInt(0),K=BigInt(1),ta=BigInt(2),In=BigInt(3),ea=BigInt(4);function Di(e){let t=Pi(e),{Fp:n}=t,i=t.toBytes||((x,u,f)=>{let m=u.toAffine();return nt(Uint8Array.from([4]),n.toBytes(m.x),n.toBytes(m.y))}),o=t.fromBytes||(x=>{let u=x.subarray(1),f=n.fromBytes(u.subarray(0,n.BYTES)),m=n.fromBytes(u.subarray(n.BYTES,2*n.BYTES));return{x:f,y:m}});function a(x){let{a:u,b:f}=t,m=n.sqr(x),w=n.mul(m,x);return n.add(n.add(w,n.mul(x,u)),f)}if(!n.eql(n.sqr(t.Gy),a(t.Gx)))throw new Error("bad generator point: equation left != right");function r(x){return typeof x=="bigint"&&it<x&&x<t.n}function s(x){if(!r(x))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(x){let{allowedPrivateKeyLengths:u,nByteLength:f,wrapPrivateKey:m,n:w}=t;if(u&&typeof x!="bigint"){if(x instanceof Uint8Array&&(x=gt(x)),typeof x!="string"||!u.includes(x.length))throw new Error("Invalid key");x=x.padStart(f*2,"0")}let E;try{E=typeof x=="bigint"?x:U(z("private key",x,f))}catch{throw new Error(`private key must be ${f} bytes, hex or bigint, not ${typeof x}`)}return m&&(E=N(E,w)),s(E),E}let l=new Map;function d(x){if(!(x instanceof p))throw new Error("ProjectivePoint expected")}class p{constructor(u,f,m){if(this.px=u,this.py=f,this.pz=m,u==null||!n.isValid(u))throw new Error("x required");if(f==null||!n.isValid(f))throw new Error("y required");if(m==null||!n.isValid(m))throw new Error("z required")}static fromAffine(u){let{x:f,y:m}=u||{};if(!u||!n.isValid(f)||!n.isValid(m))throw new Error("invalid affine point");if(u instanceof p)throw new Error("projective point not allowed");let w=E=>n.eql(E,n.ZERO);return w(f)&&w(m)?p.ZERO:new p(f,m,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(u){let f=n.invertBatch(u.map(m=>m.pz));return u.map((m,w)=>m.toAffine(f[w])).map(p.fromAffine)}static fromHex(u){let f=p.fromAffine(o(z("pointHex",u)));return f.assertValidity(),f}static fromPrivateKey(u){return p.BASE.multiply(c(u))}_setWindowSize(u){this._WINDOW_SIZE=u,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:u,y:f}=this.toAffine();if(!n.isValid(u)||!n.isValid(f))throw new Error("bad point: x or y not FE");let m=n.sqr(f),w=a(u);if(!n.eql(m,w))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:u}=this.toAffine();if(n.isOdd)return!n.isOdd(u);throw new Error("Field doesn't support isOdd")}equals(u){d(u);let{px:f,py:m,pz:w}=this,{px:E,py:j,pz:T}=u,y=n.eql(n.mul(f,T),n.mul(E,w)),k=n.eql(n.mul(m,T),n.mul(j,w));return y&&k}negate(){return new p(this.px,n.neg(this.py),this.pz)}double(){let{a:u,b:f}=t,m=n.mul(f,In),{px:w,py:E,pz:j}=this,T=n.ZERO,y=n.ZERO,k=n.ZERO,S=n.mul(w,w),W=n.mul(E,E),R=n.mul(j,j),I=n.mul(w,E);return I=n.add(I,I),k=n.mul(w,j),k=n.add(k,k),T=n.mul(u,k),y=n.mul(m,R),y=n.add(T,y),T=n.sub(W,y),y=n.add(W,y),y=n.mul(T,y),T=n.mul(I,T),k=n.mul(m,k),R=n.mul(u,R),I=n.sub(S,R),I=n.mul(u,I),I=n.add(I,k),k=n.add(S,S),S=n.add(k,S),S=n.add(S,R),S=n.mul(S,I),y=n.add(y,S),R=n.mul(E,j),R=n.add(R,R),S=n.mul(R,I),T=n.sub(T,S),k=n.mul(R,W),k=n.add(k,k),k=n.add(k,k),new p(T,y,k)}add(u){d(u);let{px:f,py:m,pz:w}=this,{px:E,py:j,pz:T}=u,y=n.ZERO,k=n.ZERO,S=n.ZERO,W=t.a,R=n.mul(t.b,In),I=n.mul(f,E),P=n.mul(m,j),$=n.mul(w,T),at=n.add(f,m),g=n.add(E,j);at=n.mul(at,g),g=n.add(I,P),at=n.sub(at,g),g=n.add(f,w);let b=n.add(E,T);return g=n.mul(g,b),b=n.add(I,$),g=n.sub(g,b),b=n.add(m,w),y=n.add(j,T),b=n.mul(b,y),y=n.add(P,$),b=n.sub(b,y),S=n.mul(W,g),y=n.mul(R,$),S=n.add(y,S),y=n.sub(P,S),S=n.add(P,S),k=n.mul(y,S),P=n.add(I,I),P=n.add(P,I),$=n.mul(W,$),g=n.mul(R,g),P=n.add(P,$),$=n.sub(I,$),$=n.mul(W,$),g=n.add(g,$),I=n.mul(P,g),k=n.add(k,I),I=n.mul(b,g),y=n.mul(at,y),y=n.sub(y,I),I=n.mul(at,P),S=n.mul(b,S),S=n.add(S,I),new p(y,k,S)}subtract(u){return this.add(u.negate())}is0(){return this.equals(p.ZERO)}wNAF(u){return v.wNAFCached(this,l,u,f=>{let m=n.invertBatch(f.map(w=>w.pz));return f.map((w,E)=>w.toAffine(m[E])).map(p.fromAffine)})}multiplyUnsafe(u){let f=p.ZERO;if(u===it)return f;if(s(u),u===K)return this;let{endo:m}=t;if(!m)return v.unsafeLadder(this,u);let{k1neg:w,k1:E,k2neg:j,k2:T}=m.splitScalar(u),y=f,k=f,S=this;for(;E>it||T>it;)E&K&&(y=y.add(S)),T&K&&(k=k.add(S)),S=S.double(),E>>=K,T>>=K;return w&&(y=y.negate()),j&&(k=k.negate()),k=new p(n.mul(k.px,m.beta),k.py,k.pz),y.add(k)}multiply(u){s(u);let f=u,m,w,{endo:E}=t;if(E){let{k1neg:j,k1:T,k2neg:y,k2:k}=E.splitScalar(f),{p:S,f:W}=this.wNAF(T),{p:R,f:I}=this.wNAF(k);S=v.constTimeNegate(j,S),R=v.constTimeNegate(y,R),R=new p(n.mul(R.px,E.beta),R.py,R.pz),m=S.add(R),w=W.add(I)}else{let{p:j,f:T}=this.wNAF(f);m=j,w=T}return p.normalizeZ([m,w])[0]}multiplyAndAddUnsafe(u,f,m){let w=p.BASE,E=(T,y)=>y===it||y===K||!T.equals(w)?T.multiplyUnsafe(y):T.multiply(y),j=E(this,f).add(E(u,m));return j.is0()?void 0:j}toAffine(u){let{px:f,py:m,pz:w}=this,E=this.is0();u==null&&(u=E?n.ONE:n.inv(w));let j=n.mul(f,u),T=n.mul(m,u),y=n.mul(w,u);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(y,n.ONE))throw new Error("invZ was invalid");return{x:j,y:T}}isTorsionFree(){let{h:u,isTorsionFree:f}=t;if(u===K)return!0;if(f)return f(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:u,clearCofactor:f}=t;return u===K?this:f?f(p,this):this.multiplyUnsafe(t.h)}toRawBytes(u=!0){return this.assertValidity(),i(p,this,u)}toHex(u=!0){return gt(this.toRawBytes(u))}}p.BASE=new p(t.Gx,t.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);let h=t.nBitLength,v=An(p,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:a,isWithinCurveOrder:r}}function Mi(e){let t=Ne(e);return dt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Cn(e){let t=Mi(e),{Fp:n,n:i}=t,o=n.BYTES+1,a=2*n.BYTES+1;function r(g){return it<g&&g<n.ORDER}function s(g){return N(g,i)}function c(g){return ne(g,i)}let{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:p,isWithinCurveOrder:h}=Di({...t,toBytes(g,b,B){let q=b.toAffine(),C=n.toBytes(q.x),L=nt;return B?L(Uint8Array.from([b.hasEvenY()?2:3]),C):L(Uint8Array.from([4]),C,n.toBytes(q.y))},fromBytes(g){let b=g.length,B=g[0],q=g.subarray(1);if(b===o&&(B===2||B===3)){let C=U(q);if(!r(C))throw new Error("Point is not on curve");let L=p(C),H=n.sqrt(L),D=(H&K)===K;return(B&1)===1!==D&&(H=n.neg(H)),{x:C,y:H}}else if(b===a&&B===4){let C=n.fromBytes(q.subarray(0,n.BYTES)),L=n.fromBytes(q.subarray(n.BYTES,2*n.BYTES));return{x:C,y:L}}else throw new Error(`Point of length ${b} was invalid. Expected ${o} compressed bytes or ${a} uncompressed bytes`)}}),v=g=>gt(X(g,t.nByteLength));function x(g){let b=i>>K;return g>b}function u(g){return x(g)?s(-g):g}let f=(g,b,B)=>U(g.slice(b,B));class m{constructor(b,B,q){this.r=b,this.s=B,this.recovery=q,this.assertValidity()}static fromCompact(b){let B=t.nByteLength;return b=z("compactSignature",b,B*2),new m(f(b,0,B),f(b,B,2*B))}static fromDER(b){let{r:B,s:q}=wt.toSig(z("DER",b));return new m(B,q)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new m(this.r,this.s,b)}recoverPublicKey(b){let{r:B,s:q,recovery:C}=this,L=k(z("msgHash",b));if(C==null||![0,1,2,3].includes(C))throw new Error("recovery id invalid");let H=C===2||C===3?B+t.n:B;if(H>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let D=(C&1)===0?"02":"03",st=l.fromHex(D+v(H)),rt=c(H),Bt=s(-L*rt),Ut=s(q*rt),ct=l.BASE.multiplyAndAddUnsafe(st,Bt,Ut);if(!ct)throw new Error("point at infinify");return ct.assertValidity(),ct}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return vt(this.toDERHex())}toDERHex(){return wt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return vt(this.toCompactHex())}toCompactHex(){return v(this.r)+v(this.s)}}let w={isValidPrivateKey(g){try{return d(g),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{let g=Oe(t.n);return Tn(t.randomBytes(g),t.n)},precompute(g=8,b=l.BASE){return b._setWindowSize(g),b.multiply(BigInt(3)),b}};function E(g,b=!0){return l.fromPrivateKey(g).toRawBytes(b)}function j(g){let b=g instanceof Uint8Array,B=typeof g=="string",q=(b||B)&&g.length;return b?q===o||q===a:B?q===2*o||q===2*a:g instanceof l}function T(g,b,B=!0){if(j(g))throw new Error("first arg must be private key");if(!j(b))throw new Error("second arg must be public key");return l.fromHex(b).multiply(d(g)).toRawBytes(B)}let y=t.bits2int||function(g){let b=U(g),B=g.length*8-t.nBitLength;return B>0?b>>BigInt(B):b},k=t.bits2int_modN||function(g){return s(y(g))},S=$t(t.nBitLength);function W(g){if(typeof g!="bigint")throw new Error("bigint expected");if(!(it<=g&&g<S))throw new Error(`bigint expected < 2^${t.nBitLength}`);return X(g,t.nByteLength)}function R(g,b,B=I){if(["recovered","canonical"].some(xt=>xt in B))throw new Error("sign() legacy options not supported");let{hash:q,randomBytes:C}=t,{lowS:L,prehash:H,extraEntropy:D}=B;L==null&&(L=!0),g=z("msgHash",g),H&&(g=z("prehashed msgHash",q(g)));let st=k(g),rt=d(b),Bt=[W(rt),W(st)];if(D!=null){let xt=D===!0?C(n.BYTES):D;Bt.push(z("extraEntropy",xt))}let Ut=nt(...Bt),ct=st;function Ee(xt){let St=y(xt);if(!h(St))return;let an=c(St),tt=l.BASE.multiply(St).toAffine(),jt=s(tt.x);if(jt===it)return;let Kt=s(an*s(ct+jt*rt));if(Kt===it)return;let sn=(tt.x===jt?0:2)|Number(tt.y&K),rn=Kt;return L&&x(Kt)&&(rn=u(Kt),sn^=1),new m(jt,rn,sn)}return{seed:Ut,k2sig:Ee}}let I={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function $(g,b,B=I){let{seed:q,k2sig:C}=R(g,b,B),L=t;return Ae(L.hash.outputLen,L.nByteLength,L.hmac)(q,C)}l.BASE._setWindowSize(8);function at(g,b,B,q=P){let C=g;if(b=z("msgHash",b),B=z("publicKey",B),"strict"in q)throw new Error("options.strict was renamed to lowS");let{lowS:L,prehash:H}=q,D,st;try{if(typeof C=="string"||C instanceof Uint8Array)try{D=m.fromDER(C)}catch(tt){if(!(tt instanceof wt.Err))throw tt;D=m.fromCompact(C)}else if(typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint"){let{r:tt,s:jt}=C;D=new m(tt,jt)}else throw new Error("PARSE");st=l.fromHex(B)}catch(tt){if(tt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&D.hasHighS())return!1;H&&(b=t.hash(b));let{r:rt,s:Bt}=D,Ut=k(b),ct=c(Bt),Ee=s(Ut*ct),xt=s(rt*ct),St=l.BASE.multiplyAndAddUnsafe(st,Ee,xt)?.toAffine();return St?s(St.x)===rt:!1}return{CURVE:t,getPublicKey:E,getSharedSecret:T,sign:$,verify:at,ProjectivePoint:l,Signature:m,utils:w}}var ie=class extends Ct{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,hn(t);let i=Pt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,a=new Uint8Array(o);a.set(i.length>o?t.create().update(i).digest():i);for(let r=0;r<a.length;r++)a[r]^=54;this.iHash.update(a),this.oHash=t.create();for(let r=0;r<a.length;r++)a[r]^=106;this.oHash.update(a),a.fill(0)}update(t){return It(this),this.iHash.update(t),this}digestInto(t){It(this),Be(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:i,finished:o,destroyed:a,blockLen:r,outputLen:s}=this;return t=t,t.finished=o,t.destroyed=a,t.blockLen=r,t.outputLen=s,t.oHash=n._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},_e=(e,t,n)=>new ie(e,t).update(n).digest();_e.create=(e,t)=>new ie(e,t);function Wi(e){return{hash:e,hmac:(t,...n)=>_e(e,t,vn(...n)),randomBytes:Yt}}function qn(e,t){let n=i=>Cn({...e,...Wi(i)});return Object.freeze({...n(t),create:n})}var re=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),oe=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),zn=BigInt(1),ae=BigInt(2),Rn=(e,t)=>(e+t/ae)/t;function Nn(e){let t=re,n=BigInt(3),i=BigInt(6),o=BigInt(11),a=BigInt(22),r=BigInt(23),s=BigInt(44),c=BigInt(88),l=e*e*e%t,d=l*l*e%t,p=M(d,n,t)*d%t,h=M(p,n,t)*d%t,v=M(h,ae,t)*l%t,x=M(v,o,t)*v%t,u=M(x,a,t)*x%t,f=M(u,s,t)*u%t,m=M(f,c,t)*f%t,w=M(m,s,t)*u%t,E=M(w,n,t)*d%t,j=M(E,r,t)*x%t,T=M(j,i,t)*l%t,y=M(T,ae,t);if(!Ue.eql(Ue.sqr(y),e))throw new Error("Cannot find square root");return y}var Ue=Sn(re,void 0,void 0,{sqrt:Nn}),He=qn({a:BigInt(0),b:BigInt(7),Fp:Ue,n:oe,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=oe,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-zn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),a=n,r=BigInt("0x100000000000000000000000000000000"),s=Rn(a*e,t),c=Rn(-i*e,t),l=N(e-s*n-c*o,t),d=N(-s*i-c*a,t),p=l>r,h=d>r;if(p&&(l=t-l),h&&(d=t-d),l>r||d>r)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:p,k1:l,k2neg:h,k2:d}}}},Xt),ce=BigInt(0),_n=e=>typeof e=="bigint"&&ce<e&&e<re,Vi=e=>typeof e=="bigint"&&ce<e&&e<oe,On={};function se(e,...t){let n=On[e];if(n===void 0){let i=Xt(Uint8Array.from(e,o=>o.charCodeAt(0)));n=nt(i,i),On[e]=n}return Xt(nt(n,...t))}var De=e=>e.toRawBytes(!0).slice(1),Pe=e=>X(e,32),Le=e=>N(e,re),Ht=e=>N(e,oe),Me=He.ProjectivePoint,Ki=(e,t,n)=>Me.BASE.multiplyAndAddUnsafe(e,t,n);function $e(e){let t=He.utils.normPrivateKeyToScalar(e),n=Me.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Ht(-t),bytes:De(n)}}function Ln(e){if(!_n(e))throw new Error("bad x: need 0 < x < p");let t=Le(e*e),n=Le(t*e+BigInt(7)),i=Nn(n);i%ae!==ce&&(i=Le(-i));let o=new Me(e,i,zn);return o.assertValidity(),o}function Un(...e){return Ht(U(se("BIP0340/challenge",...e)))}function Zi(e){return $e(e).bytes}function Gi(e,t,n=Yt(32)){let i=z("message",e),{bytes:o,scalar:a}=$e(t),r=z("auxRand",n,32),s=Pe(a^U(se("BIP0340/aux",r))),c=se("BIP0340/nonce",s,o,i),l=Ht(U(c));if(l===ce)throw new Error("sign failed: k is zero");let{bytes:d,scalar:p}=$e(l),h=Un(d,o,i),v=new Uint8Array(64);if(v.set(d,0),v.set(Pe(Ht(p+h*a)),32),!Pn(v,i,o))throw new Error("sign: Invalid signature produced");return v}function Pn(e,t,n){let i=z("signature",e,64),o=z("message",t),a=z("publicKey",n,32);try{let r=Ln(U(a)),s=U(i.subarray(0,32));if(!_n(s))return!1;let c=U(i.subarray(32,64));if(!Vi(c))return!1;let l=Un(Pe(s),De(r),o),d=Ki(r,c,Ht(-l));return!(!d||!d.hasEvenY()||d.toAffine().x!==s)}catch{return!1}}var qt={getPublicKey:Zi,sign:Gi,verify:Pn,utils:{randomPrivateKey:He.utils.randomPrivateKey,lift_x:Ln,pointToBytes:De,numberToBytesBE:X,bytesToNumberBE:U,taggedHash:se,mod:N}};var Yi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var $n=e=>e instanceof Uint8Array;var pe=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),F=(e,t)=>e<<32-t|e>>>t,Qi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Qi)throw new Error("Non little-endian hardware is not supported");var Xi=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Dt(e){if(!$n(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Xi[e[n]];return t}function Fi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function We(e){if(typeof e=="string"&&(e=Fi(e)),!$n(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var le=class{clone(){return this._cloneInto()}};function Ve(e){let t=i=>e().update(We(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Ke(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ji(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Hn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function to(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ke(e.outputLen),Ke(e.blockLen)}function eo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function no(e,t){Hn(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var io={number:Ke,bool:Ji,bytes:Hn,hash:to,exists:eo,output:no},de=io;function oo(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),a=BigInt(4294967295),r=Number(n>>o&a),s=Number(n&a),c=i?4:0,l=i?0:4;e.setUint32(t+c,r,i),e.setUint32(t+l,s,i)}var fe=class extends le{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=pe(this.buffer)}update(t){de.exists(this);let{view:n,buffer:i,blockLen:o}=this;t=We(t);let a=t.length;for(let r=0;r<a;){let s=Math.min(o-this.pos,a-r);if(s===o){let c=pe(t);for(;o<=a-r;r+=o)this.process(c,r);continue}i.set(t.subarray(r,r+s),this.pos),this.pos+=s,r+=s,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){de.exists(this),de.output(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:a}=this,{pos:r}=this;n[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>o-r&&(this.process(i,0),r=0);for(let p=r;p<o;p++)n[p]=0;oo(i,o-8,BigInt(this.length*8),a),this.process(i,0);let s=pe(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)s.setUint32(4*p,d[p],a)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:a,destroyed:r,pos:s}=this;return t.length=o,t.pos=s,t.finished=a,t.destroyed=r,o%n&&t.buffer.set(i),t}};var ao=(e,t,n)=>e&t^~e&n,so=(e,t,n)=>e&t^e&n^t&n,ro=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ft=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),ue=class extends fe{constructor(){super(64,32,8,!1),this.A=ft[0]|0,this.B=ft[1]|0,this.C=ft[2]|0,this.D=ft[3]|0,this.E=ft[4]|0,this.F=ft[5]|0,this.G=ft[6]|0,this.H=ft[7]|0}get(){let{A:t,B:n,C:i,D:o,E:a,F:r,G:s,H:c}=this;return[t,n,i,o,a,r,s,c]}set(t,n,i,o,a,r,s,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=a|0,this.F=r|0,this.G=s|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)ut[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let h=ut[p-15],v=ut[p-2],x=F(h,7)^F(h,18)^h>>>3,u=F(v,17)^F(v,19)^v>>>10;ut[p]=u+ut[p-7]+x+ut[p-16]|0}let{A:i,B:o,C:a,D:r,E:s,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let h=F(s,6)^F(s,11)^F(s,25),v=d+h+ao(s,c,l)+ro[p]+ut[p]|0,u=(F(i,2)^F(i,13)^F(i,22))+so(i,o,a)|0;d=l,l=c,c=s,s=r+v|0,r=a,a=o,o=i,i=v+u|0}i=i+this.A|0,o=o+this.B|0,a=a+this.C|0,r=r+this.D|0,s=s+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,a,r,s,c,l,d)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Ze=class extends ue{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Dn=Ve(()=>new ue),Sa=Ve(()=>new Ze);var Rt=Symbol("verified"),co=e=>e instanceof Object;function lo(e){if(!co(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let i=0;i<n.length;i++)if(typeof n[i]!="string")return!1}return!0}var Oa=new TextDecoder("utf-8"),po=new TextEncoder;function fo(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var uo=class{value;next=null;prev=null;constructor(e){this.value=e}},mo=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new uo(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},ho=class{generateSecretKey(){return qt.utils.randomPrivateKey()}getPublicKey(e){return Dt(qt.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=Dt(qt.getPublicKey(t)),n.id=Ge(n),n.sig=Dt(qt.sign(Ge(n),t)),n[Rt]=!0,n}verifyEvent(e){if(typeof e[Rt]=="boolean")return e[Rt];let t=Ge(e);if(t!==e.id)return e[Rt]=!1,!1;try{let n=qt.verify(e.sig,t,e.pubkey);return e[Rt]=n,n}catch{return e[Rt]=!1,!1}}};function xo(e){if(!lo(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Ge(e){let t=Dn(po.encode(xo(e)));return Dt(t)}var me=new ho,za=me.generateSecretKey,Na=me.getPublicKey,_a=me.finalizeEvent,go=me.verifyEvent,vo=22242;function bo(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let i=n.slice(1),o=e[`#${i}`];if(o&&!t.tags.find(([a,r])=>a===n.slice(1)&&o.indexOf(r)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function wo(e,t){for(let n=0;n<e.length;n++)if(bo(e[n],t))return!0;return!1}function yo(e,t){let n=t.length+3,i=e.indexOf(`"${t}":`)+n,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function Eo(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let i=t+7+1+n,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let a=i+1+o;return e.slice(i+1,a)}function ko(e,t){return{kind:vo,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Bo(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var Mn=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Wn=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new mo;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=fo(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){let n=new Wn(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{let n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,this.ws?.close(),this.onclose?.()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Bo();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=Eo(e);if(t){let n=this.openSubs.get(t);if(!n)return;let i=yo(e,"id"),o=n.alreadyHaveEvent?.(i);if(n.receivedEvent?.(this,i),o)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{let i=this.openSubs.get(n[1]),o=n[2];this.verifyEvent(o)&&wo(i.filters,o)&&i.onevent(o);return}case"COUNT":{let i=n[1],o=n[2],a=this.openCountRequests.get(i);a&&(a.resolve(o.count),this.openCountRequests.delete(i));return}case"EOSE":{let i=this.openSubs.get(n[1]);if(!i)return;i.receivedEose();return}case"OK":{let i=n[1],o=n[2],a=n[3],r=this.openEventPublishes.get(i);r&&(clearTimeout(r.timeout),o?r.resolve(a):r.reject(new Error(a)),this.openEventPublishes.delete(i));return}case"CLOSED":{let i=n[1],o=this.openSubs.get(i);if(!o)return;o.closed=!0,o.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Mn(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){let t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,i)=>{try{let o=await e(ko(this.url,t)),a=setTimeout(()=>{let r=this.openEventPublishes.get(o.id);r&&(r.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:i,timeout:a}),this.send('["AUTH",'+JSON.stringify(o)+"]")}catch(o){console.warn("subscribe auth function failed:",o)}}),this.authPromise)}async publish(e){let t=new Promise((n,i)=>{let o=setTimeout(()=>{let a=this.openEventPublishes.get(e.id);a&&(a.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:i,timeout:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,i=new Promise((o,a)=>{this.openCountRequests.set(n,{resolve:o,reject:a})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),i}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||(t.label?t.label+":":"sub:")+this.serial,i=new So(this,n,e,t);return this.openSubs.set(n,i),i}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close(),this.onclose?.()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},So=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,i){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=i.alreadyHaveEvent,this.receivedEvent=i.receivedEvent,this.eoseTimeout=i.eoseTimeout||e.baseEoseTimeout,this.oneose=i.oneose,this.onclose=i.onclose,this.onevent=i.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof Mn))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},Vn;try{Vn=WebSocket}catch{}var he=class extends Wn{constructor(e){super(e,{verifyEvent:go,websocketImplementation:Vn})}static async connect(e){let t=new he(e);return await t.connect(),t}};function Va(e){try{let t=new URL(e),{protocol:n,hostname:i,pathname:o}=t;return!(n!=="wss:"||i==="localhost"||i.endsWith(".local")||i==="[::1]"||/^(127\.|10\.|192\.168\.)/.test(i)||!i.includes(".")&&!i.startsWith("[")||i.endsWith(".onion")||e.includes("npub1")||e.includes("nprofile")||o.includes("://"))}catch{return!1}}function Ot(e){return typeof window>"u"&&e.unref(),e}var Kn=["wss://purplepag.es","wss://user.kindpag.es","wss://relay.nos.social","wss://relay.nostr.band","wss://nostr.land","wss://indexer.coracle.social"];var et,mt,Mt,zt,xe,Ye=class{constructor(){V(this,zt);V(this,et,new Map);V(this,mt,new Map);V(this,Mt,3e4)}async disconnect(t){if(A(this,et).has(t)){let n=A(this,et).get(t);n.ws.readyState<2&&await n.close()?.catch(console.log),A(this,et).delete(t),clearTimeout(A(this,mt).get(t)),A(this,mt).delete(t)}}async disconnectAll(){for(let t of A(this,et).keys())await this.disconnect(t)}async getEvents(t,n,i=5e3){let o=[],a=n.map(async c=>{let l,d=!1,p=Promise.withResolvers(),h=Ot(setTimeout(()=>{d=!0,l?.close(),p.reject(new Error(`timeout: ${c}`))},i));try{l=(await Y(this,zt,xe).call(this,c)).subscribe([t],{onevent:x=>{o.push(x)},onclose:x=>{clearTimeout(h),!d&&(x?p.reject(x):p.resolve())},oneose:()=>{clearTimeout(h),d=!0,l.close(),p.resolve()}})}catch(v){clearTimeout(h),p.reject(v)}return p.promise}),r=await Promise.allSettled(a),s=r.filter(c=>c.status==="rejected");return{result:o,errors:s.map(c=>({reason:c.reason,relay:n[r.indexOf(c)]})),success:o.length>0||r.length!==s.length}}async getEventsAsap(t,n,i=5e3){let o=new Map,a=[],r=[],s=null,c=0,l=!1,d=Promise.withResolvers(),p=x=>{l||(l=!0,clearTimeout(h),o.forEach(u=>u.close()),d.resolve({result:x,errors:a,success:x.length>0||n.length!==a.length}))},h=Ot(setTimeout(()=>{p([])},i)),v=()=>{c+=1,!l&&c>=n.length&&p(r)};for(let x of n)Y(this,zt,xe).call(this,x).then(u=>{if(l)return;let f=u.subscribe([t],{onevent:m=>{s||(s=f,o.forEach(w=>{w!==s&&w.close()}),clearTimeout(h)),f===s&&r.push(m)},onclose:m=>{if(o.delete(x),m){let w=m instanceof Error?m:new Error(String(m));a.push({reason:w,relay:x})}v()},oneose:()=>{f.close(),f===s&&p(r)}});o.set(x,f)}).catch(u=>{a.push({reason:u,relay:x}),console.error(`Nostr relay error at ${x}: ${u}`),v()});return d.promise}async sendEvent(t,n,i=3e3){let o=n.map(async s=>{let c,l=Promise.withResolvers();try{c=Ot(setTimeout(()=>{l.reject(new Error(`timeout: ${s}`))},i)),await(await Y(this,zt,xe).call(this,s)).publish(t),l.resolve()}catch(d){if(d.message?.startsWith("duplicate:"))return l.resolve();if(d.message?.startsWith("mute:"))return console.info(`${s} - ${d.message}`),l.resolve();l.reject(d)}finally{clearTimeout(c)}return l.promise}),a=await Promise.allSettled(o),r=a.filter(s=>s.status==="rejected");return{result:null,errors:r.map(s=>({reason:s.reason,relay:n[a.indexOf(s)]})),success:a.length!==r.length}}};et=new WeakMap,mt=new WeakMap,Mt=new WeakMap,zt=new WeakSet,xe=async function(t){if(A(this,et).has(t)){clearTimeout(A(this,mt).get(t)),A(this,mt).set(t,Ot(setTimeout(()=>this.disconnect(t),A(this,Mt))));let i=A(this,et).get(t);return await i.connect(),i}let n=new he(t);return A(this,et).set(t,n),await n.connect(),A(this,mt).set(t,Ot(setTimeout(()=>this.disconnect(t),A(this,Mt)))),n};var Wt=new Ye;async function Zn(e,t){if(!e.pubkey||!e.kind||!e.dTag)throw new Error("Missing args");if(t??=(await Yn(e.pubkey))[e.pubkey],t.write.length===0)return;let n=await Wt.getEvents({authors:[e.pubkey],kinds:[e.kind],"#d":[e.dTag],limit:1},t.write);if(!n.success)throw n.errors?.[0]?.reason||new Error("Failed to fetch app bundle events");return(n.result??[]).sort((o,a)=>a.created_at-o.created_at)[0]}async function Gn(e,t){switch(t.code){case"WRITE_RELAYS":{if((e.authors?.length??0)===0&&(t.authors?.length??0)===0)throw new Error("Missing authors");let n=t.authors||e.authors,i=Object.entries(t.userRelays||await Yn(n)).map(([s,c])=>[s,c.write]),o={};i.forEach(s=>s[1].forEach(c=>{o[c]??=0,o[c]++}));let a=Object.entries(o).sort(([,s],[,c])=>c-s).map(([s])=>s),r=t.maxRelaysPerUser||2;if(e.authors){let s={},c={};a.forEach(f=>{i.forEach(([m,w])=>{w.includes(f)&&(s[m]??=0,!(++s[m]>r)&&(c[f]??=[],c[f].push(m)))})});let l=Object.entries(c).map(([f,m])=>Wt.getEventsAsap({...e,authors:m},[f]).then(w=>w.result??[])),p=(await Promise.allSettled(l)).filter(f=>f.status==="fulfilled"&&f.value).flatMap(f=>f.value).sort((f,m)=>m.created_at-f.created_at),h=[],v=new Set,x=new Set,u=f=>{let m;if(f.kind>=1e4&&f.kind<2e4||f.kind===0||f.kind===3?m="":m=f.tags.find(E=>E[0]==="d")?.[1],typeof m=="string")return`${f.kind}:${f.pubkey}:${m}`};for(let f of p){if(e.limit&&h.length===e.limit)break;if(v.has(f.id))continue;let m=u(f);if(m){if(x.has(m))continue;x.add(m)}v.add(f.id),h.push(f)}return h}else{let s=new Set;i.forEach(l=>{let d=0;for(let p of a){if(d===r)break;l[1].includes(p)&&(d++,s.add(p))}});let{result:c}=await Wt.getEventsAsap(e,[...s]);return c}}default:throw new Error("Pick a strategy")}}async function Yn(e){Array.isArray(e)||(e=[e]);let t=await Wt.getEvents({authors:e,kinds:[10002],limit:e.length},Kn);if(!t.success)throw t.errors?.[0]?.reason||new Error("Failed to fetch relay lists");let n=t.result??[],i={},o={read:!0,write:!0},a=Object.keys(o),r,s=e.reduce((l,d)=>({...l,[d]:{read:new Set,write:new Set}}),{}),c=n.sort((l,d)=>d.created_at-l.created_at).filter(l=>(!i[l.pubkey]&&e.includes(l.pubkey)&&(i[l.pubkey]=!0),i[l.pubkey])).reduce((l,d)=>((d.tags??[]).filter(p=>p[0]==="r"&&/^wss?:\/\//.test(p[1])).forEach(p=>{r=[p[2]].filter(h=>o[h]),r.length===0&&(r=a),r.forEach(h=>l[d.pubkey][h].add(p[1]))}),l),s);for(let l in c)a.forEach(d=>{c[l][d]=[...c[l][d]]});return c}var jo=(e=>async()=>e??=await To())(),To=()=>{let e=Promise.withResolvers(),t=indexedDB.open("44billion_browser",1);return t.onerror=()=>e.reject(t.error),t.onsuccess=()=>{let n=t.result;n.onversionchange=()=>{n.close(),location.reload(!0)},n.onerror=()=>{console.log(`[${n.name}DB v${n.version}] IndexedDB error. Code: ${t.errorCode} - ${t.error.stack}`)},e.resolve(n)},t.onupgradeneeded=n=>{let i=n.target.result,o=n.target.transaction,a;i.objectStoreNames.contains("fileChunks")?a=o.objectStore("fileChunks"):a=i.createObjectStore("fileChunks",{keyPath:["appId","fx","pos"]}),console.log(`[${i.name}DB v${i.version}] ${a.name} store is ready`),i.objectStoreNames.contains("bundles")?a=o.objectStore("bundles"):a=i.createObjectStore("bundles",{keyPath:["c","p","d"]}),console.log(`[${i.name}DB v${i.version}] ${a.name} store is ready`),i.objectStoreNames.contains("permissions")?a=o.objectStore("permissions"):a=i.createObjectStore("permissions",{keyPath:["appId","name","eKind"]}),console.log(`[${i.name}DB v${i.version}] ${a.name} store is ready`)},e.promise};async function J(e,t=[],n,i,{p:o=Promise.withResolvers(),tx:a,txMode:r=a?.mode,storeOrIndex:s}={}){if(!a){let l=await jo();r??=["get","getKey","count"].includes(e)?"readonly":"readwrite",a=l.transaction([n],r)}if(!s){let l=a.objectStore(n);s=i?l.index(i):l}let c=s[e](...t);return c.onsuccess=()=>{o.resolve({result:c.result,tx:a,storeOrIndex:s})},c.onerror=()=>{o.reject(c.error),a.abort()},o.promise}async function Qn(e){let t=ke(e);return J("get",[t],"bundles").then(n=>n.result&&Io(n.result))}async function Xn(e){let t=ke(e);return J("delete",[t],"bundles")}async function ge(e,t){let n=Ao(e,t);return J("put",[n],"bundles")}function Ao(e,{hasUpdate:t=!1,lastOpenedAsSingleNappAt:n=0}={}){let i=e.tags.find(l=>l[0]==="d")?.[1]??"";if(!pn(i))throw new Error("Invalid d tag");let{kind:o,pubkey:a,meta:r,...s}=e,c={37448:"a",37449:"b",37450:"c"}[o];if(!c)throw new Error("Invalid kind");return{c,p:ln(a),d:i,u:t,s:n,evt:s}}function Io(e){let t={a:37448,b:37449,c:37450}[e.c];if(!t)throw new Error("Invalid channel");return{kind:t,pubkey:cn(e.p),...e.evt,meta:{hasUpdate:e.u,lastOpenedAsSingleNappAt:e.s}}}async function Qe(e,t){let n=await Qn(e);return n||(n=await Zn(t),n&&await ge(n),n)}async function ve(e,t){let n=null;for await(let o of Nt(e,t)){let a=o.evt.tags.find(s=>s[0]==="c"&&s[1].startsWith(`${t}:`));if(!a)continue;let r=parseInt(a[2]);if(!Number.isNaN(r)&&r>0){n=r;break}}if(!n)return{count:0,total:n};let i=IDBKeyRange.bound([e,t,-1/0],[e,t,1/0]);return J("count",[i],"fileChunks").then(o=>({count:o.result,total:n}))}async function ds(e,t,{signal:n}={}){let i=new Set(t),o=Promise.withResolvers(),a=IDBKeyRange.bound([e,"\0",-1/0],[e,"\uFFFF",1/0]);J("openCursor",[a],"fileChunks",null,{p:o});let r=d=>{let[,p]=d.key;return[e,p,1/0]},s,c,l;for(;(l=await o.promise)&&(s=l.result);){if(n?.aborted){l.tx.abort();break}i.has(s.value.fx)?c=r(s):s.delete(),Object.assign(o,Promise.withResolvers()),s.continue(c),c&&(c=void 0)}}async function be(e,t){if(!e)throw new Error("Missing bundle id");let n=IDBKeyRange.bound([e,t??"\0",-1/0],[e,t??"\uFFFF",1/0]);return J("delete",[n],"fileChunks").then(i=>i.result)}async function fs(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let a=n!==void 0?n:-1/0,r=i!==void 0?i:1/0,s=IDBKeyRange.bound([e,t,a],[e,t,r]);return J(o?"getAllKeys":"getAll",[s],"fileChunks").then(c=>c.result)}async function*Nt(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let a=n!==void 0?n:-1/0,r=i!==void 0?i:1/0,s=IDBKeyRange.bound([e,t,a],[e,t,r]),c=Promise.withResolvers();await J(o?"openKeyCursor":"openCursor",[s],"fileChunks",null,{p:c});let l=o?"key":"value",d;for(;d=(await c.promise).result;)yield d[l],Object.assign(c,Promise.withResolvers()),d.continue()}async function Fn(e,t,n){let i=e.tags.filter(a=>a[0]==="file"&&!!a[1]).map(a=>a[1]).reduce((a,r)=>({...a,[r]:!0}),{}),o;for(let a of t){if(a.kind!==34600)throw new Error("Wrong chunk kind");let r,s=[];for(let c of a.tags)if(c[0]==="d"&&(r=c),c[0]==="c"){let[l,d]=c[1].split(":");d!==void 0&&i[l]&&s.push([l,parseInt(d)])}n??=fn({kind:e.kind,pubkey:e.pubkey,dTag:e.tags.find(c=>c[0]==="d")[1]});for(let[c,l]of s){let d={appId:n,x:r[1],fx:c,pos:l,evt:a};o=await J("put",[d],"fileChunks",null,o)}}}async function*Xe(e,t,n,i){if(i??=At(n,t.tags),!i)throw new Error(`No matching file tag found for path: ${n}`);let o=i[1],a=await ve(e,o);if(a.count===a.total){yield{progress:100,newlyCachedChunkIndexRanges:[]};return}let s=[i[4]?.trim(),t.pubkey].filter(Boolean);if(!a.total&&(a.count&&(await be(e,o),a.count=0),a=yield*Jn(o,[0,1,2,3],s,t,e,a),!a.total))throw new Error("Some chunks are missing");let c={};for await(let d of Nt(e,o,{justKeys:!0}))c[d[2]]=!0;let l=[...Array(a.total).keys()].filter(d=>!c[d]);if(a=yield*Jn(o,l,s,t,e,a),!a.total||a.count<a.total)throw new Error("Some chunks are missing")}async function*Jn(e,t,n,i,o,a){let r=0,s=a.total,c=[],l=()=>Math.floor((a.count+r)/s*100),d=p=>{if(p.length===0)return[];let h=[...p].sort((f,m)=>f-m),v=[],x=h[0],u=h[0];for(let f=1;f<h.length;f++)h[f]===u+1?u=h[f]:(v.push([x,u]),x=u=h[f]);return v.push([x,u]),v};for(let p=0;p<t.length;p+=4){let h=t.slice(p,p+4),v=0,x=!1;for(;!x&&v<20;){let u={authors:n,"#c":h.map(m=>`${e}:${m}`),limit:h.length},f=await Gn(u,{code:"WRITE_RELAYS",maxRelaysPerUser:7});if(f){if(x=!0,f.length>0){await Fn(i,f,o),r+=f.length;for(let w of f){let E=w.tags.find(j=>j[0]==="c"&&j[1].startsWith(`${e}:`));if(E){let j=parseInt(E[1].split(":")[1]);Number.isNaN(j)||c.push(j)}}if(!s){for(let w of f)if(s=Co(w,e))break}if(!s)continue;let m=d(c);yield{progress:l(),newlyCachedChunkIndexRanges:m},c.length=0}}else v++,console.log(`Failed to fetch chunks (${v}). Retrying...`),await new Promise(m=>setTimeout(m,Math.pow(2,Math.min(10,v))*1e3))}if(!x){console.log("Failed to fetch chunks after multiple retries");break}}return{count:a.count+r,total:s}}function Co(e,t){let n=e.tags.find(o=>o[0]==="c"&&o[1].startsWith(`${t}:`));if(!n)return null;let i=parseInt(n[2]);if(Number.isNaN(i))return null;if(i>0)return i}var ti={"application/prs.cww":["cww"],"application/prs.xsf+xml":["xsf"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["*xfdf"],"application/vnd.age":["age"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.autodesk.fbx":["fbx"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dcmp+xml":["dcmp"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["*fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.slides":["ggs"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.drawing":["gdraw"],"application/vnd.google-apps.form":["gform"],"application/vnd.google-apps.jam":["gjam"],"application/vnd.google-apps.map":["gmap"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.script":["gscript"],"application/vnd.google-apps.site":["gsite"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.gov.sk.xmldatacontainer+xml":["xdcf"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mapbox-vector-tile":["mvt"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["*mpp","mpt"],"application/vnd.ms-visio.viewer":["vdx"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.nato.bindingdataobject+xml":["bdo"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.procrate.brushset":["brushset"],"application/vnd.procreate.brush":["brush"],"application/vnd.procreate.dream":["drm"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.pwg-xhtml-print+xml":["xhtm"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml","uo"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw","vsdx","vtx"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blender":["blend"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-compressed":["*rar"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-ipynb+json":["ipynb"],"application/x-iso9660-image":["*iso"],"application/x-iwork-keynote-sffkey":["*key"],"application/x-iwork-numbers-sffnumbers":["*numbers"],"application/x-iwork-pages-sffpages":["*pages"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["*prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["*sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zip-compressed":["*zip"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["*aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif","btf"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-adobe-dng":["dng"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.bary":["bary"],"model/vnd.cld":["cld"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["*mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.pytha.pyox":["pyo","pyox"],"model/vnd.sap.vds":["vds"],"model/vnd.usda":["usda"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.familysearch.gedcom":["ged"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]};Object.freeze(ti);var ei=ti;var ni={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(ni);var ii=ni;var Z=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},_t,Vt,yt,Fe=class{constructor(...t){_t.set(this,new Map),Vt.set(this,new Map),yt.set(this,new Map);for(let n of t)this.define(n)}define(t,n=!1){for(let[i,o]of Object.entries(t)){i=i.toLowerCase(),o=o.map(s=>s.toLowerCase()),Z(this,yt,"f").has(i)||Z(this,yt,"f").set(i,new Set);let a=Z(this,yt,"f").get(i),r=!0;for(let s of o){let c=s.startsWith("*");if(s=c?s.slice(1):s,a?.add(s),r&&Z(this,Vt,"f").set(i,s),r=!1,c)continue;let l=Z(this,_t,"f").get(s);if(l&&l!=i&&!n)throw new Error(`"${i} -> ${s}" conflicts with "${l} -> ${s}". Pass \`force=true\` to override this definition.`);Z(this,_t,"f").set(s,i)}}return this}getType(t){if(typeof t!="string")return null;let n=t.replace(/^.*[/\\]/s,"").toLowerCase(),i=n.replace(/^.*\./s,"").toLowerCase(),o=n.length<t.length;return!(i.length<n.length-1)&&o?null:Z(this,_t,"f").get(i)??null}getExtension(t){return typeof t!="string"?null:(t=t?.split?.(";")[0],(t&&Z(this,Vt,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Z(this,yt,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(let t of Z(this,yt,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Z(this,_t,"f"),extensions:Z(this,Vt,"f")}}};_t=new WeakMap,Vt=new WeakMap,yt=new WeakMap;var Je=Fe;var tn=new Je(ii,ei)._freeze();var qo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&'()*+,-./:;<=>?@[]^_`{|}~ ",Ro=(()=>{let e=new Int16Array(128);e.fill(93);for(let t=0;t<93;t++)e[qo.charCodeAt(t)]=t;return e})();function en(e,t=0,n=-1){let i=t+n;(n<0||i>e.length)&&(i=e.length);let o=new Uint8Array(Math.ceil((i-t)*7/8)),a=0,r=0,s=-1,c=0;for(let l=t;l<i;l++){let d=e.charCodeAt(l);if(d>126)continue;let p=Ro[d];if(p!==93)if(s===-1)s=p;else{let h=s+p*93;for(s=-1,a|=h<<r,r+=(h&8191)>456?13:14;r>7;)o[c++]=a&255,a>>>=8,r-=8}}return s!==-1&&(o[c++]=(a|s<<r)&255),o.subarray(0,c)}async function ai(e,t=!1){let i=e.getCachedMetadata(e.appId,["icon"])?.icon;return t&&i?(oi(e,i),i):i||await oi(e)}async function si(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.name;return t&&(i!==void 0||n?.description!==void 0)?(we(e),i):i!==void 0?i:(await we(e))?.name?.trim()||null}async function ri(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.description;return t&&(i!==void 0||n?.name!==void 0)?(we(e),i):i!==void 0?i:(await we(e))?.description?.trim()||null}async function oi(e,t=null){let n=e.getFaviconMetadata();if(!n)return null;if(t&&t.fx===n.rootHash)return t;try{let i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0});i.isCached||(await e.cacheFile(null,n.tag),i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0}));let o=[];for await(let p of Nt(e.appId,n.rootHash))o.push(p.evt.content);if(o.length===0)return null;let a=o.map(p=>en(p)),r=new Blob(a,{type:n.contentType}),s=new FileReader,l=await new Promise((p,h)=>{s.onload=()=>p(s.result),s.onerror=h,s.readAsDataURL(r)}),d={fx:n.rootHash,url:l};return e.cacheMetadata(e.appId,{icon:d}),d}catch(i){return console.log("Failed to fetch icon:",i),null}}async function we(e){try{let t=await e.getFileCacheStatus("/",null,{withMeta:!0});t.isCached||await e.cacheFile("/",null);let n=[];for await(let p of Nt(e.appId,t.fileRootHash))n.push(p.evt.content);if(n.length===0)return{name:void 0,description:void 0};let i=n.map(p=>en(p)),o=new Blob(i,{type:t.contentType}),a=new FileReader,s=await new Promise((p,h)=>{a.onload=()=>p(a.result),a.onerror=h,a.readAsText(o)}),{name:c,description:l}=Oo(s),d={};return c!==void 0&&(d.name=c),l!==void 0&&(d.description=l),Object.keys(d).length>0&&e.cacheMetadata(e.appId,d),{name:c,description:l}}catch(t){return console.log("Failed to fetch HTML metadata:",t),{name:void 0,description:void 0}}}function Oo(e){let t,n;try{let i=/<title[^>]*>([\s\S]*?)<\/title>/i,o=e.match(i);o&&o[1]&&(t=o[1].trim());let a=/<meta\s+[^>]*name\s*=\s*["']description["'][^>]*content\s*=\s*["']([^"']+)["'][^>]*>/i,r=e.match(a);if(r&&r[1]&&(n=r[1].trim()),!n){let s=/<meta\s+[^>]*content\s*=\s*["']([^"']+)["'][^>]*name\s*=\s*["']description["'][^>]*>/i,c=e.match(s);c&&c[1]&&(n=c[1].trim())}}catch(i){console.log("Error parsing HTML metadata:",i)}return{name:t,description:n}}function zo(e,t){if(!e||!t)throw new Error("Missing args");["name","description","icon"].forEach(n=>{let i=t[n];switch(n){case"icon":i=i?.fx&&i?.url&&{fx:i.fx,url:i.url};break;case"description":i=(i?.length??0)>255?`${i.slice(0,252)}...`:i;break;case"name":i=(i?.length??0)>100?`${i.slice(0,97)}...`:i;break}i&&un(localStorage,`session_appById_${e}_${n}`,i)})}function No(e,t=["name","description","icon"]){if(!e)return;let n={};return t.forEach(i=>{let o=localStorage.getItem(`session_appById_${e}_${i}`);if(o){try{o=JSON.parse(o)}catch{console.log(`Error parsing "${i}" metadata from app "${e}"`);return}n[i]=o}}),n}function ci(e){return e?/^(?:text\/|application\/json)[^;]*$/.test(e)?`${e}; charset=utf-8`:e:"application/octet-stream"}var li=Symbol("createToken"),Et,G,pi,Lt,kt,nn,on,ht,ot,di,ye=class{constructor(t,n){V(this,G);V(this,Lt);V(this,kt,{});V(this,ht,!1);V(this,ot,{});if(t!==li)throw new Error("Use AppFileCacher.create(appAddress) to instantiate this class.");Object.assign(this,n)}static async create(t,n,{cacheMetadata:i=zo,getCachedMetadata:o=No}={}){if(A(this,Et)[t])return A(this,Et)[t];let a=Promise.withResolvers();A(this,Et)[t]=a.promise,n??=dn(t);let r,s;do r=await Qe(t,n),r||(s++,console.log("Retrying bundle fetching"),await new Promise(l=>setTimeout(l,Math.pow(2,Math.min(10,s))*1e3)));while(!r&&s<20);r||(delete A(this,Et)[t],a.reject(new Error(`Couldn't find bundle after ${s} attempts`)));let c=new this(li,{appId:t,addressObj:n,bundle:r,cacheMetadata:i,getCachedMetadata:o});return a.resolve(c),a.promise}async getIcon(t=!1){return ai(this,t)}async getName(t=!1){return si(this,t)}async getDescription(t=!1){return ri(this,t)}async clearAppFiles(){await Y(this,G,pi).call(this),await be(this.appId),await Xn(this.appId)}updateBundleMetadata(t){if(!t)throw new Error("Missing metadata arg");return ge(this.bundle,{...this.bundle.meta,...t})}getFaviconMetadata(){if(A(this,Lt))return A(this,Lt);let t,n=this.bundle.tags.find(i=>i[0]==="file"&&/^favicon\.\w{3,}$/.test(i[2])&&(!!i[3]&&i[3].startsWith("image/")&&(t=i[3])||((t=tn.getType(i[2]))||"").startsWith("image/")));if(n)return Tt(this,Lt,{rootHash:n[1],filename:n[2],mimeType:t,contentType:ci(t),relayHints:[n[4]].filter(Boolean),tag:n})}getFileRootHash(t,n){if(n??=At(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);return n[1]}async getFileCacheStatus(t,n,{withMeta:i=!1}={}){if(n??=At(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let o=this.getFileRootHash(null,n),a=await ve(this.appId,o);if(!i)return{isCached:a.count===a.total};let r=n[3]&&n[3].startsWith("image/")?n[3]:tn.getType(n[2]);return{...a,isCached:a.count===a.total,mimeType:r,contentType:ci(r),isHtml:/^text\/html\b/.test(r),fileRootHash:o,fileTag:n}}async cacheFile(t,n,i,{shouldCacheMissingFiles:o=!navigator.connection?.metered}={}){if(n??=At(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let a=n[2],r=Y(this,G,nn).call(this,a);if(i&&(r.subscribers.add(i),r.result!==null&&i(r.result),r.error)){i({error:r.error});return}let s=Promise.withResolvers();return r.subscribers.add(({progress:c,error:l,newlyCachedChunkIndexRanges:d})=>{if(c>=100){if(s.resolve(),!o)return;this.cacheMissingAppFiles(a)}else l&&s.reject(l)}),Y(this,G,di).call(this,a,n),s.promise}async cacheMissingAppFiles(t){if(!A(this,ht)){Tt(this,ht,!0);try{let n={...t&&{[t]:!0}},i=this.bundle.tags.filter(o=>o[0]!=="file"||!o[1]||!o[2]||n[o[2]]?!1:n[o[2]]=!0);for(let o of i){if(!A(this,ht))break;await this.cacheFile(`/${o[2]}`,o,null,{shouldCacheMissingFiles:!1})}}finally{Tt(this,ht,!1)}}}};Et=new WeakMap,G=new WeakSet,pi=async function(){Tt(this,ht,!1);for(let t in A(this,kt)){let n=A(this,kt)[t],i=new Error("Cache operation aborted");n.error=i;for(let o of n.subscribers)try{o({error:i})}catch(a){console.log(a)}Y(this,G,on).call(this,t)}Tt(this,ot,{})},Lt=new WeakMap,kt=new WeakMap,nn=function(t){if(!t)throw new Error("No filename");return A(this,kt)[t]??={subscribers:new Set,result:null,error:null}},on=function(t){delete A(this,kt)[t]},ht=new WeakMap,ot=new WeakMap,di=async function(t,n){if(A(this,ot)[t])return;A(this,ot)[t]=!0;let i=Xe(this.appId,this.bundle,t,n),o=Y(this,G,nn).call(this,t);try{for await(let{progress:r,newlyCachedChunkIndexRanges:s}of i){if(!A(this,ot)[t])break;o.result={progress:r,newlyCachedChunkIndexRanges:s};for(let c of o.subscribers)try{c({progress:r,newlyCachedChunkIndexRanges:s})}catch(l){console.log(l)}}if(!A(this,ot)[t]||o.result?.progress>=100)return;let a=new Error(`File caching incomplete, stopped at ${o.result?.progress??0}%`);o.error=a;for(let r of o.subscribers)try{r({error:a})}catch(s){console.log(s)}}catch(a){o.error=a;for(let r of o.subscribers)try{r({error:a})}catch(s){console.log(s)}}finally{Y(this,G,on).call(this,t),delete A(this,ot)[t]}},V(ye,Et,{});export{J as a,ve as b,ds as c,fs as d,Nt as e,Fn as f,Va as g,Wt as h,Gn as i,Yn as j,Qn as k,ge as l,en as m,ye as n};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
