import{A as qn,C as Mn,D as zn,F as ne,G as Qe,H as Ht,I as Dt,K as Kn,L as ve,M as Hn,b as Zi,d as I,e as Z,f as zt,g as J,h as Tt,i as Ye,j as Ge,l as Je,o as ft,p as Kt,q as ge,r as xe,t as ee,w as V,x as be,y as Nn,z as It}from"./chunk-3BAMIFL4.js";var bt,Wt,ye,Dn,ie=class{constructor(){Z(this,ye);Z(this,bt,new Map);Z(this,Wt,new FinalizationRegistry(J(this,ye,Dn).bind(this)))}set(t,n){if(this.get(t)===n)return this;let i=new WeakRef(n);return I(this,Wt).unregister(i),I(this,bt).set(t,i),I(this,Wt).register(n,t,i),this}get(t){return I(this,bt).get(t)?.deref?.()}delete(t){let n=I(this,bt).get(t);return n?(I(this,Wt).unregister(n),I(this,bt).delete(t),!0):!1}has(t){return this.get(t)!==void 0}get[Symbol.toStringTag](){return"WeakValueMap"}};bt=new WeakMap,Wt=new WeakMap,ye=new WeakSet,Dn=function(t){I(this,bt).delete(t)};function Yi(e){return/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)}function Vt(e=localStorage,t,{shouldUseStrictKeys:n=!1,shouldReplaceInvalidValues:i=!1}={}){let o=Kt({},{shouldCache:!1,isStatic:!1}),s=Ye(()=>({})),r=xe("useWebStorage_signalByKeyMap",()=>new ie,{shouldCache:!1}),a=Ye(()=>{function c(d){return{get(p,u,x){return u!=="set"?Reflect.get(p,u,x):function(...h){let f=Reflect.get(p,u,x)(...h);return f===void 0?e.removeItem(d.slice(0,-1)):e.setItem(d.slice(0,-1),JSON.stringify(f)),f}},apply(p,u,x){if(!x.length)return Reflect.apply(p,u,x);let h=Reflect.apply(p,u,x);return h===void 0?e.removeItem(d.slice(0,-1)):e.setItem(d.slice(0,-1),JSON.stringify(h)),h}}}let l={set(d,p,u,x){try{if(!p.endsWith("$"))throw new Error('(useWebStorage) Append a "$" to the original storage key');if(n&&!Yi(p))throw new Error("(useWebStorage) Key name failed /^[a-zA-Z_$][a-zA-Z0-9_$]*$/ test");let h,f=p.slice(0,-1),m=Object.prototype.hasOwnProperty.call(e,f);return m&&(()=>{try{return h=JSON.parse(e.getItem(f)),!0}catch(g){if(console.log(g),i)return!1;throw new Error(`(useWebStorage) Can't JSON.parse value ${e.getItem(f)} stored at key ${p}`)}})()?Object.prototype.hasOwnProperty.call(d,p)?h:Reflect.set(d,p,Je([function(){return h}].map(g=>(g.strategy="signal")&&g)[0]),x):(typeof u=="function"&&(u=u()),Reflect.set(d,p,Je([function(){return u}].map(g=>(g.strategy="signal")&&g)[0]),x)?(u===void 0?m&&e.removeItem(f):e.setItem(f,JSON.stringify(u)),!0):!1)}catch(h){return console.error(h),!1}},get(d,p,u){return Object.prototype.hasOwnProperty.call(d,p)?s[p]??=r().get(p)??r().set(p,new Proxy(Reflect.get(d,p,u),c(p))).get(p):Reflect.set(u,p,void 0,u)?u[p]:void 0}};return new Proxy(o,l)});return V(()=>{t&&Object.entries(typeof t=="function"?t():t).forEach(([c,l])=>{a[c]=l})}),V(({cleanup:c})=>{let l;function d(p){if(p.storageArea!==e)return;let{key:u}=p,x=`${u}$`;if(u===null)return Object.keys(a).filter(h=>h.endsWith("$")).forEach(h=>a[h](void 0));Object.prototype.hasOwnProperty.call(a,x)&&a[x](p.newValue===null?void 0:JSON.parse(p.newValue))}window.addEventListener("storage",d,{signal:(l=new AbortController).signal}),c(()=>l.abort())}),a}function vt(e=localStorage,t,n){let i=e.getItem(t),o;n===void 0?(e.removeItem(t),o=null):(o=JSON.stringify(n),e.setItem(t,o));let s=new StorageEvent("storage",{key:t,oldValue:i,newValue:o,storageArea:e,url:window.location.href});return window.dispatchEvent(s),n}function Wn(e){if(e instanceof Error)return e;let t=new Error(e.message);return t.name=e.name||"Error",t.stack=e.stack,Object.assign(t,e.context||{}),t}var Vn=!1,Gi=Vn?"http://":"https://",Ji=Vn?"localhost:10000":"44billion.net",Zs=`${Gi}${Ji}`;var oe={};function Qi(){return Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)}function Xi(e,t,n=5e3){if(!e||!t)throw new Error("Missing request id or code");let{promise:i,resolve:o,reject:s}=Promise.withResolvers();oe[e]={resolve:o,reject:s};let r;return n!=null&&(n>0?r=setTimeout(()=>{oe[e]?.reject?.(`Timeout for ${t} reqId: ${e}`)},n):oe[e]?.reject?.(`Timeout for ${t} reqId: ${e}`)),i.finally(()=>{clearTimeout(r),delete oe[e]})}function to(e){let t=oe[e.data.reqId];if(!t){console.log(`Unhandled response for reqId ${e.data.reqId} (may have timed out)`,JSON.stringify(e.data));return}e.data.error?t.reject(Wn(e.data.error)):t.resolve({payload:e.data.payload,isLast:e.data.isLast??!0,ports:e.ports})}var eo=((e,t=new WeakMap,n=new FinalizationRegistry(i=>i.abort()))=>i=>{let o=i instanceof MessagePort;if(e=o?i:globalThis,t.has(e))return;let s=new AbortController;t.set(e,s),e.addEventListener("message",async r=>{if(r.data.code==="REPLY")return to(r)},{signal:s.signal}),o&&e.start(),n.register(e,s)})();async function Xe(e,t,n,i){if(!t.code&&!("payload"in t))throw new Error("Missing args");(!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),eo(e);let o=Qi(),s=Xi(o,t.code,n.timeout);return e.postMessage({...t,reqId:o},n),s.then(({payload:r,ports:a})=>({code:t.code,payload:r,ports:a})).catch(r=>({code:t.code,payload:null,error:r}))}function Q(e,t,n,i){if(!("payload"in t)&&!("error"in t))throw new Error("Missing args");if((!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),n.targetOrigin??=e.origin,!n.to&&!e.source)throw new Error("Set port to options.to");n.to??=e.source,n.to.postMessage({...t,reqId:e.data.reqId,code:"REPLY"},n)}function jt(e,t,n,i){if(!t.code||!("payload"in t)&&!("error"in t))throw new Error("Missing args");(!n||typeof n!="object")&&(n={targetOrigin:n,transfer:i}),e.postMessage(t,n)}var no=(e=>async()=>e??=await io())(),io=()=>{let e=Promise.withResolvers(),t=indexedDB.open("44billion_browser",1);return t.onerror=()=>e.reject(t.error),t.onsuccess=()=>{let n=t.result;n.onversionchange=()=>{n.close(),location.reload(!0)},n.onerror=()=>{console.log(`[${n.name}DB v${n.version}] IndexedDB error. Code: ${t.errorCode} - ${t.error.stack}`)},e.resolve(n)},t.onupgradeneeded=n=>{let i=n.target.result,o=n.target.transaction,s;i.objectStoreNames.contains("fileChunks")?s=o.objectStore("fileChunks"):s=i.createObjectStore("fileChunks",{keyPath:["appId","fx","pos"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("bundles")?s=o.objectStore("bundles"):s=i.createObjectStore("bundles",{keyPath:["c","p","d"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("permissions")?s=o.objectStore("permissions"):s=i.createObjectStore("permissions",{keyPath:["appId","name","eKind"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`)},e.promise};async function pt(e,t=[],n,i,{p:o=Promise.withResolvers(),tx:s,txMode:r=s?.mode,storeOrIndex:a}={}){if(!s){let l=await no();r??=["get","getKey","count"].includes(e)?"readonly":"readwrite",s=l.transaction([n],r)}if(!a){let l=s.objectStore(n);a=i?l.index(i):l}let c=a[e](...t);return c.onsuccess=()=>{o.resolve({result:c.result,tx:s,storeOrIndex:a})},c.onerror=()=>{o.reject(c.error),s.abort()},o.promise}async function we(e,t){let n=null;for await(let o of mt(e,t)){let s=o.evt.tags.find(a=>a[0]==="c"&&a[1].startsWith(`${t}:`));if(!s)continue;let r=parseInt(s[2]);if(!Number.isNaN(r)&&r>0){n=r;break}}if(!n)return{count:0,total:n};let i=IDBKeyRange.bound([e,t,-1/0],[e,t,1/0]);return pt("count",[i],"fileChunks").then(o=>({count:o.result,total:n}))}async function ke(e,t){if(!e)throw new Error("Missing bundle id");let n=IDBKeyRange.bound([e,t??"\0",-1/0],[e,t??"\uFFFF",1/0]);return pt("delete",[n],"fileChunks").then(i=>i.result)}async function Fn(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let s=n!==void 0?n:-1/0,r=i!==void 0?i:1/0,a=IDBKeyRange.bound([e,t,s],[e,t,r]);return pt(o?"getAllKeys":"getAll",[a],"fileChunks").then(c=>c.result)}async function*mt(e,t,{fromPos:n,toPos:i,justKeys:o=!1}={}){let s=n!==void 0?n:-1/0,r=i!==void 0?i:1/0,a=IDBKeyRange.bound([e,t,s],[e,t,r]),c=Promise.withResolvers();await pt(o?"openKeyCursor":"openCursor",[a],"fileChunks",null,{p:c});let l=o?"key":"value",d;for(;d=(await c.promise).result;)yield d[l],Object.assign(c,Promise.withResolvers()),d.continue()}async function Zn(e,t,n){let i=e.tags.filter(s=>s[0]==="file"&&!!s[1]).map(s=>s[1]).reduce((s,r)=>({...s,[r]:!0}),{}),o;for(let s of t){if(s.kind!==34600)throw new Error("Wrong chunk kind");let r,a=[];for(let c of s.tags)if(c[0]==="d"&&(r=c),c[0]==="c"){let[l,d]=c[1].split(":");d!==void 0&&i[l]&&a.push([l,parseInt(d)])}n??=Ht({kind:e.kind,pubkey:e.pubkey,dTag:e.tags.find(c=>c[0]==="d")[1]});for(let[c,l]of a){let d={appId:n,x:r[1],fx:c,pos:l,evt:s};o=await pt("put",[d],"fileChunks",null,o)}}}function Yn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function tn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Gn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yn(e.outputLen),Yn(e.blockLen)}function Ft(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Jn(e,t){tn(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Ee=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Qn=e=>e instanceof Uint8Array;var _e=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),at=(e,t)=>e<<32-t|e>>>t,oo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!oo)throw new Error("Non little-endian hardware is not supported");function so(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function se(e){if(typeof e=="string"&&(e=so(e)),!Qn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Xn(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!Qn(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}var Zt=class{clone(){return this._cloneInto()}},ia={}.toString;function ti(e){let t=i=>e().update(se(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Be(e=32){if(Ee&&typeof Ee.getRandomValues=="function")return Ee.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ao(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),s=BigInt(4294967295),r=Number(n>>o&s),a=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,r,i),e.setUint32(t+l,a,i)}var $e=class extends Zt{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=_e(this.buffer)}update(t){Ft(this);let{view:n,buffer:i,blockLen:o}=this;t=se(t);let s=t.length;for(let r=0;r<s;){let a=Math.min(o-this.pos,s-r);if(a===o){let c=_e(t);for(;o<=s-r;r+=o)this.process(c,r);continue}i.set(t.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ft(this),Jn(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:s}=this,{pos:r}=this;n[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>o-r&&(this.process(i,0),r=0);for(let p=r;p<o;p++)n[p]=0;ao(i,o-8,BigInt(this.length*8),s),this.process(i,0);let a=_e(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)a.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:s,destroyed:r,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=r,o%n&&t.buffer.set(i),t}};var ro=(e,t,n)=>e&t^~e&n,co=(e,t,n)=>e&t^e&n^t&n,lo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=new Uint32Array(64),en=class extends $e{constructor(){super(64,32,8,!1),this.A=yt[0]|0,this.B=yt[1]|0,this.C=yt[2]|0,this.D=yt[3]|0,this.E=yt[4]|0,this.F=yt[5]|0,this.G=yt[6]|0,this.H=yt[7]|0}get(){let{A:t,B:n,C:i,D:o,E:s,F:r,G:a,H:c}=this;return[t,n,i,o,s,r,a,c]}set(t,n,i,o,s,r,a,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=r|0,this.G=a|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)wt[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let u=wt[p-15],x=wt[p-2],h=at(u,7)^at(u,18)^u>>>3,f=at(x,17)^at(x,19)^x>>>10;wt[p]=f+wt[p-7]+h+wt[p-16]|0}let{A:i,B:o,C:s,D:r,E:a,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let u=at(a,6)^at(a,11)^at(a,25),x=d+u+ro(a,c,l)+lo[p]+wt[p]|0,f=(at(i,2)^at(i,13)^at(i,22))+co(i,o,s)|0;d=l,l=c,c=a,a=r+x|0,r=s,s=o,o=i,i=x+f|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,r=r+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,s,r,a,c,l,d)}roundClean(){wt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Se=ti(()=>new en);var an={};Zi(an,{bitGet:()=>xo,bitLen:()=>go,bitMask:()=>ae,bitSet:()=>bo,bytesToHex:()=>Ct,bytesToNumberBE:()=>F,bytesToNumberLE:()=>Ie,concatBytes:()=>ht,createHmacDrbg:()=>sn,ensureBytes:()=>z,equalBytes:()=>mo,hexToBytes:()=>Ot,hexToNumber:()=>on,numberToBytesBE:()=>rt,numberToBytesLE:()=>je,numberToHexUnpadded:()=>ii,numberToVarBytesBE:()=>fo,utf8ToBytes:()=>ho,validateObject:()=>kt});var ni=BigInt(0),Ae=BigInt(1),po=BigInt(2),Te=e=>e instanceof Uint8Array,uo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ct(e){if(!Te(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=uo[e[n]];return t}function ii(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function on(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ot(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let i=0;i<n.length;i++){let o=i*2,s=e.slice(o,o+2),r=Number.parseInt(s,16);if(Number.isNaN(r)||r<0)throw new Error("Invalid byte sequence");n[i]=r}return n}function F(e){return on(Ct(e))}function Ie(e){if(!Te(e))throw new Error("Uint8Array expected");return on(Ct(Uint8Array.from(e).reverse()))}function rt(e,t){return Ot(e.toString(16).padStart(t*2,"0"))}function je(e,t){return rt(e,t).reverse()}function fo(e){return Ot(ii(e))}function z(e,t,n){let i;if(typeof t=="string")try{i=Ot(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Te(t))i=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let o=i.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return i}function ht(...e){let t=new Uint8Array(e.reduce((i,o)=>i+o.length,0)),n=0;return e.forEach(i=>{if(!Te(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}function mo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ho(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function go(e){let t;for(t=0;e>ni;e>>=Ae,t+=1);return t}function xo(e,t){return e>>BigInt(t)&Ae}var bo=(e,t,n)=>e|(n?Ae:ni)<<BigInt(t),ae=e=>(po<<BigInt(e-1))-Ae,nn=e=>new Uint8Array(e),ei=e=>Uint8Array.from(e);function sn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=nn(e),o=nn(e),s=0,r=()=>{i.fill(1),o.fill(0),s=0},a=(...p)=>n(o,i,...p),c=(p=nn())=>{o=a(ei([0]),p),i=a(),p.length!==0&&(o=a(ei([1]),p),i=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,u=[];for(;p<t;){i=a();let x=i.slice();u.push(x),p+=i.length}return ht(...u)};return(p,u)=>{r(),c(p);let x;for(;!(x=u(l()));)c();return r(),x}}var vo={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function kt(e,t,n={}){let i=(o,s,r)=>{let a=vo[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=e[o];if(!(r&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(let[o,s]of Object.entries(t))i(o,s,!1);for(let[o,s]of Object.entries(n))i(o,s,!0);return e}var H=BigInt(0),N=BigInt(1),Rt=BigInt(2),yo=BigInt(3),rn=BigInt(4),oi=BigInt(5),si=BigInt(8),wo=BigInt(9),ko=BigInt(16);function K(e,t){let n=e%t;return n>=H?n:t+n}function Eo(e,t,n){if(n<=H||t<H)throw new Error("Expected power/modulo > 0");if(n===N)return H;let i=N;for(;t>H;)t&N&&(i=i*e%n),e=e*e%n,t>>=N;return i}function X(e,t,n){let i=e;for(;t-- >H;)i*=i,i%=n;return i}function Ce(e,t){if(e===H||t<=H)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=K(e,t),i=t,o=H,s=N,r=N,a=H;for(;n!==H;){let l=i/n,d=i%n,p=o-r*l,u=s-a*l;i=n,n=d,o=r,s=a,r=p,a=u}if(i!==N)throw new Error("invert: does not exist");return K(o,t)}function _o(e){let t=(e-N)/Rt,n,i,o;for(n=e-N,i=0;n%Rt===H;n/=Rt,i++);for(o=Rt;o<e&&Eo(o,t,e)!==e-N;o++);if(i===1){let r=(e+N)/rn;return function(c,l){let d=c.pow(l,r);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}let s=(n+N)/Rt;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=i,d=a.pow(a.mul(a.ONE,o),n),p=a.pow(c,s),u=a.pow(c,n);for(;!a.eql(u,a.ONE);){if(a.eql(u,a.ZERO))return a.ZERO;let x=1;for(let f=a.sqr(u);x<l&&!a.eql(f,a.ONE);x++)f=a.sqr(f);let h=a.pow(d,N<<BigInt(l-x-1));d=a.sqr(h),p=a.mul(p,h),u=a.mul(u,d),l=x}return p}}function Bo(e){if(e%rn===yo){let t=(e+N)/rn;return function(i,o){let s=i.pow(o,t);if(!i.eql(i.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%si===oi){let t=(e-oi)/si;return function(i,o){let s=i.mul(o,Rt),r=i.pow(s,t),a=i.mul(o,r),c=i.mul(i.mul(a,Rt),r),l=i.mul(a,i.sub(c,i.ONE));if(!i.eql(i.sqr(l),o))throw new Error("Cannot find square root");return l}}return e%ko,_o(e)}var $o=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=$o.reduce((i,o)=>(i[o]="function",i),t);return kt(e,n)}function So(e,t,n){if(n<H)throw new Error("Expected power > 0");if(n===H)return e.ONE;if(n===N)return t;let i=e.ONE,o=t;for(;n>H;)n&N&&(i=e.mul(i,o)),o=e.sqr(o),n>>=N;return i}function Ao(e,t){let n=new Array(t.length),i=t.reduce((s,r,a)=>e.is0(r)?s:(n[a]=s,e.mul(s,r)),e.ONE),o=e.inv(i);return t.reduceRight((s,r,a)=>e.is0(r)?s:(n[a]=e.mul(s,n[a]),e.mul(s,r)),o),n}function ln(e,t){let n=t!==void 0?t:e.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function ai(e,t,n=!1,i={}){if(e<=H)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:o,nByteLength:s}=ln(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let r=Bo(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:ae(o),ZERO:H,ONE:N,create:c=>K(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return H<=c&&c<e},is0:c=>c===H,isOdd:c=>(c&N)===N,neg:c=>K(-c,e),eql:(c,l)=>c===l,sqr:c=>K(c*c,e),add:(c,l)=>K(c+l,e),sub:(c,l)=>K(c-l,e),mul:(c,l)=>K(c*l,e),pow:(c,l)=>So(a,c,l),div:(c,l)=>K(c*Ce(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ce(c,e),sqrt:i.sqrt||(c=>r(a,c)),invertBatch:c=>Ao(a,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>n?je(c,s):rt(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?Ie(c):F(c)}});return Object.freeze(a)}function ri(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function pn(e){let t=ri(e);return t+Math.ceil(t/2)}function ci(e,t,n=!1){let i=e.length,o=ri(t),s=pn(t);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);let r=n?F(e):Ie(e),a=K(r,t-N)+N;return n?je(a,o):rt(a,o)}var Io=BigInt(0),dn=BigInt(1);function li(e,t){let n=(o,s)=>{let r=s.negate();return o?r:s},i=o=>{let s=Math.ceil(t/o)+1,r=2**(o-1);return{windows:s,windowSize:r}};return{constTimeNegate:n,unsafeLadder(o,s){let r=e.ZERO,a=o;for(;s>Io;)s&dn&&(r=r.add(a)),a=a.double(),s>>=dn;return r},precomputeWindow(o,s){let{windows:r,windowSize:a}=i(s),c=[],l=o,d=l;for(let p=0;p<r;p++){d=l,c.push(d);for(let u=1;u<a;u++)d=d.add(l),c.push(d);l=d.double()}return c},wNAF(o,s,r){let{windows:a,windowSize:c}=i(o),l=e.ZERO,d=e.BASE,p=BigInt(2**o-1),u=2**o,x=BigInt(o);for(let h=0;h<a;h++){let f=h*c,m=Number(r&p);r>>=x,m>c&&(m-=u,r+=dn);let g=f,k=f+Math.abs(m)-1,y=h%2!==0,B=m<0;m===0?d=d.add(n(y,s[g])):l=l.add(n(B,s[k]))}return{p:l,f:d}},wNAFCached(o,s,r,a){let c=o._WINDOW_SIZE||1,l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,a(l))),this.wNAF(c,l,r)}}}function un(e){return cn(e.Fp),kt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ln(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function jo(e){let t=un(e);kt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:i,a:o}=t;if(n){if(!i.eql(o,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Co,hexToBytes:Oo}=an,Pt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=Pt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],i=e.subarray(2,n+2);if(!n||i.length!==n)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Co(i),l:e.subarray(n+2)}},toSig(e){let{Err:t}=Pt,n=typeof e=="string"?Oo(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let i=n.length;if(i<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==i-2)throw new t("Invalid signature: incorrect length");let{d:o,l:s}=Pt._parseInt(n.subarray(2)),{d:r,l:a}=Pt._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:r}},hexFromSig(e){let t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let d=l.toString(16);return d.length&1?`0${d}`:d},i=t(n(e.s)),o=t(n(e.r)),s=i.length/2,r=o.length/2,a=n(s),c=n(r);return`30${n(r+s+4)}02${c}${o}02${a}${i}`}},gt=BigInt(0),et=BigInt(1),ba=BigInt(2),pi=BigInt(3),va=BigInt(4);function Ro(e){let t=jo(e),{Fp:n}=t,i=t.toBytes||((h,f,m)=>{let g=f.toAffine();return ht(Uint8Array.from([4]),n.toBytes(g.x),n.toBytes(g.y))}),o=t.fromBytes||(h=>{let f=h.subarray(1),m=n.fromBytes(f.subarray(0,n.BYTES)),g=n.fromBytes(f.subarray(n.BYTES,2*n.BYTES));return{x:m,y:g}});function s(h){let{a:f,b:m}=t,g=n.sqr(h),k=n.mul(g,h);return n.add(n.add(k,n.mul(h,f)),m)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function r(h){return typeof h=="bigint"&&gt<h&&h<t.n}function a(h){if(!r(h))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(h){let{allowedPrivateKeyLengths:f,nByteLength:m,wrapPrivateKey:g,n:k}=t;if(f&&typeof h!="bigint"){if(h instanceof Uint8Array&&(h=Ct(h)),typeof h!="string"||!f.includes(h.length))throw new Error("Invalid key");h=h.padStart(m*2,"0")}let y;try{y=typeof h=="bigint"?h:F(z("private key",h,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof h}`)}return g&&(y=K(y,k)),a(y),y}let l=new Map;function d(h){if(!(h instanceof p))throw new Error("ProjectivePoint expected")}class p{constructor(f,m,g){if(this.px=f,this.py=m,this.pz=g,f==null||!n.isValid(f))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(g==null||!n.isValid(g))throw new Error("z required")}static fromAffine(f){let{x:m,y:g}=f||{};if(!f||!n.isValid(m)||!n.isValid(g))throw new Error("invalid affine point");if(f instanceof p)throw new Error("projective point not allowed");let k=y=>n.eql(y,n.ZERO);return k(m)&&k(g)?p.ZERO:new p(m,g,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){let m=n.invertBatch(f.map(g=>g.pz));return f.map((g,k)=>g.toAffine(m[k])).map(p.fromAffine)}static fromHex(f){let m=p.fromAffine(o(z("pointHex",f)));return m.assertValidity(),m}static fromPrivateKey(f){return p.BASE.multiply(c(f))}_setWindowSize(f){this._WINDOW_SIZE=f,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:f,y:m}=this.toAffine();if(!n.isValid(f)||!n.isValid(m))throw new Error("bad point: x or y not FE");let g=n.sqr(m),k=s(f);if(!n.eql(g,k))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:f}=this.toAffine();if(n.isOdd)return!n.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){d(f);let{px:m,py:g,pz:k}=this,{px:y,py:B,pz:S}=f,E=n.eql(n.mul(m,S),n.mul(y,k)),A=n.eql(n.mul(g,S),n.mul(B,k));return E&&A}negate(){return new p(this.px,n.neg(this.py),this.pz)}double(){let{a:f,b:m}=t,g=n.mul(m,pi),{px:k,py:y,pz:B}=this,S=n.ZERO,E=n.ZERO,A=n.ZERO,C=n.mul(k,k),D=n.mul(y,y),L=n.mul(B,B),P=n.mul(k,y);return P=n.add(P,P),A=n.mul(k,B),A=n.add(A,A),S=n.mul(f,A),E=n.mul(g,L),E=n.add(S,E),S=n.sub(D,E),E=n.add(D,E),E=n.mul(S,E),S=n.mul(P,S),A=n.mul(g,A),L=n.mul(f,L),P=n.sub(C,L),P=n.mul(f,P),P=n.add(P,A),A=n.add(C,C),C=n.add(A,C),C=n.add(C,L),C=n.mul(C,P),E=n.add(E,C),L=n.mul(y,B),L=n.add(L,L),C=n.mul(L,P),S=n.sub(S,C),A=n.mul(L,D),A=n.add(A,A),A=n.add(A,A),new p(S,E,A)}add(f){d(f);let{px:m,py:g,pz:k}=this,{px:y,py:B,pz:S}=f,E=n.ZERO,A=n.ZERO,C=n.ZERO,D=t.a,L=n.mul(t.b,pi),P=n.mul(m,y),W=n.mul(g,B),Y=n.mul(k,S),T=n.add(m,g),w=n.add(y,B);T=n.mul(T,w),w=n.add(P,W),T=n.sub(T,w),w=n.add(m,k);let b=n.add(y,S);return w=n.mul(w,b),b=n.add(P,Y),w=n.sub(w,b),b=n.add(g,k),E=n.add(B,S),b=n.mul(b,E),E=n.add(W,Y),b=n.sub(b,E),C=n.mul(D,w),E=n.mul(L,Y),C=n.add(E,C),E=n.sub(W,C),C=n.add(W,C),A=n.mul(E,C),W=n.add(P,P),W=n.add(W,P),Y=n.mul(D,Y),w=n.mul(L,w),W=n.add(W,Y),Y=n.sub(P,Y),Y=n.mul(D,Y),w=n.add(w,Y),P=n.mul(W,w),A=n.add(A,P),P=n.mul(b,w),E=n.mul(T,E),E=n.sub(E,P),P=n.mul(T,W),C=n.mul(b,C),C=n.add(C,P),new p(E,A,C)}subtract(f){return this.add(f.negate())}is0(){return this.equals(p.ZERO)}wNAF(f){return x.wNAFCached(this,l,f,m=>{let g=n.invertBatch(m.map(k=>k.pz));return m.map((k,y)=>k.toAffine(g[y])).map(p.fromAffine)})}multiplyUnsafe(f){let m=p.ZERO;if(f===gt)return m;if(a(f),f===et)return this;let{endo:g}=t;if(!g)return x.unsafeLadder(this,f);let{k1neg:k,k1:y,k2neg:B,k2:S}=g.splitScalar(f),E=m,A=m,C=this;for(;y>gt||S>gt;)y&et&&(E=E.add(C)),S&et&&(A=A.add(C)),C=C.double(),y>>=et,S>>=et;return k&&(E=E.negate()),B&&(A=A.negate()),A=new p(n.mul(A.px,g.beta),A.py,A.pz),E.add(A)}multiply(f){a(f);let m=f,g,k,{endo:y}=t;if(y){let{k1neg:B,k1:S,k2neg:E,k2:A}=y.splitScalar(m),{p:C,f:D}=this.wNAF(S),{p:L,f:P}=this.wNAF(A);C=x.constTimeNegate(B,C),L=x.constTimeNegate(E,L),L=new p(n.mul(L.px,y.beta),L.py,L.pz),g=C.add(L),k=D.add(P)}else{let{p:B,f:S}=this.wNAF(m);g=B,k=S}return p.normalizeZ([g,k])[0]}multiplyAndAddUnsafe(f,m,g){let k=p.BASE,y=(S,E)=>E===gt||E===et||!S.equals(k)?S.multiplyUnsafe(E):S.multiply(E),B=y(this,m).add(y(f,g));return B.is0()?void 0:B}toAffine(f){let{px:m,py:g,pz:k}=this,y=this.is0();f==null&&(f=y?n.ONE:n.inv(k));let B=n.mul(m,f),S=n.mul(g,f),E=n.mul(k,f);if(y)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:B,y:S}}isTorsionFree(){let{h:f,isTorsionFree:m}=t;if(f===et)return!0;if(m)return m(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:f,clearCofactor:m}=t;return f===et?this:m?m(p,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return this.assertValidity(),i(p,this,f)}toHex(f=!0){return Ct(this.toRawBytes(f))}}p.BASE=new p(t.Gx,t.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);let u=t.nBitLength,x=li(p,t.endo?Math.ceil(u/2):u);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:r}}function Po(e){let t=un(e);return kt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function di(e){let t=Po(e),{Fp:n,n:i}=t,o=n.BYTES+1,s=2*n.BYTES+1;function r(w){return gt<w&&w<n.ORDER}function a(w){return K(w,i)}function c(w){return Ce(w,i)}let{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:p,isWithinCurveOrder:u}=Ro({...t,toBytes(w,b,v){let _=b.toAffine(),$=n.toBytes(_.x),j=ht;return v?j(Uint8Array.from([b.hasEvenY()?2:3]),$):j(Uint8Array.from([4]),$,n.toBytes(_.y))},fromBytes(w){let b=w.length,v=w[0],_=w.subarray(1);if(b===o&&(v===2||v===3)){let $=F(_);if(!r($))throw new Error("Point is not on curve");let j=p($),R=n.sqrt(j),O=(R&et)===et;return(v&1)===1!==O&&(R=n.neg(R)),{x:$,y:R}}else if(b===s&&v===4){let $=n.fromBytes(_.subarray(0,n.BYTES)),j=n.fromBytes(_.subarray(n.BYTES,2*n.BYTES));return{x:$,y:j}}else throw new Error(`Point of length ${b} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),x=w=>Ct(rt(w,t.nByteLength));function h(w){let b=i>>et;return w>b}function f(w){return h(w)?a(-w):w}let m=(w,b,v)=>F(w.slice(b,v));class g{constructor(b,v,_){this.r=b,this.s=v,this.recovery=_,this.assertValidity()}static fromCompact(b){let v=t.nByteLength;return b=z("compactSignature",b,v*2),new g(m(b,0,v),m(b,v,2*v))}static fromDER(b){let{r:v,s:_}=Pt.toSig(z("DER",b));return new g(v,_)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new g(this.r,this.s,b)}recoverPublicKey(b){let{r:v,s:_,recovery:$}=this,j=A(z("msgHash",b));if($==null||![0,1,2,3].includes($))throw new Error("recovery id invalid");let R=$===2||$===3?v+t.n:v;if(R>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let O=($&1)===0?"02":"03",U=l.fromHex(O+x(R)),M=c(R),tt=a(-j*M),At=a(_*M),G=l.BASE.multiplyAndAddUnsafe(U,tt,At);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Ot(this.toDERHex())}toDERHex(){return Pt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ot(this.toCompactHex())}toCompactHex(){return x(this.r)+x(this.s)}}let k={isValidPrivateKey(w){try{return d(w),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{let w=pn(t.n);return ci(t.randomBytes(w),t.n)},precompute(w=8,b=l.BASE){return b._setWindowSize(w),b.multiply(BigInt(3)),b}};function y(w,b=!0){return l.fromPrivateKey(w).toRawBytes(b)}function B(w){let b=w instanceof Uint8Array,v=typeof w=="string",_=(b||v)&&w.length;return b?_===o||_===s:v?_===2*o||_===2*s:w instanceof l}function S(w,b,v=!0){if(B(w))throw new Error("first arg must be private key");if(!B(b))throw new Error("second arg must be public key");return l.fromHex(b).multiply(d(w)).toRawBytes(v)}let E=t.bits2int||function(w){let b=F(w),v=w.length*8-t.nBitLength;return v>0?b>>BigInt(v):b},A=t.bits2int_modN||function(w){return a(E(w))},C=ae(t.nBitLength);function D(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(gt<=w&&w<C))throw new Error(`bigint expected < 2^${t.nBitLength}`);return rt(w,t.nByteLength)}function L(w,b,v=P){if(["recovered","canonical"].some(lt=>lt in v))throw new Error("sign() legacy options not supported");let{hash:_,randomBytes:$}=t,{lowS:j,prehash:R,extraEntropy:O}=v;j==null&&(j=!0),w=z("msgHash",w),R&&(w=z("prehashed msgHash",_(w)));let U=A(w),M=d(b),tt=[D(M),D(U)];if(O!=null){let lt=O===!0?$(n.BYTES):O;tt.push(z("extraEntropy",lt))}let At=ht(...tt),G=U;function qt(lt){let ut=E(lt);if(!u(ut))return;let me=c(ut),q=l.BASE.multiply(ut).toAffine(),ot=a(q.x);if(ot===gt)return;let st=a(me*a(G+ot*M));if(st===gt)return;let he=(q.x===ot?0:2)|Number(q.y&et),Mt=st;return j&&h(st)&&(Mt=f(st),he^=1),new g(ot,Mt,he)}return{seed:At,k2sig:qt}}let P={lowS:t.lowS,prehash:!1},W={lowS:t.lowS,prehash:!1};function Y(w,b,v=P){let{seed:_,k2sig:$}=L(w,b,v),j=t;return sn(j.hash.outputLen,j.nByteLength,j.hmac)(_,$)}l.BASE._setWindowSize(8);function T(w,b,v,_=W){let $=w;if(b=z("msgHash",b),v=z("publicKey",v),"strict"in _)throw new Error("options.strict was renamed to lowS");let{lowS:j,prehash:R}=_,O,U;try{if(typeof $=="string"||$ instanceof Uint8Array)try{O=g.fromDER($)}catch(q){if(!(q instanceof Pt.Err))throw q;O=g.fromCompact($)}else if(typeof $=="object"&&typeof $.r=="bigint"&&typeof $.s=="bigint"){let{r:q,s:ot}=$;O=new g(q,ot)}else throw new Error("PARSE");U=l.fromHex(v)}catch(q){if(q.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(j&&O.hasHighS())return!1;R&&(b=t.hash(b));let{r:M,s:tt}=O,At=A(b),G=c(tt),qt=a(At*G),lt=a(M*G),ut=l.BASE.multiplyAndAddUnsafe(U,qt,lt)?.toAffine();return ut?a(ut.x)===M:!1}return{CURVE:t,getPublicKey:y,getSharedSecret:S,sign:Y,verify:T,ProjectivePoint:l,Signature:g,utils:k}}var Oe=class extends Zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Gn(t);let i=se(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?t.create().update(i).digest():i);for(let r=0;r<s.length;r++)s[r]^=54;this.iHash.update(s),this.oHash=t.create();for(let r=0;r<s.length;r++)s[r]^=106;this.oHash.update(s),s.fill(0)}update(t){return Ft(this),this.iHash.update(t),this}digestInto(t){Ft(this),tn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:i,finished:o,destroyed:s,blockLen:r,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=r,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},fn=(e,t,n)=>new Oe(e,t).update(n).digest();fn.create=(e,t)=>new Oe(e,t);function Lo(e){return{hash:e,hmac:(t,...n)=>fn(e,t,Xn(...n)),randomBytes:Be}}function ui(e,t){let n=i=>di({...e,...Lo(i)});return Object.freeze({...n(t),create:n})}var Ue=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Re=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),hi=BigInt(1),Pe=BigInt(2),fi=(e,t)=>(e+t/Pe)/t;function gi(e){let t=Ue,n=BigInt(3),i=BigInt(6),o=BigInt(11),s=BigInt(22),r=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,d=l*l*e%t,p=X(d,n,t)*d%t,u=X(p,n,t)*d%t,x=X(u,Pe,t)*l%t,h=X(x,o,t)*x%t,f=X(h,s,t)*h%t,m=X(f,a,t)*f%t,g=X(m,c,t)*m%t,k=X(g,a,t)*f%t,y=X(k,n,t)*d%t,B=X(y,r,t)*h%t,S=X(B,i,t)*l%t,E=X(S,Pe,t);if(!hn.eql(hn.sqr(E),e))throw new Error("Cannot find square root");return E}var hn=ai(Ue,void 0,void 0,{sqrt:gi}),bn=ui({a:BigInt(0),b:BigInt(7),Fp:hn,n:Re,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=Re,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-hi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,r=BigInt("0x100000000000000000000000000000000"),a=fi(s*e,t),c=fi(-i*e,t),l=K(e-a*n-c*o,t),d=K(-a*i-c*s,t),p=l>r,u=d>r;if(p&&(l=t-l),u&&(d=t-d),l>r||d>r)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:p,k1:l,k2neg:u,k2:d}}}},Se),Ne=BigInt(0),xi=e=>typeof e=="bigint"&&Ne<e&&e<Ue,Uo=e=>typeof e=="bigint"&&Ne<e&&e<Re,mi={};function Le(e,...t){let n=mi[e];if(n===void 0){let i=Se(Uint8Array.from(e,o=>o.charCodeAt(0)));n=ht(i,i),mi[e]=n}return Se(ht(n,...t))}var vn=e=>e.toRawBytes(!0).slice(1),gn=e=>rt(e,32),mn=e=>K(e,Ue),re=e=>K(e,Re),yn=bn.ProjectivePoint,No=(e,t,n)=>yn.BASE.multiplyAndAddUnsafe(e,t,n);function xn(e){let t=bn.utils.normPrivateKeyToScalar(e),n=yn.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:re(-t),bytes:vn(n)}}function bi(e){if(!xi(e))throw new Error("bad x: need 0 < x < p");let t=mn(e*e),n=mn(t*e+BigInt(7)),i=gi(n);i%Pe!==Ne&&(i=mn(-i));let o=new yn(e,i,hi);return o.assertValidity(),o}function vi(...e){return re(F(Le("BIP0340/challenge",...e)))}function qo(e){return xn(e).bytes}function Mo(e,t,n=Be(32)){let i=z("message",e),{bytes:o,scalar:s}=xn(t),r=z("auxRand",n,32),a=gn(s^F(Le("BIP0340/aux",r))),c=Le("BIP0340/nonce",a,o,i),l=re(F(c));if(l===Ne)throw new Error("sign failed: k is zero");let{bytes:d,scalar:p}=xn(l),u=vi(d,o,i),x=new Uint8Array(64);if(x.set(d,0),x.set(gn(re(p+u*s)),32),!yi(x,i,o))throw new Error("sign: Invalid signature produced");return x}function yi(e,t,n){let i=z("signature",e,64),o=z("message",t),s=z("publicKey",n,32);try{let r=bi(F(s)),a=F(i.subarray(0,32));if(!xi(a))return!1;let c=F(i.subarray(32,64));if(!Uo(c))return!1;let l=vi(gn(a),vn(r),o),d=No(r,c,re(-l));return!(!d||!d.hasEvenY()||d.toAffine().x!==a)}catch{return!1}}var Yt={getPublicKey:qo,sign:Mo,verify:yi,utils:{randomPrivateKey:bn.utils.randomPrivateKey,lift_x:bi,pointToBytes:vn,numberToBytesBE:rt,bytesToNumberBE:F,taggedHash:Le,mod:K}};var zo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var wi=e=>e instanceof Uint8Array;var Me=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ct=(e,t)=>e<<32-t|e>>>t,Ko=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ko)throw new Error("Non little-endian hardware is not supported");var Ho=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ce(e){if(!wi(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ho[e[n]];return t}function Do(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function wn(e){if(typeof e=="string"&&(e=Do(e)),!wi(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var qe=class{clone(){return this._cloneInto()}};function kn(e){let t=i=>e().update(wn(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function En(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Wo(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function ki(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Vo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");En(e.outputLen),En(e.blockLen)}function Fo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Zo(e,t){ki(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Yo={number:En,bool:Wo,bytes:ki,hash:Vo,exists:Fo,output:Zo},ze=Yo;function Go(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let o=BigInt(32),s=BigInt(4294967295),r=Number(n>>o&s),a=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,r,i),e.setUint32(t+l,a,i)}var Ke=class extends qe{constructor(t,n,i,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Me(this.buffer)}update(t){ze.exists(this);let{view:n,buffer:i,blockLen:o}=this;t=wn(t);let s=t.length;for(let r=0;r<s;){let a=Math.min(o-this.pos,s-r);if(a===o){let c=Me(t);for(;o<=s-r;r+=o)this.process(c,r);continue}i.set(t.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ze.exists(this),ze.output(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:o,isLE:s}=this,{pos:r}=this;n[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>o-r&&(this.process(i,0),r=0);for(let p=r;p<o;p++)n[p]=0;Go(i,o-8,BigInt(this.length*8),s),this.process(i,0);let a=Me(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)a.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:o,finished:s,destroyed:r,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=r,o%n&&t.buffer.set(i),t}};var Jo=(e,t,n)=>e&t^~e&n,Qo=(e,t,n)=>e&t^e&n^t&n,Xo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Et=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_t=new Uint32Array(64),He=class extends Ke{constructor(){super(64,32,8,!1),this.A=Et[0]|0,this.B=Et[1]|0,this.C=Et[2]|0,this.D=Et[3]|0,this.E=Et[4]|0,this.F=Et[5]|0,this.G=Et[6]|0,this.H=Et[7]|0}get(){let{A:t,B:n,C:i,D:o,E:s,F:r,G:a,H:c}=this;return[t,n,i,o,s,r,a,c]}set(t,n,i,o,s,r,a,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=s|0,this.F=r|0,this.G=a|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)_t[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let u=_t[p-15],x=_t[p-2],h=ct(u,7)^ct(u,18)^u>>>3,f=ct(x,17)^ct(x,19)^x>>>10;_t[p]=f+_t[p-7]+h+_t[p-16]|0}let{A:i,B:o,C:s,D:r,E:a,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let u=ct(a,6)^ct(a,11)^ct(a,25),x=d+u+Jo(a,c,l)+Xo[p]+_t[p]|0,f=(ct(i,2)^ct(i,13)^ct(i,22))+Qo(i,o,s)|0;d=l,l=c,c=a,a=r+x|0,r=s,s=o,o=i,i=x+f|0}i=i+this.A|0,o=o+this.B|0,s=s+this.C|0,r=r+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,o,s,r,a,c,l,d)}roundClean(){_t.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},_n=class extends He{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Ei=kn(()=>new He),Ha=kn(()=>new _n);var Gt=Symbol("verified"),ts=e=>e instanceof Object;function es(e){if(!ts(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let i=0;i<n.length;i++)if(typeof n[i]!="string")return!1}return!0}var Ja=new TextDecoder("utf-8"),ns=new TextEncoder;function is(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var os=class{value;next=null;prev=null;constructor(e){this.value=e}},ss=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new os(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},as=class{generateSecretKey(){return Yt.utils.randomPrivateKey()}getPublicKey(e){return ce(Yt.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=ce(Yt.getPublicKey(t)),n.id=Bn(n),n.sig=ce(Yt.sign(Bn(n),t)),n[Gt]=!0,n}verifyEvent(e){if(typeof e[Gt]=="boolean")return e[Gt];let t=Bn(e);if(t!==e.id)return e[Gt]=!1,!1;try{let n=Yt.verify(e.sig,t,e.pubkey);return e[Gt]=n,n}catch{return e[Gt]=!1,!1}}};function rs(e){if(!es(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Bn(e){let t=Ei(ns.encode(rs(e)));return ce(t)}var De=new as,Qa=De.generateSecretKey,Xa=De.getPublicKey,tr=De.finalizeEvent,cs=De.verifyEvent,ls=22242;function ps(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let i=n.slice(1),o=e[`#${i}`];if(o&&!t.tags.find(([s,r])=>s===n.slice(1)&&o.indexOf(r)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function ds(e,t){for(let n=0;n<e.length;n++)if(ps(e[n],t))return!0;return!1}function us(e,t){let n=t.length+3,i=e.indexOf(`"${t}":`)+n,o=e.slice(i).indexOf('"')+i+1;return e.slice(o,o+64)}function fs(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let i=t+7+1+n,o=e.slice(i+1,80).indexOf('"');if(o===-1)return null;let s=i+1+o;return e.slice(i+1,s)}function ms(e,t){return{kind:ls,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function hs(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var _i=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Bi=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new ss;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=is(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){let n=new Bi(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{let n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,this.ws?.close(),this.onclose?.()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await hs();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=fs(e);if(t){let n=this.openSubs.get(t);if(!n)return;let i=us(e,"id"),o=n.alreadyHaveEvent?.(i);if(n.receivedEvent?.(this,i),o)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{let i=this.openSubs.get(n[1]),o=n[2];this.verifyEvent(o)&&ds(i.filters,o)&&i.onevent(o);return}case"COUNT":{let i=n[1],o=n[2],s=this.openCountRequests.get(i);s&&(s.resolve(o.count),this.openCountRequests.delete(i));return}case"EOSE":{let i=this.openSubs.get(n[1]);if(!i)return;i.receivedEose();return}case"OK":{let i=n[1],o=n[2],s=n[3],r=this.openEventPublishes.get(i);r&&(clearTimeout(r.timeout),o?r.resolve(s):r.reject(new Error(s)),this.openEventPublishes.delete(i));return}case"CLOSED":{let i=n[1],o=this.openSubs.get(i);if(!o)return;o.closed=!0,o.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new _i(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){let t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,i)=>{try{let o=await e(ms(this.url,t)),s=setTimeout(()=>{let r=this.openEventPublishes.get(o.id);r&&(r.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:i,timeout:s}),this.send('["AUTH",'+JSON.stringify(o)+"]")}catch(o){console.warn("subscribe auth function failed:",o)}}),this.authPromise)}async publish(e){let t=new Promise((n,i)=>{let o=setTimeout(()=>{let s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:i,timeout:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,i=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),i}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||(t.label?t.label+":":"sub:")+this.serial,i=new gs(this,n,e,t);return this.openSubs.set(n,i),i}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close(),this.onclose?.()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},gs=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,i){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=i.alreadyHaveEvent,this.receivedEvent=i.receivedEvent,this.eoseTimeout=i.eoseTimeout||e.baseEoseTimeout,this.oneose=i.oneose,this.onclose=i.onclose,this.onevent=i.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof _i))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},$i;try{$i=WebSocket}catch{}var $n=class extends Bi{constructor(e){super(e,{verifyEvent:cs,websocketImplementation:$i})}static async connect(e){let t=new $n(e);return await t.connect(),t}};function Jt(e){return typeof window>"u"&&e.unref(),e}var Si=["wss://purplepag.es","wss://user.kindpag.es","wss://relay.nos.social","wss://relay.nostr.band","wss://nostr.land","wss://indexer.coracle.social"];var dt,Bt,le,Qt,We,Sn=class{constructor(){Z(this,Qt);Z(this,dt,new Map);Z(this,Bt,new Map);Z(this,le,3e4)}async disconnect(t){if(I(this,dt).has(t)){let n=I(this,dt).get(t);n.ws.readyState<2&&await n.close()?.catch(console.log),I(this,dt).delete(t),clearTimeout(I(this,Bt).get(t)),I(this,Bt).delete(t)}}async disconnectAll(){for(let t of I(this,dt).keys())await this.disconnect(t)}async getEvents(t,n,i=5e3){let o=[],s=n.map(async a=>{try{let c=await J(this,Qt,We).call(this,a);return new Promise(l=>{let d=c.subscribe([t],{onevent:u=>{o.push(u)},onclose:()=>{clearTimeout(p),l()},oneose:()=>{clearTimeout(p),l()}}),p=Jt(setTimeout(()=>{d.close(),l()},i))})}catch(c){console.error(`Failed to get events from ${a}`,c)}}),r=await Promise.allSettled(s);if(r.some(a=>a.status==="rejected"))throw new Error(r[0].reason);return o}async getEventsAsap(t,n,i=5e3){return new Promise(o=>{let s=new Map,r=null,a=Jt(setTimeout(()=>{s.forEach(l=>l.close()),o([])},i)),c=0;for(let l of n)J(this,Qt,We).call(this,l).then(d=>{if(r)return;let p=[],u=d.subscribe([t],{onevent:x=>{r||(r=u,s.forEach(h=>{h!==r&&h.close()}),clearTimeout(a)),u===r&&p.push(x)},onclose:()=>{(++c).length<n.length||(clearTimeout(a),o(p))},oneose:()=>{u===r&&(clearTimeout(a),o(p)),u.close()}});s.set(l,u)}).catch(d=>{console.error(`Nostr relay error at ${l}: ${d}`)})})}async sendEvent(t,n,i=3e3){let o=n.map(async r=>{try{let a=await J(this,Qt,We).call(this,r),c=Jt(setTimeout(()=>{throw new Error(`Timeout sending event to ${r}`)},i));await a.publish(t),clearTimeout(c)}catch(a){console.error(`Failed to send event to ${r}`,a)}}),s=await Promise.allSettled(o);if(s.some(r=>r.status==="rejected"))throw new Error(s[0].reason)}};dt=new WeakMap,Bt=new WeakMap,le=new WeakMap,Qt=new WeakSet,We=async function(t){if(I(this,dt).has(t)){clearTimeout(I(this,Bt).get(t)),I(this,Bt).set(t,Jt(setTimeout(()=>this.disconnect(t),I(this,le))));let i=I(this,dt).get(t);return await i.connect(),i}let n=new $n(t);return I(this,dt).set(t,n),await n.connect(),I(this,Bt).set(t,Jt(setTimeout(()=>this.disconnect(t),I(this,le)))),n};var pe=new Sn;async function Ai(e,t){if(!e.pubkey||!e.kind||!e.dTag)throw new Error("Missing args");return t??=(await Ii(e.pubkey))[e.pubkey],t.write.length===0?void 0:(await pe.getEvents({authors:[e.pubkey],kinds:[e.kind],"#d":[e.dTag],limit:1},t.write)).sort((i,o)=>o.created_at-i.created_at)[0]}async function Ti(e,t){switch(t.code){case"WRITE_RELAYS":{if((e.authors?.length??0)===0&&(t.authors?.length??0)===0)throw new Error("Missing authors");let n=t.authors||e.authors,i=Object.entries(await Ii(n)).map(([a,c])=>[a,c.write]),o={};i.forEach(a=>a[1].forEach(c=>{o[c]??=0,o[c]++}));let s=Object.entries(o).sort(([,a],[,c])=>c-a).map(([a])=>a),r=t.maxRelaysPerUser||2;if(e.authors){let a={},c={};s.forEach(m=>{i.forEach(([g,k])=>{k.includes(m)&&(a[g]??=0,!(++a[g]>r)&&(c[m]??=[],c[m].push(g)))})});let l=Object.entries(c).map(([m,g])=>pe.getEventsAsap({...e,authors:g},[m])),p=(await Promise.allSettled(l)).filter(m=>m.status==="fulfilled"&&m.value).flatMap(m=>m.value).sort((m,g)=>g.created_at-m.created_at),u=[],x=new Set,h=new Set,f=m=>{let g;if(m.kind>=1e4&&m.kind<2e4||m.kind===0||m.kind===3?g="":g=m.tags.find(y=>y[0]==="d")?.[1],typeof g=="string")return`${m.kind}:${m.pubkey}:${g}`};for(let m of p){if(e.limit&&u.length===e.limit)break;if(x.has(m.id))continue;let g=f(m);if(g){if(h.has(g))continue;h.add(g)}x.add(m.id),u.push(m)}return u}else{let a=new Set;return i.forEach(c=>{let l=0;for(let d of s){if(l===r)break;c[1].includes(d)&&(l++,a.add(d))}}),pe.getEventsAsap(e,[...a])}}default:throw new Error("Pick a strategy")}}async function Ii(e){Array.isArray(e)||(e=[e]);let t=await pe.getEvents({authors:e,kinds:[10002],limit:e.length},Si),n={},i={read:!0,write:!0},o=Object.keys(i),s,r=e.reduce((c,l)=>({...c,[l]:{read:new Set,write:new Set}}),{}),a=t.sort((c,l)=>l.created_at-c.created_at).filter(c=>(!n[c.pubkey]&&e.includes(c.pubkey)&&(n[c.pubkey]=!0),n[c.pubkey])).reduce((c,l)=>((l.tags??[]).filter(d=>d[0]==="r"&&/^wss?:\/\//.test(d[1])).forEach(d=>{s=[d[2]].filter(p=>i[p]),s.length===0&&(s=o),s.forEach(p=>c[l.pubkey][p].add(d[1]))}),c),r);for(let c in a)o.forEach(l=>{a[c][l]=[...a[c][l]]});return a}async function ji(e){let t=Qe(e);return pt("get",[t],"bundles").then(n=>n.result&&bs(n.result))}async function Ci(e){let t=Qe(e);return pt("delete",[t],"bundles")}async function Ve(e,t){let n=xs(e,t);return pt("put",[n],"bundles")}function xs(e,{hasUpdate:t=!1,lastOpenedAsSingleNappAt:n=0}={}){let i=e.tags.find(l=>l[0]==="d")?.[1]??"";if(!zn(i))throw new Error("Invalid d tag");let{kind:o,pubkey:s,meta:r,...a}=e,c={37448:"a",37449:"b",37450:"c"}[o];if(!c)throw new Error("Invalid kind");return{c,p:Nn(s),d:i,u:t,s:n,evt:a}}function bs(e){let t={a:37448,b:37449,c:37450}[e.c];if(!t)throw new Error("Invalid channel");return{kind:t,pubkey:be(e.p),...e.evt,meta:{hasUpdate:e.u,lastOpenedAsSingleNappAt:e.s}}}async function An(e,t){let n=await ji(e);return n||(n=await Ai(t),n&&await Ve(n),n)}async function*Tn(e,t,n,i){if(i??=Dt(n,t.tags),!i)throw new Error(`No matching file tag found for path: ${n}`);let o=i[1],s=await we(e,o);if(s.count===s.total){yield{progress:100,newlyCachedChunkIndexRanges:[]};return}let a=[i[4]?.trim(),t.pubkey].filter(Boolean);if(!s.total&&(s.count&&(await ke(e,o),s.count=0),s=yield*Oi(o,[0,1,2,3],a,t,e,s),!s.total))throw new Error("Some chunks are missing");let c={};for await(let d of mt(e,o,{justKeys:!0}))c[d[2]]=!0;let l=[...Array(s.total).keys()].filter(d=>!c[d]);if(s=yield*Oi(o,l,a,t,e,s),!s.total||s.count<s.total)throw new Error("Some chunks are missing")}async function*Oi(e,t,n,i,o,s){let r=0,a=s.total,c=[],l=()=>Math.floor((s.count+r)/a*100),d=p=>{if(p.length===0)return[];let u=[...p].sort((m,g)=>m-g),x=[],h=u[0],f=u[0];for(let m=1;m<u.length;m++)u[m]===f+1?f=u[m]:(x.push([h,f]),h=f=u[m]);return x.push([h,f]),x};for(let p=0;p<t.length;p+=4){let u=t.slice(p,p+4),x=0,h=!1;for(;!h&&x<20;){let f={authors:n,"#c":u.map(g=>`${e}:${g}`),limit:u.length},m=await Ti(f,{code:"WRITE_RELAYS",maxRelaysPerUser:7});if(m){if(h=!0,m.length>0){await Zn(i,m,o),r+=m.length;for(let k of m){let y=k.tags.find(B=>B[0]==="c"&&B[1].startsWith(`${e}:`));if(y){let B=parseInt(y[1].split(":")[1]);Number.isNaN(B)||c.push(B)}}if(!a){for(let k of m)if(a=vs(k,e))break}if(!a)continue;let g=d(c);yield{progress:l(),newlyCachedChunkIndexRanges:g},c.length=0}}else x++,console.log(`Failed to fetch chunks (${x}). Retrying...`),await new Promise(g=>setTimeout(g,Math.pow(2,Math.min(10,x))*1e3))}if(!h){console.log("Failed to fetch chunks after multiple retries");break}}return{count:s.count+r,total:a}}function vs(e,t){let n=e.tags.find(o=>o[0]==="c"&&o[1].startsWith(`${t}:`));if(!n)return null;let i=parseInt(n[2]);if(Number.isNaN(i))return null;if(i>0)return i}var Ri={"application/prs.cww":["cww"],"application/prs.xsf+xml":["xsf"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["*xfdf"],"application/vnd.age":["age"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.autodesk.fbx":["fbx"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dcmp+xml":["dcmp"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["*fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.slides":["ggs"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.drawing":["gdraw"],"application/vnd.google-apps.form":["gform"],"application/vnd.google-apps.jam":["gjam"],"application/vnd.google-apps.map":["gmap"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.script":["gscript"],"application/vnd.google-apps.site":["gsite"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.gov.sk.xmldatacontainer+xml":["xdcf"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mapbox-vector-tile":["mvt"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["*mpp","mpt"],"application/vnd.ms-visio.viewer":["vdx"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.nato.bindingdataobject+xml":["bdo"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.procrate.brushset":["brushset"],"application/vnd.procreate.brush":["brush"],"application/vnd.procreate.dream":["drm"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.pwg-xhtml-print+xml":["xhtm"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml","uo"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw","vsdx","vtx"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blender":["blend"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-compressed":["*rar"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-ipynb+json":["ipynb"],"application/x-iso9660-image":["*iso"],"application/x-iwork-keynote-sffkey":["*key"],"application/x-iwork-numbers-sffnumbers":["*numbers"],"application/x-iwork-pages-sffpages":["*pages"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["*prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["*sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zip-compressed":["*zip"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["*aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif","btf"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-adobe-dng":["dng"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.bary":["bary"],"model/vnd.cld":["cld"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["*mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.pytha.pyox":["pyo","pyox"],"model/vnd.sap.vds":["vds"],"model/vnd.usda":["usda"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.familysearch.gedcom":["ged"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]};Object.freeze(Ri);var Pi=Ri;var Li={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Li);var Ui=Li;var nt=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Xt,de,Lt,In=class{constructor(...t){Xt.set(this,new Map),de.set(this,new Map),Lt.set(this,new Map);for(let n of t)this.define(n)}define(t,n=!1){for(let[i,o]of Object.entries(t)){i=i.toLowerCase(),o=o.map(a=>a.toLowerCase()),nt(this,Lt,"f").has(i)||nt(this,Lt,"f").set(i,new Set);let s=nt(this,Lt,"f").get(i),r=!0;for(let a of o){let c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),r&&nt(this,de,"f").set(i,a),r=!1,c)continue;let l=nt(this,Xt,"f").get(a);if(l&&l!=i&&!n)throw new Error(`"${i} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);nt(this,Xt,"f").set(a,i)}}return this}getType(t){if(typeof t!="string")return null;let n=t.replace(/^.*[/\\]/s,"").toLowerCase(),i=n.replace(/^.*\./s,"").toLowerCase(),o=n.length<t.length;return!(i.length<n.length-1)&&o?null:nt(this,Xt,"f").get(i)??null}getExtension(t){return typeof t!="string"?null:(t=t?.split?.(";")[0],(t&&nt(this,de,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:nt(this,Lt,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(let t of nt(this,Lt,"f").values())Object.freeze(t);return this}_getTestState(){return{types:nt(this,Xt,"f"),extensions:nt(this,de,"f")}}};Xt=new WeakMap,de=new WeakMap,Lt=new WeakMap;var jn=In;var Cn=new jn(Ui,Pi)._freeze();var ys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&'()*+,-./:;<=>?@[]^_`{|}~ ",ws=(()=>{let e=new Int16Array(128);e.fill(93);for(let t=0;t<93;t++)e[ys.charCodeAt(t)]=t;return e})();function ue(e,t=0,n=-1){let i=t+n;(n<0||i>e.length)&&(i=e.length);let o=new Uint8Array(Math.ceil((i-t)*7/8)),s=0,r=0,a=-1,c=0;for(let l=t;l<i;l++){let d=e.charCodeAt(l);if(d>126)continue;let p=ws[d];if(p!==93)if(a===-1)a=p;else{let u=a+p*93;for(a=-1,s|=u<<r,r+=(u&8191)>456?13:14;r>7;)o[c++]=s&255,s>>>=8,r-=8}}return a!==-1&&(o[c++]=(s|a<<r)&255),o.subarray(0,c)}async function qi(e,t=!1){let i=e.getCachedMetadata(e.appId,["icon"])?.icon;return t&&i?(Ni(e,i),i):i||await Ni(e)}async function Mi(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.name;return t&&(i!==void 0||n?.description!==void 0)?(Fe(e),i):i!==void 0?i:(await Fe(e))?.name?.trim()||null}async function zi(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.description;return t&&(i!==void 0||n?.name!==void 0)?(Fe(e),i):i!==void 0?i:(await Fe(e))?.description?.trim()||null}async function Ni(e,t=null){let n=e.getFaviconMetadata();if(!n)return null;if(t&&t.fx===n.rootHash)return t;try{let i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0});i.isCached||(await e.cacheFile(null,n.tag),i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0}));let o=[];for await(let p of mt(e.appId,n.rootHash))o.push(p.evt.content);if(o.length===0)return null;let s=o.map(p=>ue(p)),r=new Blob(s,{type:n.contentType}),a=new FileReader,l=await new Promise((p,u)=>{a.onload=()=>p(a.result),a.onerror=u,a.readAsDataURL(r)}),d={fx:n.rootHash,url:l};return e.cacheMetadata(e.appId,{icon:d}),d}catch(i){return console.log("Failed to fetch icon:",i),null}}async function Fe(e){try{let t=await e.getFileCacheStatus("/",null,{withMeta:!0});t.isCached||await e.cacheFile("/",null);let n=[];for await(let p of mt(e.appId,t.fileRootHash))n.push(p.evt.content);if(n.length===0)return{name:void 0,description:void 0};let i=n.map(p=>ue(p)),o=new Blob(i,{type:t.contentType}),s=new FileReader,a=await new Promise((p,u)=>{s.onload=()=>p(s.result),s.onerror=u,s.readAsText(o)}),{name:c,description:l}=ks(a),d={};return c!==void 0&&(d.name=c),l!==void 0&&(d.description=l),Object.keys(d).length>0&&e.cacheMetadata(e.appId,d),{name:c,description:l}}catch(t){return console.log("Failed to fetch HTML metadata:",t),{name:void 0,description:void 0}}}function ks(e){let t,n;try{let i=/<title[^>]*>([\s\S]*?)<\/title>/i,o=e.match(i);o&&o[1]&&(t=o[1].trim());let s=/<meta\s+[^>]*name\s*=\s*["']description["'][^>]*content\s*=\s*["']([^"']+)["'][^>]*>/i,r=e.match(s);if(r&&r[1]&&(n=r[1].trim()),!n){let a=/<meta\s+[^>]*content\s*=\s*["']([^"']+)["'][^>]*name\s*=\s*["']description["'][^>]*>/i,c=e.match(a);c&&c[1]&&(n=c[1].trim())}}catch(i){console.log("Error parsing HTML metadata:",i)}return{name:t,description:n}}function Es(e,t){if(!e||!t)throw new Error("Missing args");["name","description","icon"].forEach(n=>{let i=t[n];switch(n){case"icon":i=i?.fx&&i?.url&&{fx:i.fx,url:i.url};break;case"description":i=(i?.length??0)>255?`${i.slice(0,252)}...`:i;break;case"name":i=(i?.length??0)>100?`${i.slice(0,97)}...`:i;break}i&&vt(localStorage,`session_appById_${e}_${n}`,i)})}function _s(e,t=["name","description","icon"]){if(!e)return;let n={};return t.forEach(i=>{let o=localStorage.getItem(`session_appById_${e}_${i}`);if(o){try{o=JSON.parse(o)}catch{console.log(`Error parsing "${i}" metadata from app "${e}"`);return}n[i]=o}}),n}function Ki(e){return e?/^(?:text\/|application\/json)[^;]*$/.test(e)?`${e}; charset=utf-8`:e:"application/octet-stream"}var Hi=Symbol("createToken"),Ut,it,Di,te,Nt,On,Rn,$t,xt,Wi,St=class{constructor(t,n){Z(this,it);Z(this,te);Z(this,Nt,{});Z(this,$t,!1);Z(this,xt,{});if(t!==Hi)throw new Error("Use AppFileCacher.create(appAddress) to instantiate this class.");Object.assign(this,n)}static async create(t,n,{cacheMetadata:i=Es,getCachedMetadata:o=_s}={}){if(I(this,Ut)[t])return I(this,Ut)[t];let s=Promise.withResolvers();I(this,Ut)[t]=s.promise,n??=ne(t);let r,a;do r=await An(t,n),r||(a++,console.log("Retrying bundle fetching"),await new Promise(l=>setTimeout(l,Math.pow(2,Math.min(10,a))*1e3)));while(!r&&a<20);r||(delete I(this,Ut)[t],s.reject(new Error(`Couldn't find bundle after ${a} attempts`)));let c=new this(Hi,{appId:t,addressObj:n,bundle:r,cacheMetadata:i,getCachedMetadata:o});return s.resolve(c),s.promise}async getIcon(t=!1){return qi(this,t)}async getName(t=!1){return Mi(this,t)}async getDescription(t=!1){return zi(this,t)}async clearAppFiles(){await J(this,it,Di).call(this),await ke(this.appId),await Ci(this.appId)}updateBundleMetadata(t){if(!t)throw new Error("Missing metadata arg");return Ve(this.bundle,{...this.bundle.meta,...t})}getFaviconMetadata(){if(I(this,te))return I(this,te);let t,n=this.bundle.tags.find(i=>i[0]==="file"&&/^favicon\.\w{3,}$/.test(i[2])&&(!!i[3]&&i[3].startsWith("image/")&&(t=i[3])||((t=Cn.getType(i[2]))||"").startsWith("image/")));if(n)return zt(this,te,{rootHash:n[1],filename:n[2],mimeType:t,contentType:Ki(t),relayHints:[n[4]].filter(Boolean),tag:n})}getFileRootHash(t,n){if(n??=Dt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);return n[1]}async getFileCacheStatus(t,n,{withMeta:i=!1}={}){if(n??=Dt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let o=this.getFileRootHash(null,n),s=await we(this.appId,o);if(!i)return{isCached:s.count===s.total};let r=n[3]&&n[3].startsWith("image/")?n[3]:Cn.getType(n[2]);return{...s,isCached:s.count===s.total,mimeType:r,contentType:Ki(r),isHtml:/^text\/html\b/.test(r),fileRootHash:o,fileTag:n}}async cacheFile(t,n,i,{shouldCacheMissingFiles:o=!navigator.connection?.metered}={}){if(n??=Dt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let s=n[2],r=J(this,it,On).call(this,s);if(i&&(r.subscribers.add(i),r.result!==null&&i(r.result),r.error)){i({error:r.error});return}let a=Promise.withResolvers();return r.subscribers.add(({progress:c,error:l,newlyCachedChunkIndexRanges:d})=>{if(c>=100){if(a.resolve(),!o)return;this.cacheMissingAppFiles(s)}else l&&a.reject(l)}),J(this,it,Wi).call(this,s,n),a.promise}async cacheMissingAppFiles(t){if(!I(this,$t)){zt(this,$t,!0);try{let n={...t&&{[t]:!0}},i=this.bundle.tags.filter(o=>o[0]!=="file"||!o[1]||!o[2]||n[o[2]]?!1:n[o[2]]=!0);for(let o of i){if(!I(this,$t))break;await this.cacheFile(`/${o[2]}`,o,null,{shouldCacheMissingFiles:!1})}}finally{zt(this,$t,!1)}}}};Ut=new WeakMap,it=new WeakSet,Di=async function(){zt(this,$t,!1);for(let t in I(this,Nt)){let n=I(this,Nt)[t],i=new Error("Cache operation aborted");n.error=i;for(let o of n.subscribers)try{o({error:i})}catch(s){console.log(s)}J(this,it,Rn).call(this,t)}zt(this,xt,{})},te=new WeakMap,Nt=new WeakMap,On=function(t){if(!t)throw new Error("No filename");return I(this,Nt)[t]??={subscribers:new Set,result:null,error:null}},Rn=function(t){delete I(this,Nt)[t]},$t=new WeakMap,xt=new WeakMap,Wi=async function(t,n){if(I(this,xt)[t])return;I(this,xt)[t]=!0;let i=Tn(this.appId,this.bundle,t,n),o=J(this,it,On).call(this,t);try{for await(let{progress:r,newlyCachedChunkIndexRanges:a}of i){if(!I(this,xt)[t])break;o.result={progress:r,newlyCachedChunkIndexRanges:a};for(let c of o.subscribers)try{c({progress:r,newlyCachedChunkIndexRanges:a})}catch(l){console.log(l)}}if(!I(this,xt)[t]||o.result?.progress>=100)return;let s=new Error(`File caching incomplete, stopped at ${o.result?.progress??0}%`);o.error=s;for(let r of o.subscribers)try{r({error:s})}catch(a){console.log(a)}}catch(s){o.error=s;for(let r of o.subscribers)try{r({error:s})}catch(a){console.log(a)}}finally{J(this,it,Rn).call(this,t),delete I(this,xt)[t]}},Z(St,Ut,{});async function Bs(e,t,n){try{let i=n.map(l=>ue(l)),o=new Blob(i,{type:t.contentType}),s=new FileReader,a=await new Promise((l,d)=>{s.onload=()=>l(s.result),s.onerror=d,s.readAsDataURL(o)}),c={fx:t.rootHash,url:a};return vt(localStorage,`session_appById_${e}_icon`,c),c}catch(i){console.log("Failed to update icon storage:",i)}}async function oc(e,t,n,i,o,s,r,a,c,l,d,{signal:p,isSingleNapp:u=!1}={}){let x=Mn(e),h=It(x)===JSON.parse(localStorage.getItem("session_defaultUserPk")),f=new URL(JSON.parse(localStorage.getItem("config_vaultUrl")));document.querySelector(`iframe[src="${f.href.replace(/\/$/,"")}"]`)||console.warn("Vault iframe not found");let g=ne(t),k=await St.create(t,g);u&&k.updateBundleMetadata({lastOpenedAsSingleNappAt:Date.now()});let y=null,B=null;p?.addEventListener("abort",()=>{y&&(y.close(),y=null),B&&(B.close(),B=null)},{once:!0});let S,E=location.origin.replace("//",`//${n}.`);window.addEventListener("message",T=>{T.data.code!=="TRUSTED_IFRAME_READY"||T.source!==o.contentWindow||T.origin!==E||(S?.abort(),S=new AbortController,y&&y.close(),y=T.ports[0],D(y,AbortSignal.any([p,S.signal])),C(n,i))},{signal:p});let A=!1;function C(T,w=""){if(A)return;A=!0;let b;window.addEventListener("message",_=>{_.data.code!=="APP_IFRAME_READY"||_.source!==s.contentWindow||_.origin!==E||(b?.abort(),b=new AbortController,B&&B.close(),B=_.ports[0],Y(B,AbortSignal.any([p,b.signal])))},{signal:p});let v=window.location.host;r(`//${T}.${v}${w}`)}function D(T,w){T.addEventListener("message",async b=>{switch(b.data.code){case"STREAM_APP_FILE":{let v=(_,$=new Error("FILE_NOT_CACHED"))=>(_&&console.log(_),Q(b,{error:$,isLast:!0},{to:T}));try{let _=await k.getFileCacheStatus(b.data.payload.pathname,null,{withMeta:!0});if(!_.isCached)if(_.isHtml)v(null,new Error("HTML_FILE_NOT_CACHED"));else{let{fileRootHash:j,total:R}=_,O=0,U=-1,M=!1,tt=!1,At=async({progress:G,newlyCachedChunkIndexRanges:qt,error:lt})=>{if(M||tt)return;if(lt){M=!0;let q=a(),{[b.data.payload.pathname]:ot,...st}=q;return a(st),v(lt)}let ut=b.data.payload.pathname,me=a();if(a({...me,[ut]:{progress:G,totalByteSizeEstimate:R?(R-1)*51e3:0}}),G>=100&&setTimeout(()=>{let q=a(),{[ut]:ot,...st}=q;a(st)},1e3),qt.length>0)for(let q of qt)U=Math.max(U,q[1]);else if(R!==null)U=R-1;else return v(new Error("No cached chunks"));for(;O<=U&&!M&&!tt;)try{let q=await Fn(t,j,{fromPos:O,toPos:O});if(q.length===0)return M=!0,v(new Error(`Missing chunk at index ${O} for rootHash ${j}`));let ot=q[0];if(R===null){let he=ot.evt.tags.find(Un=>Un[0]==="c"&&Un[1].startsWith(`${j}:`)),Mt=parseInt(he?.[2]);!Number.isNaN(Mt)&&Mt>0&&(R=Mt)}if(R===null)return M=!0,v(new Error("Unable to determine total chunks."));let st=R!=null&&O===R-1;Q(b,{payload:{content:ot.evt.content,...O===0&&{contentType:_.contentType}},isLast:st},{to:T}),O++,st&&(tt=!0)}catch(q){return M=!0,v(q)}};try{return k.cacheFile(b.data.payload.pathname,_.fileTag,At)}catch(G){return v(G)}}let $=0;for await(let j of mt(t,k.getFileRootHash(b.data.payload.pathname)))Q(b,{payload:{content:j.evt.content,...$===0&&{contentType:_.contentType}},isLast:++$===_.total},{to:T})}catch(_){return v(_,_)}break}}},{signal:w}),T.start(),jt(T,{code:"BROWSER_READY",payload:null})}let L=new Map,P=new Map;async function W(T,w,{timeoutMs:b=1750}={}){if(L.has(T))return L.get(T);P.has(T)||P.set(T,{icon:!1,name:!1,promise:null});let v=P.get(T);if(v.promise)return v.promise;w??=ne(T);let _=await St.create(T,w),$={id:T,napp:Kn(w)},j=[];!("icon"in $)&&!v.icon&&(v.icon=!0,j.push(_.getIcon().then(O=>O&&($.icon=O)).finally(()=>{v.icon=!1}))),!("name"in $)&&!v.name&&(v.name=!0,j.push(_.getName().then(O=>O&&($.name=O)).finally(()=>{v.name=!1})));let R=(async()=>{if(j.length>0){let O=Promise.all(j).then(()=>L.set(T,$));await Promise.race([O,new Promise(U=>setTimeout(U,b))])}return L.set(T,$),P.delete(T),$})();return v.promise=R,R}function Y(T,w){T.addEventListener("message",async b=>{switch(b.data.code){case"OPEN_APP":{let v;try{let{href:_}=b.data.payload,j=new URL(_,self.location.origin).pathname,R=/^\/(\+{1,3}[a-zA-Z0-9]{48,})/,O=j.match(R);if(!O){console.error("Invalid app URL format:",_);break}let U=O[1],M=ve(U);v=Ht(M);let tt=await W(v,M,{timeoutMs:0});await l({app:await W(t,g),name:"openApp",eKind:null,meta:{targetApp:tt}}),d(_)}catch(_){let $=!1;for(let j of JSON.parse(localStorage.getItem("session_workspaceKeys"))??[])if($=Array.isArray(JSON.parse(localStorage.getItem(`session_workspaceByKey_${j}_appById_${v}_appKeys`))),$)break;$||(vt(localStorage,`session_appById_${v}_icon`,void 0),vt(localStorage,`session_appById_${v}_name`,void 0),vt(localStorage,`session_appById_${v}_description`,void 0),vt(localStorage,`session_appById_${v}_relayHints`,void 0),await(await St.create(v)).clearAppFiles()),console.error("Error in OPEN_APP handler:",_)}break}case"NIP07":{if(["peek_public_key","get_public_key"].includes(b.data.payload.method)&&b.data.payload.ns[0]===""&&b.data.payload.ns.length===1){Q(b,{payload:x},{to:T});break}let{ns:v,method:_,params:$=[]}=b.data.payload,j=await W(t,g,{timeoutMs:0}),R;try{R=await Ts(c,x,v,_,$,{isDefaultUser:h,requestPermission:l,app:j})}catch(O){R={error:O}}Q(b,R,{to:T});break}case"WINDOW_NAPP":{$s(b);break}case"STREAM_APP_ICON":{try{let v=k.getFaviconMetadata();if(!v){Q(b,{error:new Error("No favicon"),isLast:!0},{to:T});break}let _=await k.getFileCacheStatus(null,v.tag,{withMeta:!0});_.isCached||(await k.cacheFile(null,v.tag),_=await k.getFileCacheStatus(null,v.tag,{withMeta:!0}));let j=JSON.parse(localStorage.getItem(`session_appById_${t}_icon`))?.fx!==v.rootHash,R=[],O=0;for await(let U of mt(t,v.rootHash))j&&R.push(U.evt.content),Q(b,{payload:{content:U.evt.content,...O===0&&{mimeType:v.mimeType||_.mimeType,contentType:v.contentType||_.contentType}},isLast:++O===_.total},{to:T});if(R.length>0){let{url:U}=await Bs(t,v,R);if(L.has(t)){let M=L.get(t);M.icon={fx:v.rootHash,url:U}}}}catch(v){console.log(v.stack),Q(b,{error:v,isLast:!0},{to:T})}break}case"CACHE_APP_FILE":{try{let v=({progress:_,error:$})=>{if($)Q(b,{error:$,isLast:!0},{to:T});else{let j=_>=100;Q(b,{payload:_,isLast:j},{to:T})}};k.cacheFile(b.data.payload.pathname,null,v)}catch(v){console.log(b.data.payload.pathname,"error:",v.stack),Q(b,{error:v,isLast:!0},{to:T})}break}}},{signal:w}),T.start(),jt(T,{code:"BROWSER_READY",payload:null})}}function $s(e){return Q(e,{error:new Error("Not implemented yet")})}var Ss={getPublicKey:"readProfile",signEvent:"signEvent",nip04Encrypt:"encrypt",nip04Decrypt:"decrypt",nip44Encrypt:"encrypt",nip44Decrypt:"decrypt"};function As(e){return Ss[e]||(()=>{throw new Error(`Unknown method ${e}`)})()}async function Ts(e,t,n,i,o,{isDefaultUser:s,requestPermission:r,app:a}={}){if(s)throw new Error("Please login");if(r){let p=i.includes("_")?i.replace(/_([a-z0-9])/g,(x,h)=>h.toUpperCase()):i,u=(()=>{switch(p){case"signEvent":return o?.[0]?.kind;default:return null}})();await r({app:a,name:As(p),eKind:u,meta:{params:o}})}let{napp:c,...l}=a,d={code:"NIP07",payload:{app:{...l,id:c},pubkey:t,ns:n,method:i,params:o}};return e(d,{timeout:12e4})}function Pn(){return It(Is(),43)}function Is(){let e=crypto.getRandomValues(new Uint8Array(40)),n=2n**256n-0x14551231950b75fc4402da1732fc9bebfn;return(((r,a)=>{let c=r%a;return c>=0n?c:a+c})((r=>BigInt("0x"+(be(r)||"0")))(e),n-1n)+1n).toString(16).padStart(64,"0")}var Fi=["+32PaEXMJYPC2Hj9F1oRFfg7RTwdBlbFuPQE85fvjsF2ygI4cPTw0YoUh","+cB3lFAQviXRJmg7z5TJJoPALS3CKwd2Pvs2rSVW5hflKR70lfbqbBklPQ"].map(ve).map(Ht);function js(){let e=Vt(localStorage);return xe("hardcoded_newAppIdsObj",{}),V(()=>{if(e.session_workspaceKeys$())return;let t=Pn();e.session_defaultUserPk$(t),Vi({userPk:t,storage:e,isFirstTimeUser:!0})}),V(()=>{if(!e.session_workspaceKeys$())return;let t=e.session_workspaceKeys$()||[],n=e.session_defaultUserPk$();t.forEach(i=>{let o=e[`session_workspaceByKey_${i}_userPk$`]();o!=null&&o!==n&&!(e[`session_accountByUserPk_${o}_isReadOnly$`]()??!1)&&e[`session_accountByUserPk_${o}_isLocked$`](!0)})}),V(({track:t})=>{if(t(()=>e.session_workspaceKeys$().length>0))return;let n=Pn();e.session_defaultUserPk$(n),Vi({userPk:n,storage:e,isFirstTimeUser:!0})}),e}function Vi({userPk:e,storage:t,isFirstTimeUser:n}){let i=Fi.map((r,a)=>({id:r,key:Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),visibility:"closed",isNew:!1})),o=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);t.config_isSingleWindow$()===void 0&&t.config_isSingleWindow$(!1);let s=[];t[`session_workspaceByKey_${o}_openAppKeys$`](s),t[`session_workspaceByKey_${o}_userPk$`](e),i.forEach(r=>{t[`session_workspaceByKey_${o}_appById_${r.id}_appKeys$`]([r.key]),t[`session_appByKey_${r.key}_id$`](r.id),t[`session_appByKey_${r.key}_visibility$`](r.visibility),t[`session_appByKey_${r.key}_route$`]("")}),t[`session_workspaceByKey_${o}_unpinnedCoreAppIdsObj$`]({}),t[`session_workspaceByKey_${o}_pinnedAppIds$`](i.map(({id:r})=>r)),t[`session_workspaceByKey_${o}_unpinnedAppIds$`]([]),t[`session_accountByUserPk_${e}_isReadOnly$`](!0),t[`session_accountByUserPk_${e}_isLocked$`](!1),t[`session_accountByUserPk_${e}_profile$`]({npub:Hn(qn(e)),meta:{events:[]}}),t[`session_accountByUserPk_${e}_relays$`]({meta:{events:[]}}),t.session_accountUserPks$([e]),t.session_workspaceKeys$([o]),t.session_openWorkspaceKeys$([o])}async function Ln(e,t){let n=t.session_workspaceKeys$()||[],i=t.session_openWorkspaceKeys$()||[],o=t.session_defaultUserPk$(),s=n.length===1&&n.every(l=>t[`session_workspaceByKey_${l}_userPk$`]()===o);if(e.length===0&&s)return;let r=t.session_accountUserPks$()||[],a=e.map(l=>It(l.pubkey)),c;if(e.forEach(l=>{let d=It(l.pubkey);t[`session_accountByUserPk_${d}_isReadOnly$`](c=l.isReadOnly??!1),t[`session_accountByUserPk_${d}_isLocked$`](c?!1:l.isLocked??!0),t[`session_accountByUserPk_${d}_profile$`](l.profile),t[`session_accountByUserPk_${d}_relays$`](l.relays)}),s&&a.length===1){let l=n[0],d=a[0],p=t[`session_workspaceByKey_${l}_openAppKeys$`]()||[],u=[];p.forEach(x=>{t[`session_appByKey_${x}_visibility$`](h=>(h==="open"&&u.push(x),"closed"))}),t[`session_workspaceByKey_${l}_openAppKeys$`]([]),t[`session_workspaceByKey_${l}_userPk$`](d),await new Promise(x=>window.requestIdleCallback(()=>window.requestIdleCallback(x,{timeout:50}),{timeout:100})),u.forEach(x=>{t[`session_appByKey_${x}_visibility$`]("open")}),t[`session_workspaceByKey_${l}_openAppKeys$`](u),t.session_defaultUserPk$(void 0)}else{let l=a.filter(y=>!r.includes(y)),d=r.filter(y=>!a.includes(y));l.length>0&&o&&t.session_defaultUserPk$(void 0);let p=[];for(let y of d)p=p.concat(n.filter(B=>t[`session_workspaceByKey_${B}_userPk$`]()===y));let u=[];for(let y of l){let B=Fi.map(E=>({id:E,key:Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),visibility:"closed",isNew:!1})),S=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);u.push(S),t[`session_workspaceByKey_${S}_openAppKeys$`]([]),t[`session_workspaceByKey_${S}_userPk$`](y),B.forEach(E=>{t[`session_workspaceByKey_${S}_appById_${E.id}_appKeys$`]([E.key]),t[`session_appByKey_${E.key}_id$`](E.id),t[`session_appByKey_${E.key}_visibility$`](E.visibility),t[`session_appByKey_${E.key}_route$`]("")}),t[`session_workspaceByKey_${S}_unpinnedCoreAppIdsObj$`]({}),t[`session_workspaceByKey_${S}_pinnedAppIds$`](B.map(({id:E})=>E)),t[`session_workspaceByKey_${S}_unpinnedAppIds$`]([])}let x=new Set(p),h=n.filter(y=>!x.has(y)).concat(u),f=new Set(h),m=i.filter(y=>f.has(y)),g=new Set(m),k=m.concat(h.filter(y=>!g.has(y)));t.session_openWorkspaceKeys$(k),t.session_workspaceKeys$(h);for(let y of p){let B=t[`session_workspaceByKey_${y}_pinnedAppIds$`]()||[],S=t[`session_workspaceByKey_${y}_unpinnedAppIds$`]()||[],E=[...new Set([...B,...S])];t[`session_workspaceByKey_${y}_unpinnedCoreAppIdsObj$`](void 0),t[`session_workspaceByKey_${y}_pinnedAppIds$`](void 0),t[`session_workspaceByKey_${y}_unpinnedAppIds$`](void 0),t[`session_workspaceByKey_${y}_userPk$`](void 0),t[`session_workspaceByKey_${y}_openAppKeys$`](void 0),E.forEach(A=>{(t[`session_workspaceByKey_${y}_appById_${A}_appKeys$`]()||[]).forEach(D=>{t[`session_appByKey_${D}_id$`](void 0),t[`session_appByKey_${D}_visibility$`](void 0),t[`session_appByKey_${D}_route$`](void 0)}),t[`session_workspaceByKey_${y}_appById_${A}_appKeys$`](void 0)})}}t.session_accountUserPks$(a),r.filter(l=>!a.includes(l)).forEach(l=>{t[`session_accountByUserPk_${l}_isReadOnly$`](void 0),t[`session_accountByUserPk_${l}_isLocked$`](void 0),t[`session_accountByUserPk_${l}_profile$`](void 0),t[`session_accountByUserPk_${l}_relays$`](void 0)})}function Cs(e){let t=`theme-${Math.random().toString(36).slice(2)}`,n={},i=`.${t} {
${Object.entries(e).map(([o,s],r,a)=>{let c=`--${o.replace(/([A-Z])/g,"-$1").toLowerCase()}`;return n[o]=`var(${c})`,`  ${c}: ${s};`+(a.length-1===r?"":`
`)}).join("")}
}
`;return[t,n,i]}var[Os,Rs,Ps]=Cs({bg:"oklch(0.12 0 256)",bgFont:"oklch(0.87 0.01 256)",header:"oklch(0.25 0.01 256)",headerBorder:"#101011",headerFont:"oklch(0.72 0 256)",subtleBg:"oklch(0.29 0.01 256)",mg:"oklch(0.22 0 256)",mgLighter:"oklch(0.25 0 256)",mgBorder:"oklch(0.35 0 256)",mgFont:"oklch(0.79 0 256)",fg:"oklch(0.35 0 256)",fgPrimary:"oklch(0.44 0.16 291.61)",fgSecondary:"oklch(0.53 0.13 56.36)",fgFont:"oklch(0.71 0.01 256)",ffg:"oklch(0.49 0.01 17.47)",accentPrimary:"oklch(0.56 0.25 302.32)",accentSecondary:"oklch(0.56 0.20 87.32)",primary:"oklch(0.65 0.20 280)",secondary:"oklch(0.70 0.15 65)",logo:"oklch(0.27 0.20 280)",counter:"oklch(0.63 0 0)",error:"oklch(0.55 0.22 25)"}),bc={defaultTheme:Ps},vc={defaultTheme:Os},yc={colors:Rs},fe={breakpoints:{mobile:"(max-width: 718px)",desktop:"(min-width: 719px)"}};var _c=Tt("aModal",function(){let e=Kt({dialogRef$:null,render:this.props.render,shouldAlwaysDisplay$:this.props.shouldAlwaysDisplay$??this.props.shouldAlwaysDisplay??!1,isOpen$:this.props.isOpen$,close:this.props.close,afterClose:this.props.afterClose});return V(({track:t})=>{t(()=>e.isOpen$.get())?e.dialogRef$().showModal():e.dialogRef$().close()},{after:"rendering"}),this.h`
    <dialog
      ref=${e.dialogRef$}
      data-name='modal'
      closedby='any'
      onclose=${e.close}
      class="scope_g7h2g1"
    >
      <style>
        .scope_g7h2g1 {
          & /* &:modal are those opened with showModal() instead of show() */ {
            container-type: normal;
            --duration: .3s;
            /* display: none; (default) */
            transition:
              overlay var(--duration) ease-in-out allow-discrete,
              display var(--duration) ease-in-out allow-discrete;
            /* reset [popover] */
            &:focus-visible { outline: 0; }
            color: initial;
            background-color: initial;
            padding: 0;
            border: 0;
            inset: initial;
            width: initial;
            height: initial;
            overflow: initial;
            /* reset [dialog] */
            inset-inline-start: initial;
            inset-inline-end: initial;
          }

          /* &:popover-open, */ &[open] /* after dialog.showModal() */ {
            /* --modal-state: open; /* only for dialog modal */
          }

          /* &:popover-open::backdrop, */ &[open]::backdrop {
            opacity: 0.6;
            backdrop-filter: blur(1px);

            @starting-style {
              opacity: 0;
              backdrop-filter: blur(0px);
            }
          }

          &::backdrop {
            /* display: none; (default) */
            opacity: 0;
            backdrop-filter: blur(0px);
            position: absolute;
            inset: 0;
            background-color: black;
            transition:
              opacity var(--duration) ease-in-out,
              backdrop-filter var(--duration) ease-in-out,
              overlay var(--duration) ease-in-out allow-discrete,
              display var(--duration) ease-in-out allow-discrete;
          }
        }
      </style>
      <div
        data-name='modalContentContainer'
        class="scope_f82h1k"
      >
        <style>
          ${`.scope_f82h1k {
            & {
              position: fixed;
              transition: var(--duration) ease-in-out;
              border-top-right-radius: 17px; /* for scrollbar */
              overflow: hidden; /* for scrollbar */

              @media ${fe.breakpoints.desktop} {
                transition-property: bottom, transform;
                bottom: 0;
                transform: translate(-50%, 100%);
                left: 50%;
                /* @container style(:popover-open), style(--modal-state: open) { */
                .scope_g7h2g1[open] & {
                  bottom: 50%;
                  transform: translate(-50%, 50%);
                  @starting-style {
                    bottom: 0;
                    transform: translate(-50%, 100%);
                  }
                }
                border-bottom-right-radius: 17px; /* for scrollbar */
              }

              @media ${fe.breakpoints.mobile} {
                transition-property: top, transform;
                transform: translate(0, 0);
                top: 100%;
                /* @container style(:popover-open), style(--modal-state: open) { */
                .scope_g7h2g1[open] & {
                  transform: translate(0, -100%);
                  @starting-style {
                    transform: translate(0, 0);
                  }
                }
              }
            }
          }`}
        </style>
        <div
          data-name='modalContent'
          class="scope_j3k1h2"
        >
          <style>
            ${`.scope_j3k1h2 {
              & {
                overflow-y: auto;
                /*
                  https://gist.github.com/adamcbrewer/5859738
                  https://stackoverflow.com/questions/5736503/how-to-make-css3-rounded-corners-hide-overflow-in-chrome-opera
                  the scroll without this ignores border-radius
                  but it will blur content
                  mask-image: -webkit-radial-gradient(circle, white, black);
                */

                display: flex;
                flex-direction: column;
                /* background-color: white; */
                min-height: 50px; /* when there is loading (dynamic content) */

                @media ${fe.breakpoints.desktop} {
                  border-radius: 17px;
                  min-width: 400px;
                  width: 800px;
                  max-width: 90vw;
                  max-width: 90dvw;
                  max-height: 90vh; /* leave 10 for browser collapsible header */
                  max-height: 90dvh;
                }

                @media ${fe.breakpoints.mobile} {
                  border-top-left-radius: 17px;
                  border-top-right-radius: 17px;
                  width: 100vw;
                  width: 100dvw;
                  max-height: 85vh;
                  max-height: 85dvh;
                }
              }

              ${(e.shouldAlwaysDisplay$.get()||"")&&`
                content-visibility: auto;
                contain-intrinsic-width: auto 400px;
                contain-intrinsic-height: auto 200px;
              `}
            }`}
          </style>
          ${(e.shouldAlwaysDisplay$.get()||e.isOpen$.get()||"")&&(e.render?.call(this)??"")}
        </div>
      </div>
    </dialog>
  `},{useShadowDOM:!1});function Ze(e){return e?Ls(e):ee("<a-modal>")}function Ls(e){return ee("<a-modal>",e)}Tt("vaultModal",function(){let e=Ze(),t=Kt(()=>({...e,shouldAlwaysDisplay$:!0,render:Ge(function(){return this.h`<vault-messenger />`})}));return this.h`<a-modal props=${t} />`});Tt("vaultMessenger",function(){let{isFirstRun$:e,vaultPort$:t,vaultIframeRef$:n,vaultIframeSrc$:i,isVaultMessengerReady$:o,widgetHeight$:s,isWorkarounEnabled$:r}=ge("vaultMessenger",()=>({isWorkarounEnabled$:!0,disableStartAtVaultHomeWorkaroundThisTime(){this.isWorkarounEnabled$(!1)},isFirstRun$:!0,vaultPort$:null,vaultIframeRef$:null,vaultIframeSrc$:"about:blank",isVaultMessengerReady$:!1,widgetHeight$:0})),a=Vt(localStorage),{config_vaultUrl$:c}=a;V(()=>{c()===void 0&&c("https://44billion.github.io/44b-vault")});let{cancelPreviousRequests:l,postVaultMessage:d}=qs(t),{isOpen$:p}=Ze();return V(({track:u})=>{let x=u(()=>p());e()||x||d({code:"CLOSED_VAULT_VIEW",payload:null},{instant:!0})}),V(({track:u})=>{let x=r();r(!0);let h=u(()=>!p());e()||h||!x||d({code:"OPEN_VAULT_HOME",payload:null},{instant:!0})}),V(()=>{e(!1)}),V(async({track:u,cleanup:x})=>{u(()=>c());let h=new AbortController;x(()=>{h.abort()});let f=new URL(c()).origin,m,g=()=>{m&&m.abort()},k=y=>{m=y,y&&y.signal.addEventListener("abort",()=>{m===y&&(m=null)},{once:!0})};n().addEventListener("load",()=>{g();let y=Ns({vaultIframe:n(),vaultOrigin:f,vaultPort$:t,abortSignal:h.signal});k(y)},{signal:h.signal}),Us({vaultIframe:n(),vaultOrigin:f,vaultPort$:t,componentSignal:h.signal,widgetHeight$:s,storage:a,stopRenderHandshake:g}),o(!0)},{after:"rendering"}),V(async({track:u})=>{let[x,h]=u(()=>[o(),c()]);x&&(i(h),l(new Error("Canceled due to new vault URL selection")))}),this.h`
    <style>
      #vault {
        border: none;
        width: 100%;
        height: 100%;
        display: block; /* ensure it's not inline */
      }
    </style>
    <iframe
      allow='clipboard-write;
             publickey-credentials-create;
             publickey-credentials-get'
      style=${{height:`${s()}px`}}
      id='vault'
      ref=${n}
      src=${i()}
    />
  `});function Us({vaultIframe:e,vaultOrigin:t,vaultPort$:n,componentSignal:i,widgetHeight$:o,storage:s,stopRenderHandshake:r}){let a=Ze(),c=null;i?.addEventListener("abort",()=>{c&&(c.close(),c=null)},{once:!0});let l;window.addEventListener("message",u=>{u.data.code!=="VAULT_READY"||u.source!==e.contentWindow||u.origin!==t||!u.ports[0]||(u.data.payload.accounts?Ln(u.data.payload.accounts,s):console.log("Missing account data on vault startup"),l?.abort(),l=new AbortController,c&&c.close(),c=u.ports[0],d({vaultPort:c,signal:AbortSignal.any([i,l.signal])}),r?.(),p(c),n(c))},{signal:i});function d({vaultPort:u,signal:x}){u.addEventListener("message",h=>{switch(h.data.code){case"CHANGE_DIMENSIONS":{o(h.data.payload.height);break}case"CLOSE_VAULT_VIEW":{a.close();break}case"SET_ACCOUNTS_STATE":{if(!h.data.payload.accounts){console.log("Missing account data on vault message");break}Ln(h.data.payload.accounts,s);break}}},{signal:x}),u.start()}function p(u){jt(u,{code:"BROWSER_READY",payload:null})}}function Ns({vaultIframe:e,vaultOrigin:t,vaultPort$:n,abortSignal:i}){if(i?.aborted)return null;let o=new AbortController,{signal:s}=o,r,a=()=>{o.signal.aborted||o.abort()};i&&i.addEventListener("abort",a,{once:!0}),s.addEventListener("abort",()=>{r&&clearTimeout(r)},{once:!0});let c=40,l=0,d=()=>{if(s.aborted)return;let p=e?.contentWindow;if(!p){a();return}if(jt(p,{code:"RENDER",payload:null},{targetOrigin:t}),n()){a();return}if(l>=c){a();return}l+=1;let u=Math.min(500,50*l);r=setTimeout(d,u)};return d(),o}function qs(e){return e&&Ms(e),ge("useRequestVaultMessage")}function Ms(e){let t=Vt(localStorage),{config_vaultUrl$:n}=t,{msgQueue$:i}=ge("useRequestVaultMessage",()=>({vaultPort$:e,vaultOrigin$(){return new URL(n()).origin},msgQueue$:{waiting:[],running:[]},postVaultMessage(l){if(!this.vaultPort$())return Promise.reject(new Error("Vault not connected"));jt(e(),l)},async requestVaultMessage(l,{timeout:d,instant:p=!1}={}){if(p)return this.vaultPort$()?Xe(this.vaultPort$(),l,{...d!=null&&{timeout:d}}):Promise.reject(new Error("Vault not connected"));let u=Date.now(),x=Promise.withResolvers();return x.promise.finally(()=>{this.msgQueue$(h=>(h.running=h.running.filter(f=>f.p!==x),{...h}))}),this.msgQueue$(h=>(h.waiting.push({msg:l,timeout:d,queuedAt:u,p:x}),{...h})),x.promise},cancelPreviousRequests(l){this.msgQueue$().running.forEach(d=>d.p.resolve({code:d.msg.code,payload:null,error:l||new Error("Canceled")}))}})),o=Ze(),{session_openWorkspaceKeys$:s}=t,r=ft(()=>{let l=s()[0];return t[`session_workspaceByKey_${l}_userPk$`]()}),a=ft(()=>r()!==t.session_defaultUserPk$()||s().length>1),c=Ge(l=>a()?!1:(o.open(),l.p.resolve({code:l.msg.code,payload:null,error:new Error("Not logged in")}),!0));V(({track:l})=>{let[d,p]=l(()=>[i(),e()]);if(!p)return;let u=Math.min(5-d.running.length,d.waiting.length),x=Date.now();for(let h=0;h<u;h++){let f=d.waiting.shift();if(d.running.push(f),c(f))return;let{msg:m,timeout:g,queuedAt:k,p:y}=d.running[d.running.length-u+h];Xe(p,m,{...g!=null&&{timeout:k+g-x}}).then(B=>{y.resolve(B)})}})}Tt("nappAssetsCachingProgressBar",function(){let e;try{({cachingProgress$:e}=ee("<napp-assets-caching-progress-bar>"))}catch(r){console.warn("No cachingProgress$ store found",r);return}let t=ft(()=>Object.entries(e()).filter(([r])=>!r.startsWith("_")&&(r.startsWith("/")||r.includes(".")))),n=ft(()=>t().length>0),i=ft(()=>{let r=t();if(r.length===0)return{overallProgress:0,fileList:"",fileCount:0};let a=r.reduce((p,[u,x])=>p+x.progress,0),c=Math.round(a/r.length),l=r.map(([p])=>{let u=p.split("/").pop()||p;return u.length>20?u.slice(0,17)+"...":u}),d=l.length>3?l.slice(0,3).join(", ")+`... (+${l.length-3} more)`:l.join(", ");return{overallProgress:c,fileList:d,fileCount:r.length}}),o=ft(()=>`
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: linear-gradient(90deg,
      oklch(0.62 0.22 297.62 / 0.9) 0%,
      oklch(0.62 0.22 297.1 / 0.9) ${i().overallProgress}%,
      rgba(0, 0, 0, 0.7) ${i().overallProgress}%,
      rgba(0, 0, 0, 0.7) 100%
    );
    height: 4px;
    transition: all 0.3s ease;
    opacity: ${n()?1:0};
    transform: translateY(${n()?"0":"-100%"});
  `),s=ft(()=>`
    position: absolute;
    top: 6px;
    left: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    backdrop-filter: blur(4px);
    transition: all 0.3s ease;
    opacity: ${n()?1:0};
    transform: translateY(${n()?"0":"-100%"});
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `);return this.h`
    <div style=${o()} />
    <div style=${s()}>
      Caching ${i().fileCount} asset${i().fileCount!==1?"s":""}
      (${i().overallProgress}%): ${i().fileList}
    </div>
  `});export{Vt as a,pt as b,St as c,oc as d,js as e,bc as f,vc as g,yc as h,fe as i,Ze as j,qs as k};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
