import{a as fn,b as un,j as Te,k as mn,m as Ut,n as je,o as hn,p as Yt}from"./chunk-NID4PPA7.js";import{a as xn}from"./chunk-KN6GOQRR.js";import{b as hi,d as A,e as V,f as Rt,g as Y}from"./chunk-K2UKPH6Q.js";function gn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ae(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function vn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");gn(e.outputLen),gn(e.blockLen)}function qt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function bn(e,t){Ae(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Qt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var wn=e=>e instanceof Uint8Array;var Xt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Q=(e,t)=>e<<32-t|e>>>t,xi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!xi)throw new Error("Non little-endian hardware is not supported");function gi(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function $t(e){if(typeof e=="string"&&(e=gi(e)),!wn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function yn(...e){let t=new Uint8Array(e.reduce((i,a)=>i+a.length,0)),n=0;return e.forEach(i=>{if(!wn(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}var Ct=class{clone(){return this._cloneInto()}},$o={}.toString;function kn(e){let t=i=>e().update($t(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Jt(e=32){if(Qt&&typeof Qt.getRandomValues=="function")return Qt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function vi(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let a=BigInt(32),s=BigInt(4294967295),o=Number(n>>a&s),r=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+l,r,i)}var Ft=class extends Ct{constructor(t,n,i,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Xt(this.buffer)}update(t){qt(this);let{view:n,buffer:i,blockLen:a}=this;t=$t(t);let s=t.length;for(let o=0;o<s;){let r=Math.min(a-this.pos,s-o);if(r===a){let c=Xt(t);for(;a<=s-o;o+=a)this.process(c,o);continue}i.set(t.subarray(o,o+r),this.pos),this.pos+=r,o+=r,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){qt(this),bn(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:a,isLE:s}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>a-o&&(this.process(i,0),o=0);for(let p=o;p<a;p++)n[p]=0;vi(i,a-8,BigInt(this.length*8),s),this.process(i,0);let r=Xt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)r.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:a,finished:s,destroyed:o,pos:r}=this;return t.length=a,t.pos=r,t.finished=s,t.destroyed=o,a%n&&t.buffer.set(i),t}};var bi=(e,t,n)=>e&t^~e&n,wi=(e,t,n)=>e&t^e&n^t&n,yi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),pt=new Uint32Array(64),Ie=class extends Ft{constructor(){super(64,32,8,!1),this.A=lt[0]|0,this.B=lt[1]|0,this.C=lt[2]|0,this.D=lt[3]|0,this.E=lt[4]|0,this.F=lt[5]|0,this.G=lt[6]|0,this.H=lt[7]|0}get(){let{A:t,B:n,C:i,D:a,E:s,F:o,G:r,H:c}=this;return[t,n,i,a,s,o,r,c]}set(t,n,i,a,s,o,r,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=a|0,this.E=s|0,this.F=o|0,this.G=r|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)pt[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let m=pt[p-15],g=pt[p-2],x=Q(m,7)^Q(m,18)^m>>>3,f=Q(g,17)^Q(g,19)^g>>>10;pt[p]=f+pt[p-7]+x+pt[p-16]|0}let{A:i,B:a,C:s,D:o,E:r,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let m=Q(r,6)^Q(r,11)^Q(r,25),g=d+m+bi(r,c,l)+yi[p]+pt[p]|0,f=(Q(i,2)^Q(i,13)^Q(i,22))+wi(i,a,s)|0;d=l,l=c,c=r,r=o+g|0,o=s,s=a,a=i,i=g+f|0}i=i+this.A|0,a=a+this.B|0,s=s+this.C|0,o=o+this.D|0,r=r+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,a,s,o,r,c,l,d)}roundClean(){pt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var te=kn(()=>new Ie);var ze={};hi(ze,{bitGet:()=>Ai,bitLen:()=>ji,bitMask:()=>Dt,bitSet:()=>Ii,bytesToHex:()=>vt,bytesToNumberBE:()=>N,bytesToNumberLE:()=>ie,concatBytes:()=>nt,createHmacDrbg:()=>Ce,ensureBytes:()=>O,equalBytes:()=>Si,hexToBytes:()=>bt,hexToNumber:()=>qe,numberToBytesBE:()=>X,numberToBytesLE:()=>oe,numberToHexUnpadded:()=>Sn,numberToVarBytesBE:()=>Bi,utf8ToBytes:()=>Ti,validateObject:()=>dt});var Bn=BigInt(0),ee=BigInt(1),ki=BigInt(2),ne=e=>e instanceof Uint8Array,Ei=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function vt(e){if(!ne(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ei[e[n]];return t}function Sn(e){let t=e.toString(16);return t.length&1?`0${t}`:t}function qe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function bt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(t/2);for(let i=0;i<n.length;i++){let a=i*2,s=e.slice(a,a+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[i]=o}return n}function N(e){return qe(vt(e))}function ie(e){if(!ne(e))throw new Error("Uint8Array expected");return qe(vt(Uint8Array.from(e).reverse()))}function X(e,t){return bt(e.toString(16).padStart(t*2,"0"))}function oe(e,t){return X(e,t).reverse()}function Bi(e){return bt(Sn(e))}function O(e,t,n){let i;if(typeof t=="string")try{i=bt(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(ne(t))i=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let a=i.length;if(typeof n=="number"&&a!==n)throw new Error(`${e} expected ${n} bytes, got ${a}`);return i}function nt(...e){let t=new Uint8Array(e.reduce((i,a)=>i+a.length,0)),n=0;return e.forEach(i=>{if(!ne(i))throw new Error("Uint8Array expected");t.set(i,n),n+=i.length}),t}function Si(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ti(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ji(e){let t;for(t=0;e>Bn;e>>=ee,t+=1);return t}function Ai(e,t){return e>>BigInt(t)&ee}var Ii=(e,t,n)=>e|(n?ee:Bn)<<BigInt(t),Dt=e=>(ki<<BigInt(e-1))-ee,Re=e=>new Uint8Array(e),En=e=>Uint8Array.from(e);function Ce(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=Re(e),a=Re(e),s=0,o=()=>{i.fill(1),a.fill(0),s=0},r=(...p)=>n(a,i,...p),c=(p=Re())=>{a=r(En([0]),p),i=r(),p.length!==0&&(a=r(En([1]),p),i=r())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,m=[];for(;p<t;){i=r();let g=i.slice();m.push(g),p+=i.length}return nt(...m)};return(p,m)=>{o(),c(p);let g;for(;!(g=m(l()));)c();return o(),g}}var Ri={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function dt(e,t,n={}){let i=(a,s,o)=>{let r=Ri[s];if(typeof r!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=e[a];if(!(o&&c===void 0)&&!r(c,e))throw new Error(`Invalid param ${String(a)}=${c} (${typeof c}), expected ${s}`)};for(let[a,s]of Object.entries(t))i(a,s,!1);for(let[a,s]of Object.entries(n))i(a,s,!0);return e}var _=BigInt(0),z=BigInt(1),wt=BigInt(2),qi=BigInt(3),Oe=BigInt(4),Tn=BigInt(5),jn=BigInt(8),Ci=BigInt(9),zi=BigInt(16);function P(e,t){let n=e%t;return n>=_?n:t+n}function Oi(e,t,n){if(n<=_||t<_)throw new Error("Expected power/modulo > 0");if(n===z)return _;let i=z;for(;t>_;)t&z&&(i=i*e%n),e=e*e%n,t>>=z;return i}function M(e,t,n){let i=e;for(;t-- >_;)i*=i,i%=n;return i}function ae(e,t){if(e===_||t<=_)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=P(e,t),i=t,a=_,s=z,o=z,r=_;for(;n!==_;){let l=i/n,d=i%n,p=a-o*l,m=s-r*l;i=n,n=d,a=o,s=r,o=p,r=m}if(i!==z)throw new Error("invert: does not exist");return P(a,t)}function Pi(e){let t=(e-z)/wt,n,i,a;for(n=e-z,i=0;n%wt===_;n/=wt,i++);for(a=wt;a<e&&Oi(a,t,e)!==e-z;a++);if(i===1){let o=(e+z)/Oe;return function(c,l){let d=c.pow(l,o);if(!c.eql(c.sqr(d),l))throw new Error("Cannot find square root");return d}}let s=(n+z)/wt;return function(r,c){if(r.pow(c,t)===r.neg(r.ONE))throw new Error("Cannot find square root");let l=i,d=r.pow(r.mul(r.ONE,a),n),p=r.pow(c,s),m=r.pow(c,n);for(;!r.eql(m,r.ONE);){if(r.eql(m,r.ZERO))return r.ZERO;let g=1;for(let f=r.sqr(m);g<l&&!r.eql(f,r.ONE);g++)f=r.sqr(f);let x=r.pow(d,z<<BigInt(l-g-1));d=r.sqr(x),p=r.mul(p,x),m=r.mul(m,d),l=g}return p}}function _i(e){if(e%Oe===qi){let t=(e+z)/Oe;return function(i,a){let s=i.pow(a,t);if(!i.eql(i.sqr(s),a))throw new Error("Cannot find square root");return s}}if(e%jn===Tn){let t=(e-Tn)/jn;return function(i,a){let s=i.mul(a,wt),o=i.pow(s,t),r=i.mul(a,o),c=i.mul(i.mul(r,wt),o),l=i.mul(r,i.sub(c,i.ONE));if(!i.eql(i.sqr(l),a))throw new Error("Cannot find square root");return l}}return e%zi,Pi(e)}var Li=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pe(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Li.reduce((i,a)=>(i[a]="function",i),t);return dt(e,n)}function Ni(e,t,n){if(n<_)throw new Error("Expected power > 0");if(n===_)return e.ONE;if(n===z)return t;let i=e.ONE,a=t;for(;n>_;)n&z&&(i=e.mul(i,a)),a=e.sqr(a),n>>=z;return i}function Hi(e,t){let n=new Array(t.length),i=t.reduce((s,o,r)=>e.is0(o)?s:(n[r]=s,e.mul(s,o)),e.ONE),a=e.inv(i);return t.reduceRight((s,o,r)=>e.is0(o)?s:(n[r]=e.mul(s,n[r]),e.mul(s,o)),a),n}function _e(e,t){let n=t!==void 0?t:e.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function An(e,t,n=!1,i={}){if(e<=_)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:a,nByteLength:s}=_e(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=_i(e),r=Object.freeze({ORDER:e,BITS:a,BYTES:s,MASK:Dt(a),ZERO:_,ONE:z,create:c=>P(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return _<=c&&c<e},is0:c=>c===_,isOdd:c=>(c&z)===z,neg:c=>P(-c,e),eql:(c,l)=>c===l,sqr:c=>P(c*c,e),add:(c,l)=>P(c+l,e),sub:(c,l)=>P(c-l,e),mul:(c,l)=>P(c*l,e),pow:(c,l)=>Ni(r,c,l),div:(c,l)=>P(c*ae(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ae(c,e),sqrt:i.sqrt||(c=>o(r,c)),invertBatch:c=>Hi(r,c),cmov:(c,l,d)=>d?l:c,toBytes:c=>n?oe(c,s):X(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?ie(c):N(c)}});return Object.freeze(r)}function In(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Le(e){let t=In(e);return t+Math.ceil(t/2)}function Rn(e,t,n=!1){let i=e.length,a=In(t),s=Le(t);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);let o=n?N(e):ie(e),r=P(o,t-z)+z;return n?oe(r,a):X(r,a)}var $i=BigInt(0),Ne=BigInt(1);function qn(e,t){let n=(a,s)=>{let o=s.negate();return a?o:s},i=a=>{let s=Math.ceil(t/a)+1,o=2**(a-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(a,s){let o=e.ZERO,r=a;for(;s>$i;)s&Ne&&(o=o.add(r)),r=r.double(),s>>=Ne;return o},precomputeWindow(a,s){let{windows:o,windowSize:r}=i(s),c=[],l=a,d=l;for(let p=0;p<o;p++){d=l,c.push(d);for(let m=1;m<r;m++)d=d.add(l),c.push(d);l=d.double()}return c},wNAF(a,s,o){let{windows:r,windowSize:c}=i(a),l=e.ZERO,d=e.BASE,p=BigInt(2**a-1),m=2**a,g=BigInt(a);for(let x=0;x<r;x++){let f=x*c,u=Number(o&p);o>>=g,u>c&&(u-=m,o+=Ne);let h=f,b=f+Math.abs(u)-1,k=x%2!==0,E=u<0;u===0?d=d.add(n(k,s[h])):l=l.add(n(E,s[b]))}return{p:l,f:d}},wNAFCached(a,s,o,r){let c=a._WINDOW_SIZE||1,l=s.get(a);return l||(l=this.precomputeWindow(a,c),c!==1&&s.set(a,r(l))),this.wNAF(c,l,o)}}}function He(e){return Pe(e.Fp),dt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({..._e(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function Di(e){let t=He(e);dt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:i,a}=t;if(n){if(!i.eql(a,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Mi,hexToBytes:Wi}=ze,yt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=yt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let n=e[1],i=e.subarray(2,n+2);if(!n||i.length!==n)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Mi(i),l:e.subarray(n+2)}},toSig(e){let{Err:t}=yt,n=typeof e=="string"?Wi(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let i=n.length;if(i<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==i-2)throw new t("Invalid signature: incorrect length");let{d:a,l:s}=yt._parseInt(n.subarray(2)),{d:o,l:r}=yt._parseInt(s);if(r.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:o}},hexFromSig(e){let t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let d=l.toString(16);return d.length&1?`0${d}`:d},i=t(n(e.s)),a=t(n(e.r)),s=i.length/2,o=a.length/2,r=n(s),c=n(o);return`30${n(o+s+4)}02${c}${a}02${r}${i}`}},it=BigInt(0),K=BigInt(1),na=BigInt(2),Cn=BigInt(3),ia=BigInt(4);function Vi(e){let t=Di(e),{Fp:n}=t,i=t.toBytes||((x,f,u)=>{let h=f.toAffine();return nt(Uint8Array.from([4]),n.toBytes(h.x),n.toBytes(h.y))}),a=t.fromBytes||(x=>{let f=x.subarray(1),u=n.fromBytes(f.subarray(0,n.BYTES)),h=n.fromBytes(f.subarray(n.BYTES,2*n.BYTES));return{x:u,y:h}});function s(x){let{a:f,b:u}=t,h=n.sqr(x),b=n.mul(h,x);return n.add(n.add(b,n.mul(x,f)),u)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(x){return typeof x=="bigint"&&it<x&&x<t.n}function r(x){if(!o(x))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(x){let{allowedPrivateKeyLengths:f,nByteLength:u,wrapPrivateKey:h,n:b}=t;if(f&&typeof x!="bigint"){if(x instanceof Uint8Array&&(x=vt(x)),typeof x!="string"||!f.includes(x.length))throw new Error("Invalid key");x=x.padStart(u*2,"0")}let k;try{k=typeof x=="bigint"?x:N(O("private key",x,u))}catch{throw new Error(`private key must be ${u} bytes, hex or bigint, not ${typeof x}`)}return h&&(k=P(k,b)),r(k),k}let l=new Map;function d(x){if(!(x instanceof p))throw new Error("ProjectivePoint expected")}class p{constructor(f,u,h){if(this.px=f,this.py=u,this.pz=h,f==null||!n.isValid(f))throw new Error("x required");if(u==null||!n.isValid(u))throw new Error("y required");if(h==null||!n.isValid(h))throw new Error("z required")}static fromAffine(f){let{x:u,y:h}=f||{};if(!f||!n.isValid(u)||!n.isValid(h))throw new Error("invalid affine point");if(f instanceof p)throw new Error("projective point not allowed");let b=k=>n.eql(k,n.ZERO);return b(u)&&b(h)?p.ZERO:new p(u,h,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){let u=n.invertBatch(f.map(h=>h.pz));return f.map((h,b)=>h.toAffine(u[b])).map(p.fromAffine)}static fromHex(f){let u=p.fromAffine(a(O("pointHex",f)));return u.assertValidity(),u}static fromPrivateKey(f){return p.BASE.multiply(c(f))}_setWindowSize(f){this._WINDOW_SIZE=f,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:f,y:u}=this.toAffine();if(!n.isValid(f)||!n.isValid(u))throw new Error("bad point: x or y not FE");let h=n.sqr(u),b=s(f);if(!n.eql(h,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:f}=this.toAffine();if(n.isOdd)return!n.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){d(f);let{px:u,py:h,pz:b}=this,{px:k,py:E,pz:B}=f,y=n.eql(n.mul(u,B),n.mul(k,b)),S=n.eql(n.mul(h,B),n.mul(E,b));return y&&S}negate(){return new p(this.px,n.neg(this.py),this.pz)}double(){let{a:f,b:u}=t,h=n.mul(u,Cn),{px:b,py:k,pz:E}=this,B=n.ZERO,y=n.ZERO,S=n.ZERO,j=n.mul(b,b),W=n.mul(k,k),C=n.mul(E,E),I=n.mul(b,k);return I=n.add(I,I),S=n.mul(b,E),S=n.add(S,S),B=n.mul(f,S),y=n.mul(h,C),y=n.add(B,y),B=n.sub(W,y),y=n.add(W,y),y=n.mul(B,y),B=n.mul(I,B),S=n.mul(h,S),C=n.mul(f,C),I=n.sub(j,C),I=n.mul(f,I),I=n.add(I,S),S=n.add(j,j),j=n.add(S,j),j=n.add(j,C),j=n.mul(j,I),y=n.add(y,j),C=n.mul(k,E),C=n.add(C,C),j=n.mul(C,I),B=n.sub(B,j),S=n.mul(C,W),S=n.add(S,S),S=n.add(S,S),new p(B,y,S)}add(f){d(f);let{px:u,py:h,pz:b}=this,{px:k,py:E,pz:B}=f,y=n.ZERO,S=n.ZERO,j=n.ZERO,W=t.a,C=n.mul(t.b,Cn),I=n.mul(u,k),H=n.mul(h,E),U=n.mul(b,B),at=n.add(u,h),v=n.add(k,E);at=n.mul(at,v),v=n.add(I,H),at=n.sub(at,v),v=n.add(u,b);let w=n.add(k,B);return v=n.mul(v,w),w=n.add(I,U),v=n.sub(v,w),w=n.add(h,b),y=n.add(E,B),w=n.mul(w,y),y=n.add(H,U),w=n.sub(w,y),j=n.mul(W,v),y=n.mul(C,U),j=n.add(y,j),y=n.sub(H,j),j=n.add(H,j),S=n.mul(y,j),H=n.add(I,I),H=n.add(H,I),U=n.mul(W,U),v=n.mul(C,v),H=n.add(H,U),U=n.sub(I,U),U=n.mul(W,U),v=n.add(v,U),I=n.mul(H,v),S=n.add(S,I),I=n.mul(w,v),y=n.mul(at,y),y=n.sub(y,I),I=n.mul(at,H),j=n.mul(w,j),j=n.add(j,I),new p(y,S,j)}subtract(f){return this.add(f.negate())}is0(){return this.equals(p.ZERO)}wNAF(f){return g.wNAFCached(this,l,f,u=>{let h=n.invertBatch(u.map(b=>b.pz));return u.map((b,k)=>b.toAffine(h[k])).map(p.fromAffine)})}multiplyUnsafe(f){let u=p.ZERO;if(f===it)return u;if(r(f),f===K)return this;let{endo:h}=t;if(!h)return g.unsafeLadder(this,f);let{k1neg:b,k1:k,k2neg:E,k2:B}=h.splitScalar(f),y=u,S=u,j=this;for(;k>it||B>it;)k&K&&(y=y.add(j)),B&K&&(S=S.add(j)),j=j.double(),k>>=K,B>>=K;return b&&(y=y.negate()),E&&(S=S.negate()),S=new p(n.mul(S.px,h.beta),S.py,S.pz),y.add(S)}multiply(f){r(f);let u=f,h,b,{endo:k}=t;if(k){let{k1neg:E,k1:B,k2neg:y,k2:S}=k.splitScalar(u),{p:j,f:W}=this.wNAF(B),{p:C,f:I}=this.wNAF(S);j=g.constTimeNegate(E,j),C=g.constTimeNegate(y,C),C=new p(n.mul(C.px,k.beta),C.py,C.pz),h=j.add(C),b=W.add(I)}else{let{p:E,f:B}=this.wNAF(u);h=E,b=B}return p.normalizeZ([h,b])[0]}multiplyAndAddUnsafe(f,u,h){let b=p.BASE,k=(B,y)=>y===it||y===K||!B.equals(b)?B.multiplyUnsafe(y):B.multiply(y),E=k(this,u).add(k(f,h));return E.is0()?void 0:E}toAffine(f){let{px:u,py:h,pz:b}=this,k=this.is0();f==null&&(f=k?n.ONE:n.inv(b));let E=n.mul(u,f),B=n.mul(h,f),y=n.mul(b,f);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(y,n.ONE))throw new Error("invZ was invalid");return{x:E,y:B}}isTorsionFree(){let{h:f,isTorsionFree:u}=t;if(f===K)return!0;if(u)return u(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:f,clearCofactor:u}=t;return f===K?this:u?u(p,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return this.assertValidity(),i(p,this,f)}toHex(f=!0){return vt(this.toRawBytes(f))}}p.BASE=new p(t.Gx,t.Gy,n.ONE),p.ZERO=new p(n.ZERO,n.ONE,n.ZERO);let m=t.nBitLength,g=qn(p,t.endo?Math.ceil(m/2):m);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function Ki(e){let t=He(e);return dt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function zn(e){let t=Ki(e),{Fp:n,n:i}=t,a=n.BYTES+1,s=2*n.BYTES+1;function o(v){return it<v&&v<n.ORDER}function r(v){return P(v,i)}function c(v){return ae(v,i)}let{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:p,isWithinCurveOrder:m}=Vi({...t,toBytes(v,w,T){let q=w.toAffine(),R=n.toBytes(q.x),L=nt;return T?L(Uint8Array.from([w.hasEvenY()?2:3]),R):L(Uint8Array.from([4]),R,n.toBytes(q.y))},fromBytes(v){let w=v.length,T=v[0],q=v.subarray(1);if(w===a&&(T===2||T===3)){let R=N(q);if(!o(R))throw new Error("Point is not on curve");let L=p(R),$=n.sqrt(L),D=($&K)===K;return(T&1)===1!==D&&($=n.neg($)),{x:R,y:$}}else if(w===s&&T===4){let R=n.fromBytes(q.subarray(0,n.BYTES)),L=n.fromBytes(q.subarray(n.BYTES,2*n.BYTES));return{x:R,y:L}}else throw new Error(`Point of length ${w} was invalid. Expected ${a} compressed bytes or ${s} uncompressed bytes`)}}),g=v=>vt(X(v,t.nByteLength));function x(v){let w=i>>K;return v>w}function f(v){return x(v)?r(-v):v}let u=(v,w,T)=>N(v.slice(w,T));class h{constructor(w,T,q){this.r=w,this.s=T,this.recovery=q,this.assertValidity()}static fromCompact(w){let T=t.nByteLength;return w=O("compactSignature",w,T*2),new h(u(w,0,T),u(w,T,2*T))}static fromDER(w){let{r:T,s:q}=yt.toSig(O("DER",w));return new h(T,q)}assertValidity(){if(!m(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!m(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(w){return new h(this.r,this.s,w)}recoverPublicKey(w){let{r:T,s:q,recovery:R}=this,L=S(O("msgHash",w));if(R==null||![0,1,2,3].includes(R))throw new Error("recovery id invalid");let $=R===2||R===3?T+t.n:T;if($>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let D=(R&1)===0?"02":"03",st=l.fromHex(D+g($)),rt=c($),jt=r(-L*rt),Ht=r(q*rt),ct=l.BASE.multiplyAndAddUnsafe(st,jt,Ht);if(!ct)throw new Error("point at infinify");return ct.assertValidity(),ct}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,r(-this.s),this.recovery):this}toDERRawBytes(){return bt(this.toDERHex())}toDERHex(){return yt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return bt(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}let b={isValidPrivateKey(v){try{return d(v),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{let v=Le(t.n);return Rn(t.randomBytes(v),t.n)},precompute(v=8,w=l.BASE){return w._setWindowSize(v),w.multiply(BigInt(3)),w}};function k(v,w=!0){return l.fromPrivateKey(v).toRawBytes(w)}function E(v){let w=v instanceof Uint8Array,T=typeof v=="string",q=(w||T)&&v.length;return w?q===a||q===s:T?q===2*a||q===2*s:v instanceof l}function B(v,w,T=!0){if(E(v))throw new Error("first arg must be private key");if(!E(w))throw new Error("second arg must be public key");return l.fromHex(w).multiply(d(v)).toRawBytes(T)}let y=t.bits2int||function(v){let w=N(v),T=v.length*8-t.nBitLength;return T>0?w>>BigInt(T):w},S=t.bits2int_modN||function(v){return r(y(v))},j=Dt(t.nBitLength);function W(v){if(typeof v!="bigint")throw new Error("bigint expected");if(!(it<=v&&v<j))throw new Error(`bigint expected < 2^${t.nBitLength}`);return X(v,t.nByteLength)}function C(v,w,T=I){if(["recovered","canonical"].some(gt=>gt in T))throw new Error("sign() legacy options not supported");let{hash:q,randomBytes:R}=t,{lowS:L,prehash:$,extraEntropy:D}=T;L==null&&(L=!0),v=O("msgHash",v),$&&(v=O("prehashed msgHash",q(v)));let st=S(v),rt=d(w),jt=[W(rt),W(st)];if(D!=null){let gt=D===!0?R(n.BYTES):D;jt.push(O("extraEntropy",gt))}let Ht=nt(...jt),ct=st;function Se(gt){let At=y(gt);if(!m(At))return;let ln=c(At),tt=l.BASE.multiply(At).toAffine(),It=r(tt.x);if(It===it)return;let Gt=r(ln*r(ct+It*rt));if(Gt===it)return;let pn=(tt.x===It?0:2)|Number(tt.y&K),dn=Gt;return L&&x(Gt)&&(dn=f(Gt),pn^=1),new h(It,dn,pn)}return{seed:Ht,k2sig:Se}}let I={lowS:t.lowS,prehash:!1},H={lowS:t.lowS,prehash:!1};function U(v,w,T=I){let{seed:q,k2sig:R}=C(v,w,T),L=t;return Ce(L.hash.outputLen,L.nByteLength,L.hmac)(q,R)}l.BASE._setWindowSize(8);function at(v,w,T,q=H){let R=v;if(w=O("msgHash",w),T=O("publicKey",T),"strict"in q)throw new Error("options.strict was renamed to lowS");let{lowS:L,prehash:$}=q,D,st;try{if(typeof R=="string"||R instanceof Uint8Array)try{D=h.fromDER(R)}catch(tt){if(!(tt instanceof yt.Err))throw tt;D=h.fromCompact(R)}else if(typeof R=="object"&&typeof R.r=="bigint"&&typeof R.s=="bigint"){let{r:tt,s:It}=R;D=new h(tt,It)}else throw new Error("PARSE");st=l.fromHex(T)}catch(tt){if(tt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&D.hasHighS())return!1;$&&(w=t.hash(w));let{r:rt,s:jt}=D,Ht=S(w),ct=c(jt),Se=r(Ht*ct),gt=r(rt*ct),At=l.BASE.multiplyAndAddUnsafe(st,Se,gt)?.toAffine();return At?r(At.x)===rt:!1}return{CURVE:t,getPublicKey:k,getSharedSecret:B,sign:U,verify:at,ProjectivePoint:l,Signature:h,utils:b}}var se=class extends Ct{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,vn(t);let i=$t(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let a=this.blockLen,s=new Uint8Array(a);s.set(i.length>a?t.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return qt(this),this.iHash.update(t),this}digestInto(t){qt(this),Ae(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:i,finished:a,destroyed:s,blockLen:o,outputLen:r}=this;return t=t,t.finished=a,t.destroyed=s,t.blockLen=o,t.outputLen=r,t.oHash=n._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ue=(e,t,n)=>new se(e,t).update(n).digest();Ue.create=(e,t)=>new se(e,t);function Zi(e){return{hash:e,hmac:(t,...n)=>Ue(e,t,yn(...n)),randomBytes:Jt}}function On(e,t){let n=i=>zn({...e,...Zi(i)});return Object.freeze({...n(t),create:n})}var pe=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),re=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ln=BigInt(1),ce=BigInt(2),Pn=(e,t)=>(e+t/ce)/t;function Nn(e){let t=pe,n=BigInt(3),i=BigInt(6),a=BigInt(11),s=BigInt(22),o=BigInt(23),r=BigInt(44),c=BigInt(88),l=e*e*e%t,d=l*l*e%t,p=M(d,n,t)*d%t,m=M(p,n,t)*d%t,g=M(m,ce,t)*l%t,x=M(g,a,t)*g%t,f=M(x,s,t)*x%t,u=M(f,r,t)*f%t,h=M(u,c,t)*u%t,b=M(h,r,t)*f%t,k=M(b,n,t)*d%t,E=M(k,o,t)*x%t,B=M(E,i,t)*l%t,y=M(B,ce,t);if(!De.eql(De.sqr(y),e))throw new Error("Cannot find square root");return y}var De=An(pe,void 0,void 0,{sqrt:Nn}),Ve=On({a:BigInt(0),b:BigInt(7),Fp:De,n:re,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=re,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Ln*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),r=Pn(s*e,t),c=Pn(-i*e,t),l=P(e-r*n-c*a,t),d=P(-r*i-c*s,t),p=l>o,m=d>o;if(p&&(l=t-l),m&&(d=t-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:p,k1:l,k2neg:m,k2:d}}}},te),de=BigInt(0),Hn=e=>typeof e=="bigint"&&de<e&&e<pe,Gi=e=>typeof e=="bigint"&&de<e&&e<re,_n={};function le(e,...t){let n=_n[e];if(n===void 0){let i=te(Uint8Array.from(e,a=>a.charCodeAt(0)));n=nt(i,i),_n[e]=n}return te(nt(n,...t))}var Ke=e=>e.toRawBytes(!0).slice(1),Me=e=>X(e,32),$e=e=>P(e,pe),Mt=e=>P(e,re),Ze=Ve.ProjectivePoint,Yi=(e,t,n)=>Ze.BASE.multiplyAndAddUnsafe(e,t,n);function We(e){let t=Ve.utils.normPrivateKeyToScalar(e),n=Ze.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Mt(-t),bytes:Ke(n)}}function Un(e){if(!Hn(e))throw new Error("bad x: need 0 < x < p");let t=$e(e*e),n=$e(t*e+BigInt(7)),i=Nn(n);i%ce!==de&&(i=$e(-i));let a=new Ze(e,i,Ln);return a.assertValidity(),a}function $n(...e){return Mt(N(le("BIP0340/challenge",...e)))}function Qi(e){return We(e).bytes}function Xi(e,t,n=Jt(32)){let i=O("message",e),{bytes:a,scalar:s}=We(t),o=O("auxRand",n,32),r=Me(s^N(le("BIP0340/aux",o))),c=le("BIP0340/nonce",r,a,i),l=Mt(N(c));if(l===de)throw new Error("sign failed: k is zero");let{bytes:d,scalar:p}=We(l),m=$n(d,a,i),g=new Uint8Array(64);if(g.set(d,0),g.set(Me(Mt(p+m*s)),32),!Dn(g,i,a))throw new Error("sign: Invalid signature produced");return g}function Dn(e,t,n){let i=O("signature",e,64),a=O("message",t),s=O("publicKey",n,32);try{let o=Un(N(s)),r=N(i.subarray(0,32));if(!Hn(r))return!1;let c=N(i.subarray(32,64));if(!Gi(c))return!1;let l=$n(Me(r),Ke(o),a),d=Yi(o,c,Mt(-l));return!(!d||!d.hasEvenY()||d.toAffine().x!==r)}catch{return!1}}var zt={getPublicKey:Qi,sign:Xi,verify:Dn,utils:{randomPrivateKey:Ve.utils.randomPrivateKey,lift_x:Un,pointToBytes:Ke,numberToBytesBE:X,bytesToNumberBE:N,taggedHash:le,mod:P}};var Ji=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Mn=e=>e instanceof Uint8Array;var ue=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),J=(e,t)=>e<<32-t|e>>>t,Fi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Fi)throw new Error("Non little-endian hardware is not supported");var to=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Wt(e){if(!Mn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=to[e[n]];return t}function eo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ge(e){if(typeof e=="string"&&(e=eo(e)),!Mn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}var fe=class{clone(){return this._cloneInto()}};function Ye(e){let t=i=>e().update(Ge(i)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Qe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function no(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Wn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function io(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Qe(e.outputLen),Qe(e.blockLen)}function oo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ao(e,t){Wn(e);let n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var so={number:Qe,bool:no,bytes:Wn,hash:io,exists:oo,output:ao},me=so;function ro(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);let a=BigInt(32),s=BigInt(4294967295),o=Number(n>>a&s),r=Number(n&s),c=i?4:0,l=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+l,r,i)}var he=class extends fe{constructor(t,n,i,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ue(this.buffer)}update(t){me.exists(this);let{view:n,buffer:i,blockLen:a}=this;t=Ge(t);let s=t.length;for(let o=0;o<s;){let r=Math.min(a-this.pos,s-o);if(r===a){let c=ue(t);for(;a<=s-o;o+=a)this.process(c,o);continue}i.set(t.subarray(o,o+r),this.pos),this.pos+=r,o+=r,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){me.exists(this),me.output(t,this),this.finished=!0;let{buffer:n,view:i,blockLen:a,isLE:s}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>a-o&&(this.process(i,0),o=0);for(let p=o;p<a;p++)n[p]=0;ro(i,a-8,BigInt(this.length*8),s),this.process(i,0);let r=ue(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)r.setUint32(4*p,d[p],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:i,length:a,finished:s,destroyed:o,pos:r}=this;return t.length=a,t.pos=r,t.finished=s,t.destroyed=o,a%n&&t.buffer.set(i),t}};var co=(e,t,n)=>e&t^~e&n,lo=(e,t,n)=>e&t^e&n^t&n,po=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ft=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64),xe=class extends he{constructor(){super(64,32,8,!1),this.A=ft[0]|0,this.B=ft[1]|0,this.C=ft[2]|0,this.D=ft[3]|0,this.E=ft[4]|0,this.F=ft[5]|0,this.G=ft[6]|0,this.H=ft[7]|0}get(){let{A:t,B:n,C:i,D:a,E:s,F:o,G:r,H:c}=this;return[t,n,i,a,s,o,r,c]}set(t,n,i,a,s,o,r,c){this.A=t|0,this.B=n|0,this.C=i|0,this.D=a|0,this.E=s|0,this.F=o|0,this.G=r|0,this.H=c|0}process(t,n){for(let p=0;p<16;p++,n+=4)ut[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){let m=ut[p-15],g=ut[p-2],x=J(m,7)^J(m,18)^m>>>3,f=J(g,17)^J(g,19)^g>>>10;ut[p]=f+ut[p-7]+x+ut[p-16]|0}let{A:i,B:a,C:s,D:o,E:r,F:c,G:l,H:d}=this;for(let p=0;p<64;p++){let m=J(r,6)^J(r,11)^J(r,25),g=d+m+co(r,c,l)+po[p]+ut[p]|0,f=(J(i,2)^J(i,13)^J(i,22))+lo(i,a,s)|0;d=l,l=c,c=r,r=o+g|0,o=s,s=a,a=i,i=g+f|0}i=i+this.A|0,a=a+this.B|0,s=s+this.C|0,o=o+this.D|0,r=r+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(i,a,s,o,r,c,l,d)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Xe=class extends xe{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Vn=Ye(()=>new xe),ja=Ye(()=>new Xe);var Ot=Symbol("verified"),fo=e=>e instanceof Object;function uo(e){if(!fo(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let i=0;i<n.length;i++)if(typeof n[i]!="string")return!1}return!0}var Pa=new TextDecoder("utf-8"),mo=new TextEncoder;function ho(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}var xo=class{value;next=null;prev=null;constructor(e){this.value=e}},go=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){let t=new xo(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){let t=this.first;return this.first=null,this.last=null,t.value}let e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},vo=class{generateSecretKey(){return zt.utils.randomPrivateKey()}getPublicKey(e){return Wt(zt.getPublicKey(e))}finalizeEvent(e,t){let n=e;return n.pubkey=Wt(zt.getPublicKey(t)),n.id=Je(n),n.sig=Wt(zt.sign(Je(n),t)),n[Ot]=!0,n}verifyEvent(e){if(typeof e[Ot]=="boolean")return e[Ot];let t=Je(e);if(t!==e.id)return e[Ot]=!1,!1;try{let n=zt.verify(e.sig,t,e.pubkey);return e[Ot]=n,n}catch{return e[Ot]=!1,!1}}};function bo(e){if(!uo(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Je(e){let t=Vn(mo.encode(bo(e)));return Wt(t)}var ge=new vo,_a=ge.generateSecretKey,La=ge.getPublicKey,Na=ge.finalizeEvent,wo=ge.verifyEvent,yo=22242;function ko(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let i=n.slice(1),a=e[`#${i}`];if(a&&!t.tags.find(([s,o])=>s===n.slice(1)&&a.indexOf(o)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function Eo(e,t){for(let n=0;n<e.length;n++)if(ko(e[n],t))return!0;return!1}function Bo(e,t){let n=t.length+3,i=e.indexOf(`"${t}":`)+n,a=e.slice(i).indexOf('"')+i+1;return e.slice(a,a+64)}function So(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let i=t+7+1+n,a=e.slice(i+1,80).indexOf('"');if(a===-1)return null;let s=i+1+a;return e.slice(i+1,s)}function To(e,t){return{kind:yo,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function jo(){return new Promise(e=>{let t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var Kn=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Zn=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=2e4;pingTimeout=2e4;openSubs=new Map;enablePing;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new go;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=ho(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing}static async connect(e,t){let n=new Zn(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,this.enablePing&&this.pingpong(),e()},this.ws.onerror=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=n=>{clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket closed"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async waitForPingPong(){return new Promise((e,t)=>{this.ws&&this.ws.on&&this.ws.on("pong",()=>e(!0))||t("ws can't listen for pong"),this.ws&&this.ws.ping&&this.ws.ping()})}async waitForDummyReq(){return new Promise((e,t)=>{let n=this.subscribe([{ids:["a".repeat(64)]}],{oneose:()=>{n.close(),e(!0)},eoseTimeout:this.pingTimeout+1e3})})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.on?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])?setTimeout(()=>this.pingpong(),this.pingFrequency):(this.closeAllSubscriptions("pingpong timed out"),this._connected=!1,this.ws?.close(),this.onclose?.()))}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await jo();this.queueRunning=!1}handleNext(){let e=this.incomingMessageQueue.dequeue();if(!e)return!1;let t=So(e);if(t){let n=this.openSubs.get(t);if(!n)return;let i=Bo(e,"id"),a=n.alreadyHaveEvent?.(i);if(n.receivedEvent?.(this,i),a)return}try{let n=JSON.parse(e);switch(n[0]){case"EVENT":{let i=this.openSubs.get(n[1]),a=n[2];this.verifyEvent(a)&&Eo(i.filters,a)&&i.onevent(a);return}case"COUNT":{let i=n[1],a=n[2],s=this.openCountRequests.get(i);s&&(s.resolve(a.count),this.openCountRequests.delete(i));return}case"EOSE":{let i=this.openSubs.get(n[1]);if(!i)return;i.receivedEose();return}case"OK":{let i=n[1],a=n[2],s=n[3],o=this.openEventPublishes.get(i);o&&(clearTimeout(o.timeout),a?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(i));return}case"CLOSED":{let i=n[1],a=this.openSubs.get(i);if(!a)return;a.closed=!0,a.close(n[2]);return}case"NOTICE":this.onnotice(n[1]);return;case"AUTH":{this.challenge=n[1];return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Kn(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){let t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,i)=>{try{let a=await e(To(this.url,t)),s=setTimeout(()=>{let o=this.openEventPublishes.get(a.id);o&&(o.reject(new Error("auth timed out")),this.openEventPublishes.delete(a.id))},this.publishTimeout);this.openEventPublishes.set(a.id,{resolve:n,reject:i,timeout:s}),this.send('["AUTH",'+JSON.stringify(a)+"]")}catch(a){console.warn("subscribe auth function failed:",a)}}),this.authPromise)}async publish(e){let t=new Promise((n,i)=>{let a=setTimeout(()=>{let s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:i,timeout:a})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;let n=t?.id||"count:"+this.serial,i=new Promise((a,s)=>{this.openCountRequests.set(n,{resolve:a,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),i}subscribe(e,t){let n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;let n=t.id||(t.label?t.label+":":"sub:")+this.serial,i=new Ao(this,n,e,t);return this.openSubs.set(n,i),i}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close(),this.onclose?.()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Ao=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,i){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=i.alreadyHaveEvent,this.receivedEvent=i.receivedEvent,this.eoseTimeout=i.eoseTimeout||e.baseEoseTimeout,this.oneose=i.oneose,this.onclose=i.onclose,this.onevent=i.onevent||(a=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,a)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof Kn))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},Gn;try{Gn=WebSocket}catch{}var ve=class extends Zn{constructor(e){super(e,{verifyEvent:wo,websocketImplementation:Gn})}static async connect(e){let t=new ve(e);return await t.connect(),t}};function Za(e){try{let t=new URL(e),{protocol:n,hostname:i,pathname:a}=t;return!(n!=="wss:"||i==="localhost"||i.endsWith(".local")||i==="[::1]"||/^(127\.|10\.|192\.168\.)/.test(i)||!i.includes(".")&&!i.startsWith("[")||i.endsWith(".onion")||e.includes("npub1")||e.includes("nprofile")||a.includes("://"))}catch{return!1}}function kt(e){return typeof window>"u"&&e.unref(),e}var Yn=["wss://purplepag.es","wss://user.kindpag.es","wss://relay.nos.social","wss://relay.nostr.band","wss://nostr.land","wss://indexer.coracle.social"];var ht=["wss://relay.44billion.net"],et,mt,Vt,Pt,be,Fe=class{constructor(){V(this,Pt);V(this,et,new Map);V(this,mt,new Map);V(this,Vt,3e4)}async disconnect(t){if(A(this,et).has(t)){let n=A(this,et).get(t);n.ws.readyState<2&&await n.close()?.catch(console.log),A(this,et).delete(t),clearTimeout(A(this,mt).get(t)),A(this,mt).delete(t)}}async disconnectAll(){for(let t of A(this,et).keys())await this.disconnect(t)}async getEvents(t,n,{timeout:i=5e3,callback:a}={}){let s=[],o=n.map(async l=>{let d,p=!1,m=Promise.withResolvers(),g=kt(setTimeout(()=>{p=!0,d?.close(),m.reject(new Error(`timeout: ${l}`))},i));try{d=(await Y(this,Pt,be).call(this,l)).subscribe([t],{onevent:f=>{f.meta={relay:l},s.push(f),a&&a({type:"event",event:f,relay:l})},onclose:f=>{clearTimeout(g),!p&&(a&&f&&a({type:"error",error:f,relay:l}),f?m.reject(f):m.resolve())},oneose:()=>{clearTimeout(g),p=!0,d.close(),m.resolve()}})}catch(x){clearTimeout(g),a&&a({type:"error",error:x,relay:l}),m.reject(x)}return m.promise}),r=await Promise.allSettled(o),c=r.filter(l=>l.status==="rejected");return{result:s,errors:c.map(l=>({reason:l.reason,relay:n[r.indexOf(l)]})),success:s.length>0||r.length!==c.length}}async getEventsAsap(t,n,{timeout:i=5e3,timeoutAfterFirstEose:a=200,callback:s}={}){let o=new Map,r=[],c=[],l=0,d=!1,p=null,m=Promise.withResolvers(),g=()=>{d||(d=!0,clearTimeout(x),p&&clearTimeout(p),o.forEach(u=>u.close()),m.resolve({result:c,errors:r,success:c.length>0||n.length!==r.length}))},x=kt(setTimeout(()=>{g()},i)),f=()=>{l+=1,!d&&l>=n.length&&g()};for(let u of n)Y(this,Pt,be).call(this,u).then(h=>{if(d)return;let b=!1,k=h.subscribe([t],{onevent:E=>{d||(b=!0,E.meta={relay:u},c.push(E),s&&s({type:"event",event:E,relay:u}))},onclose:E=>{if(o.delete(u),E){let B=E instanceof Error?E:new Error(String(E));r.push({reason:B,relay:u}),s&&s({type:"error",error:B,relay:u})}f()},oneose:()=>{k.close(),b&&!p&&!d&&(p=kt(setTimeout(()=>{g()},a)))}});o.set(u,k)}).catch(h=>{r.push({reason:h,relay:u}),s&&s({type:"error",error:h,relay:u}),console.error(`Nostr relay error at ${u}: ${h}`),f()});return m.promise}async*getEventsGenerator(t,n,i={}){let a=[],s=Promise.withResolvers(),o=!1,r=i.callback,c=d=>{a.push(d),r&&r(d),s.resolve(),s=Promise.withResolvers()},l=this.getEvents(t,n,{...i,callback:c}).finally(()=>{o=!0,s.resolve()});for(;!o||a.length>0;)a.length>0?yield a.shift():await s.promise;return await l}async*getEventsAsapGenerator(t,n,i={}){let a=[],s=Promise.withResolvers(),o=!1,r=i.callback,c=d=>{a.push(d),r&&r(d),s.resolve(),s=Promise.withResolvers()},l=this.getEventsAsap(t,n,{...i,callback:c}).finally(()=>{o=!0,s.resolve()});for(;!o||a.length>0;)a.length>0?yield a.shift():await s.promise;return await l}async sendEvent(t,n,i=3e3){let a=t.meta?{...t}:t;a.meta&&delete a.meta;let s=n.map(async c=>{let l,d=Promise.withResolvers();try{l=kt(setTimeout(()=>{d.reject(new Error(`timeout: ${c}`))},i)),await(await Y(this,Pt,be).call(this,c)).publish(a),d.resolve()}catch(p){if(p.message?.startsWith("duplicate:"))return d.resolve();if(p.message?.startsWith("mute:"))return console.info(`${c} - ${p.message}`),d.resolve();d.reject(p)}finally{clearTimeout(l)}return d.promise}),o=await Promise.allSettled(s),r=o.filter(c=>c.status==="rejected");return{result:null,errors:r.map(c=>({reason:c.reason,relay:n[o.indexOf(c)]})),success:o.length!==r.length}}};et=new WeakMap,mt=new WeakMap,Vt=new WeakMap,Pt=new WeakSet,be=async function(t){if(A(this,et).has(t)){clearTimeout(A(this,mt).get(t)),A(this,mt).set(t,kt(setTimeout(()=>this.disconnect(t),A(this,Vt))));let i=A(this,et).get(t);return await i.connect(),i}let n=new ve(t);return A(this,et).set(t,n),await n.connect(),A(this,mt).set(t,kt(setTimeout(()=>this.disconnect(t),A(this,Vt)))),n};var Et=new Fe;async function Qn(e,t){if(!e.pubkey||!e.kind||!e.dTag)throw new Error("Missing args");t??=(await _t(e.pubkey))[e.pubkey];let n=[...new Set([...t.write,...ht])],i=await Et.getEvents({authors:[e.pubkey],kinds:[e.kind],"#d":[e.dTag],limit:1},n);if(!i.success)throw i.errors?.[0]?.reason||new Error("Failed to fetch app bundle events");return(i.result??[]).sort((s,o)=>o.created_at-s.created_at)[0]}async function Xn(e,t){switch(t.code){case"WRITE_RELAYS":{if((e.authors?.length??0)===0&&(t.authors?.length??0)===0)throw new Error("Missing authors");let n=t.authors||e.authors,i=Object.entries(t.userRelays||await _t(n)).map(([r,c])=>[r,c.write]),a={};i.forEach(r=>r[1].forEach(c=>{a[c]??=0,a[c]++}));let s=Object.entries(a).sort(([,r],[,c])=>c-r).map(([r])=>r),o=t.maxRelaysPerUser||2;if(e.authors){let r={},c={};s.forEach(u=>{i.forEach(([h,b])=>{b.includes(u)&&(r[h]??=0,!(++r[h]>o)&&(c[u]??=[],c[u].push(h)))})}),Te(e)&&ht.forEach(u=>{c[u]=e.authors});let l=Object.entries(c).map(([u,h])=>Et.getEventsAsap({...e,authors:h},[u]).then(b=>b.result??[])),p=(await Promise.allSettled(l)).filter(u=>u.status==="fulfilled"&&u.value).flatMap(u=>u.value).sort((u,h)=>h.created_at-u.created_at),m=[],g=new Set,x=new Set,f=u=>{let h;if(u.kind>=1e4&&u.kind<2e4||u.kind===0||u.kind===3?h="":h=u.tags.find(k=>k[0]==="d")?.[1],typeof h=="string")return`${u.kind}:${u.pubkey}:${h}`};for(let u of p){if(e.limit&&m.length===e.limit)break;if(g.has(u.id))continue;let h=f(u);if(h){if(x.has(h))continue;x.add(h)}g.add(u.id),m.push(u)}return m}else{let r=new Set;Te(e)&&ht.forEach(l=>r.add(l)),i.forEach(l=>{let d=0;for(let p of s){if(d===o)break;l[1].includes(p)&&(d++,r.add(p))}});let{result:c}=await Et.getEventsAsap(e,[...r]);return c}}default:throw new Error("Pick a strategy")}}async function _t(e){Array.isArray(e)||(e=[e]);let t=await Et.getEvents({authors:e,kinds:[10002],limit:e.length},Yn);if(!t.success)throw t.errors?.[0]?.reason||new Error("Failed to fetch relay lists");let n=t.result??[],i={},a={read:!0,write:!0},s=Object.keys(a),o,r=e.reduce((l,d)=>({...l,[d]:{read:new Set,write:new Set}}),{}),c=n.sort((l,d)=>d.created_at-l.created_at).filter(l=>(!i[l.pubkey]&&e.includes(l.pubkey)&&(i[l.pubkey]=!0),i[l.pubkey])).reduce((l,d)=>((d.tags??[]).filter(p=>p[0]==="r"&&/^wss?:\/\//.test(p[1])).forEach(p=>{o=[p[2]].filter(m=>a[m]),o.length===0&&(o=s),o.forEach(m=>l[d.pubkey][m].add(p[1]))}),l),r);for(let l in c)s.forEach(d=>{c[l][d]=[...c[l][d]]});return c}var Io=(e=>async()=>e??=await Ro())(),Ro=()=>{let e=Promise.withResolvers(),t=indexedDB.open("44billion_browser",1);return t.onerror=()=>e.reject(t.error),t.onsuccess=()=>{let n=t.result;n.onversionchange=()=>{n.close(),location.reload(!0)},n.onerror=()=>{console.log(`[${n.name}DB v${n.version}] IndexedDB error. Code: ${t.errorCode} - ${t.error.stack}`)},e.resolve(n)},t.onupgradeneeded=n=>{let i=n.target.result,a=n.target.transaction,s;i.objectStoreNames.contains("fileChunks")?s=a.objectStore("fileChunks"):s=i.createObjectStore("fileChunks",{keyPath:["appId","fx","pos"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("bundles")?s=a.objectStore("bundles"):s=i.createObjectStore("bundles",{keyPath:["c","p","d"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`),i.objectStoreNames.contains("permissions")?s=a.objectStore("permissions"):s=i.createObjectStore("permissions",{keyPath:["appId","name","eKind"]}),console.log(`[${i.name}DB v${i.version}] ${s.name} store is ready`)},e.promise};async function F(e,t=[],n,i,{p:a=Promise.withResolvers(),tx:s,txMode:o=s?.mode,storeOrIndex:r}={}){if(!s){let l=await Io();o??=["get","getKey","count"].includes(e)?"readonly":"readwrite",s=l.transaction([n],o)}if(!r){let l=s.objectStore(n);r=i?l.index(i):l}let c=r[e](...t);return c.onsuccess=()=>{a.resolve({result:c.result,tx:s,storeOrIndex:r})},c.onerror=()=>{a.reject(c.error),s.abort()},a.promise}async function Jn(e){let t=je(e);return F("get",[t],"bundles").then(n=>n.result&&Co(n.result))}async function Fn(e){let t=je(e);return F("delete",[t],"bundles")}async function we(e,t){let n=qo(e,t);return F("put",[n],"bundles")}function qo(e,{hasUpdate:t=!1,lastOpenedAsSingleNappAt:n=0}={}){let i=e.tags.find(l=>l[0]==="d")?.[1]??"";if(!mn(i))throw new Error("Invalid d tag");let{kind:a,pubkey:s,meta:o,...r}=e,c={37448:"a",37449:"b",37450:"c"}[a];if(!c)throw new Error("Invalid kind");return{c,p:un(s),d:i,u:t,s:n,evt:r}}function Co(e){let t={a:37448,b:37449,c:37450}[e.c];if(!t)throw new Error("Invalid channel");return{kind:t,pubkey:fn(e.p),...e.evt,meta:{hasUpdate:e.u,lastOpenedAsSingleNappAt:e.s}}}async function tn(e,t){let n=await Jn(e);return n||(n=await Qn(t),n&&await we(n),n)}async function ye(e,t){let n=null;for await(let a of ke(e,t)){let s=a.evt.tags.find(r=>r[0]==="c"&&r[1].startsWith(`${t}:`));if(!s)continue;let o=parseInt(s[2]);if(!Number.isNaN(o)&&o>0){n=o;break}}if(!n)return{count:0,total:n};let i=IDBKeyRange.bound([e,t,-1/0],[e,t,1/0]);return F("count",[i],"fileChunks").then(a=>({count:a.result,total:n}))}async function ms(e,t,{signal:n}={}){let i=new Set(t),a=Promise.withResolvers(),s=IDBKeyRange.bound([e,"\0",-1/0],[e,"\uFFFF",1/0]);F("openCursor",[s],"fileChunks",null,{p:a});let o=d=>{let[,p]=d.key;return[e,p,1/0]},r,c,l;for(;(l=await a.promise)&&(r=l.result);){if(n?.aborted){l.tx.abort();break}i.has(r.value.fx)?c=o(r):r.delete(),Object.assign(a,Promise.withResolvers()),r.continue(c),c&&(c=void 0)}}async function ti(e,t){if(!e)throw new Error("Missing bundle id");let n=IDBKeyRange.bound([e,t??"\0",-1/0],[e,t??"\uFFFF",1/0]);return F("delete",[n],"fileChunks").then(i=>i.result)}async function ei(e,t,{fromPos:n,toPos:i,justKeys:a=!1}={}){let s=n!==void 0?n:-1/0,o=i!==void 0?i:1/0,r=IDBKeyRange.bound([e,t,s],[e,t,o]);return F(a?"getAllKeys":"getAll",[r],"fileChunks").then(c=>c.result)}async function*ke(e,t,{fromPos:n,toPos:i,justKeys:a=!1}={}){let s=n!==void 0?n:-1/0,o=i!==void 0?i:1/0,r=IDBKeyRange.bound([e,t,s],[e,t,o]),c=Promise.withResolvers();await F(a?"openKeyCursor":"openCursor",[r],"fileChunks",null,{p:c});let l=a?"key":"value",d;for(;d=(await c.promise).result;)yield d[l],Object.assign(c,Promise.withResolvers()),d.continue()}async function ni(e,t,n){let i=e.tags.filter(s=>s[0]==="file"&&!!s[1]).map(s=>s[1]).reduce((s,o)=>({...s,[o]:!0}),{}),a;for(let s of t){if(s.kind!==34600)throw new Error("Wrong chunk kind");let o,r=[];for(let c of s.tags)if(c[0]==="d"&&(o=c),c[0]==="c"){let[l,d]=c[1].split(":");d!==void 0&&i[l]&&r.push([l,parseInt(d)])}n??=hn({kind:e.kind,pubkey:e.pubkey,dTag:e.tags.find(c=>c[0]==="d")[1]});for(let[c,l]of r){let d={appId:n,x:o[1],fx:c,pos:l,evt:s};a=await F("put",[d],"fileChunks",null,a)}}}var en=new Map,Kt=class{constructor(t,n,i){if(!i||i.length===0)throw new Error("Write relays cannot be empty");this.appId=t,this.fileRootHash=n,this.writeRelays=[...new Set([...i,...ht])],this.sharedKey=`${t}:${n}`}static async getBundleEvents(t,{_getUserRelays:n=_t,_getEventsByStrategy:i=Xn}={}){if(!t||t.length===0)return{};let a={},s={};for(let p of t){let m=Ut(p);s[p]=m,a[m.pubkey]||(a[m.pubkey]=[]),a[m.pubkey].push(m)}let o=Object.keys(a),r=await n(o),c={kinds:[],authors:o,"#d":[],until:Math.floor(Date.now()/1e3)};for(let p of t){let m=s[p];c.kinds.includes(m.kind)||c.kinds.push(m.kind),c["#d"].includes(m.dTag)||c["#d"].push(m.dTag)}let l=await i(c,{code:"WRITE_RELAYS",maxRelaysPerUser:7,userRelays:r}),d={};for(let p of t){let m=s[p],g=l.find(x=>x.kind===m.kind&&x.pubkey===m.pubkey&&x.tags.find(f=>f[0]==="d")?.[1]===m.dTag);g&&(d[p]={event:g,writeRelays:Array.from(r[m.pubkey]?.write||[])})}return d}async*run({_nostrRelays:t=Et,_countFileChunksFromDb:n=ye,_getFileChunksFromDb:i=ei,_saveFileChunksToDB:a=ni}={}){let s={_nostrRelays:t,_countFileChunksFromDb:n,_getFileChunksFromDb:i,_saveFileChunksToDB:a},o=en.get(this.sharedKey);o||(o={total:null,downloaded:new Set,fetching:new Map,missingByRelay:new Map,error:null,instances:0,initPromise:null,queue:[],relayBackoffs:new Map,resolvers:new Set,workersStarted:!1,version:0,stopped:!1,queuePopulatedIndex:0,chunkLog:[]},o.initPromise=this._initState(o,s).then(()=>{r()}),en.set(this.sharedKey,o)),o.instances++,r();function r(){o.version++;let d=Array.from(o.resolvers);o.resolvers.clear(),d.forEach(p=>p())}function c(d){if(o.version!==d)return Promise.resolve();let{promise:p,resolve:m}=Promise.withResolvers();return o.resolvers.add(m),p}let l=d=>{if(d.length===0)return[];let p=[...d].sort((f,u)=>f-u),m=[],g=p[0],x=p[0];for(let f=1;f<p.length;f++)p[f]!==x&&(p[f]===x+1?x=p[f]:(m.push([g,x]),g=x=p[f]));return m.push([g,x]),m};try{await o.initPromise;let d=0,p=()=>{let m=o.total?Math.floor(o.downloaded.size/o.total*100):0,g=o.chunkLog.slice(d);return d=o.chunkLog.length,{progress:m,error:o.error,newlyCachedChunkIndexRanges:l(g)}};if(!o.workersStarted){o.workersStarted=!0;let m=20,g=()=>{if(o.total===null)!o.downloaded.has(0)&&!o.fetching.has(0)&&!o.queue.includes(0)&&o.queue.push(0);else if(o.queuePopulatedIndex<o.total){for(let x=o.queuePopulatedIndex;x<o.total;x++)x===0&&(o.downloaded.has(0)||o.fetching.has(0)||o.queue.includes(0))||o.downloaded.has(x)||o.queue.push(x);o.queuePopulatedIndex=o.total}};this.writeRelays.forEach(x=>{(async()=>{try{for(;;){let f=o.version;if(o.error||o.stopped||o.total!==null&&o.downloaded.size>=o.total)break;g();let u=[];for(let h=0;h<o.queue.length&&u.length<m;h++){let b=o.queue[h];o.missingByRelay.get(x)?.has(b)||(u.push(b),o.queue.splice(h,1),h--,o.fetching.has(b)||o.fetching.set(b,new Set),o.fetching.get(b).add(x))}if(u.length<m)for(let h of o.fetching.keys()){if(u.length>=m)break;o.downloaded.has(h)||u.includes(h)||o.missingByRelay.get(x)?.has(h)||(u.push(h),o.fetching.get(h).add(x))}if(u.length===0){if(o.total!==null&&o.downloaded.size>=o.total||o.stopped)break;await c(f);continue}try{let h=await this._fetchFromRelay(x,u,o,r,s);o.relayBackoffs.set(x,1e3);for(let b of u)!h.has(b)&&!o.downloaded.has(b)&&(o.queue.includes(b)||o.queue.unshift(b));r()}catch(h){console.error(`Worker error at ${x}:`,h);for(let E of u){let B=o.fetching.get(E);B&&(B.delete(x),B.size===0&&o.fetching.delete(E)),!o.downloaded.has(E)&&!o.queue.includes(E)&&o.queue.unshift(E)}r();let b=o.relayBackoffs.get(x)||1e3,k=Math.min(b*2,3e4);o.relayBackoffs.set(x,k),await new Promise(E=>setTimeout(E,b))}}}finally{r()}})()})}for(yield p();;){let m=o.version;if(o.error){yield p();return}if(o.total!==null&&o.downloaded.size>=o.total){yield{progress:100,error:null};return}if(o.total!==null&&o.downloaded.size<o.total&&o.fetching.size===0){let g=[];for(let x=0;x<o.total;x++)o.downloaded.has(x)||g.push(x);if(g.length>0&&!g.some(f=>this.writeRelays.some(u=>!o.missingByRelay.get(u)?.has(f)))){o.error=new Error("Chunks missing from all relays"),r(),yield p();return}}await c(m),yield p()}}finally{o.instances--,o.instances===0&&(o.stopped=!0,r(),en.delete(this.sharedKey))}}async _initState(t,{_countFileChunksFromDb:n,_getFileChunksFromDb:i}){let a=await n(this.appId,this.fileRootHash);a.total&&(t.total=a.total);let s=await i(this.appId,this.fileRootHash,{justKeys:!0}),o=[];for(let r of s)t.downloaded.has(r[2])||(t.downloaded.add(r[2]),o.push(r[2]));o.length>0&&t.chunkLog.push(...o)}async _fetchFromRelay(t,n,i,a,{_nostrRelays:s,_saveFileChunksToDB:o}){let{pubkey:r}=Ut(this.appId),c={kinds:[34600],authors:[r],"#c":n.map(g=>`${this.fileRootHash}:${g}`)},l=s.getEventsGenerator(c,[t]),d=new Set,p={tags:[["file",this.fileRootHash]]},m=null;for await(let g of l)if(g.type==="event"){let x=g.event;await o(p,[x],this.appId);let f=x.tags.find(u=>u[0]==="c"&&u[1].startsWith(`${this.fileRootHash}:`));if(f){let u=f[1].split(":"),h=parseInt(u[1]);d.add(h),i.downloaded.has(h)||(i.downloaded.add(h),i.chunkLog.push(h)),i.total===null&&f[2]&&(i.total=parseInt(f[2])),a&&a()}}else g.type==="error"&&(m=g.error);if(m)throw m;for(let g of n){let x=i.fetching.get(g);x&&(x.delete(t),x.size===0&&i.fetching.delete(g)),d.has(g)||(i.missingByRelay.has(t)||i.missingByRelay.set(t,new Set),i.missingByRelay.get(t).add(g))}return d}};var ii={"application/prs.cww":["cww"],"application/prs.xsf+xml":["xsf"],"application/vnd.1000minds.decision-model+xml":["1km"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["*xfdf"],"application/vnd.age":["age"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.keynote":["key"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.apple.numbers":["numbers"],"application/vnd.apple.pages":["pages"],"application/vnd.apple.pkpass":["pkpass"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.autodesk.fbx":["fbx"],"application/vnd.balsamiq.bmml+xml":["bmml"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.citationstyles.style+xml":["csl"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dbf":["dbf"],"application/vnd.dcmp+xml":["dcmp"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["*fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.slides":["ggs"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-apps.document":["gdoc"],"application/vnd.google-apps.drawing":["gdraw"],"application/vnd.google-apps.form":["gform"],"application/vnd.google-apps.jam":["gjam"],"application/vnd.google-apps.map":["gmap"],"application/vnd.google-apps.presentation":["gslides"],"application/vnd.google-apps.script":["gscript"],"application/vnd.google-apps.site":["gsite"],"application/vnd.google-apps.spreadsheet":["gsheet"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.gov.sk.xmldatacontainer+xml":["xdcf"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.hydrostatix.sof-data":["sfd-hdstx"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mapbox-vector-tile":["mvt"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-outlook":["msg"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["*stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["*mpp","mpt"],"application/vnd.ms-visio.viewer":["vdx"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.nato.bindingdataobject+xml":["bdo"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.ac+xml":["*ac"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.n-gage.symbian.install":["n-gage"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openblox.game+xml":["obgx"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openstreetmap.data+xml":["osm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.procrate.brushset":["brushset"],"application/vnd.procreate.brush":["brush"],"application/vnd.procreate.dream":["drm"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.pwg-xhtml-print+xml":["xhtm"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.rar":["rar"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.software602.filler.form+xml":["fo"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.wadl+xml":["wadl"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.syncml.dmddf+xml":["ddf"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml","uo"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw","vsdx","vtx"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["*dmg"],"application/x-arj":["arj"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bdoc":["*bdoc"],"application/x-bittorrent":["torrent"],"application/x-blender":["blend"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-chrome-extension":["crx"],"application/x-cocoa":["cco"],"application/x-compressed":["*rar"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["*deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-httpd-php":["php"],"application/x-install-instructions":["install"],"application/x-ipynb+json":["ipynb"],"application/x-iso9660-image":["*iso"],"application/x-iwork-keynote-sffkey":["*key"],"application/x-iwork-numbers-sffnumbers":["*numbers"],"application/x-iwork-pages-sffpages":["*pages"],"application/x-java-archive-diff":["jardiff"],"application/x-java-jnlp-file":["jnlp"],"application/x-keepass2":["kdbx"],"application/x-latex":["latex"],"application/x-lua-bytecode":["luac"],"application/x-lzh-compressed":["lzh","lha"],"application/x-makeself":["run"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["*prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdos-program":["*exe"],"application/x-msdownload":["*exe","*dll","com","bat","*msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["*wmf","*wmz","*emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-ns-proxy-autoconfig":["pac"],"application/x-nzb":["nzb"],"application/x-perl":["pl","pm"],"application/x-pilot":["*prc","*pdb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["*rar"],"application/x-redhat-package-manager":["rpm"],"application/x-research-info-systems":["ris"],"application/x-sea":["sea"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["*sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl","tk"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["*obj"],"application/x-ustar":["ustar"],"application/x-virtualbox-hdd":["hdd"],"application/x-virtualbox-ova":["ova"],"application/x-virtualbox-ovf":["ovf"],"application/x-virtualbox-vbox":["vbox"],"application/x-virtualbox-vbox-extpack":["vbox-extpack"],"application/x-virtualbox-vdi":["vdi"],"application/x-virtualbox-vhd":["vhd"],"application/x-virtualbox-vmdk":["vmdk"],"application/x-wais-source":["src"],"application/x-web-app-manifest+json":["webapp"],"application/x-x509-ca-cert":["der","crt","pem"],"application/x-xfig":["fig"],"application/x-xliff+xml":["*xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zip-compressed":["*zip"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/x-aac":["*aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-m4a":["*m4a"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-realaudio":["*ra"],"audio/x-wav":["*wav"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/prs.btif":["btif","btf"],"image/prs.pti":["pti"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.airzip.accelerator.azv":["azv"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dvb.subtitle":["*sub"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.microsoft.icon":["ico"],"image/vnd.ms-dds":["dds"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.pco.b16":["b16"],"image/vnd.tencent.tap":["tap"],"image/vnd.valve.source.texture":["vtf"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/vnd.zbrush.pcx":["pcx"],"image/x-3ds":["3ds"],"image/x-adobe-dng":["dng"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["*ico"],"image/x-jng":["jng"],"image/x-mrsid-image":["sid"],"image/x-ms-bmp":["*bmp"],"image/x-pcx":["*pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/vnd.wfa.wsc":["wsc"],"model/vnd.bary":["bary"],"model/vnd.cld":["cld"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["*mts"],"model/vnd.opengex":["ogex"],"model/vnd.parasolid.transmit.binary":["x_b"],"model/vnd.parasolid.transmit.text":["x_t"],"model/vnd.pytha.pyox":["pyo","pyox"],"model/vnd.sap.vds":["vds"],"model/vnd.usda":["usda"],"model/vnd.usdz+zip":["usdz"],"model/vnd.valve.source.compiled-map":["bsp"],"model/vnd.vtu":["vtu"],"text/prs.lines.tag":["dsc"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.familysearch.gedcom":["ged"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-component":["htc"],"text/x-fortran":["f","for","f77","f90"],"text/x-handlebars-template":["hbs"],"text/x-java-source":["java"],"text/x-lua":["lua"],"text/x-markdown":["mkd"],"text/x-nfo":["nfo"],"text/x-opml":["opml"],"text/x-org":["*org"],"text/x-pascal":["p","pas"],"text/x-processing":["pde"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-suse-ymp":["ymp"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]};Object.freeze(ii);var oi=ii;var ai={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(ai);var si=ai;var Z=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},Lt,Zt,Bt,nn=class{constructor(...t){Lt.set(this,new Map),Zt.set(this,new Map),Bt.set(this,new Map);for(let n of t)this.define(n)}define(t,n=!1){for(let[i,a]of Object.entries(t)){i=i.toLowerCase(),a=a.map(r=>r.toLowerCase()),Z(this,Bt,"f").has(i)||Z(this,Bt,"f").set(i,new Set);let s=Z(this,Bt,"f").get(i),o=!0;for(let r of a){let c=r.startsWith("*");if(r=c?r.slice(1):r,s?.add(r),o&&Z(this,Zt,"f").set(i,r),o=!1,c)continue;let l=Z(this,Lt,"f").get(r);if(l&&l!=i&&!n)throw new Error(`"${i} -> ${r}" conflicts with "${l} -> ${r}". Pass \`force=true\` to override this definition.`);Z(this,Lt,"f").set(r,i)}}return this}getType(t){if(typeof t!="string")return null;let n=t.replace(/^.*[/\\]/s,"").toLowerCase(),i=n.replace(/^.*\./s,"").toLowerCase(),a=n.length<t.length;return!(i.length<n.length-1)&&a?null:Z(this,Lt,"f").get(i)??null}getExtension(t){return typeof t!="string"?null:(t=t?.split?.(";")[0],(t&&Z(this,Zt,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Z(this,Bt,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(let t of Z(this,Bt,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Z(this,Lt,"f"),extensions:Z(this,Zt,"f")}}};Lt=new WeakMap,Zt=new WeakMap,Bt=new WeakMap;var on=nn;var an=new on(si,oi)._freeze();var zo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&'()*+,-./:;<=>?@[]^_`{|}~ ",Oo=(()=>{let e=new Int16Array(128);e.fill(93);for(let t=0;t<93;t++)e[zo.charCodeAt(t)]=t;return e})();function sn(e,t=0,n=-1){let i=t+n;(n<0||i>e.length)&&(i=e.length);let a=new Uint8Array(Math.ceil((i-t)*7/8)),s=0,o=0,r=-1,c=0;for(let l=t;l<i;l++){let d=e.charCodeAt(l);if(d>126)continue;let p=Oo[d];if(p!==93)if(r===-1)r=p;else{let m=r+p*93;for(r=-1,s|=m<<o,o+=(m&8191)>456?13:14;o>7;)a[c++]=s&255,s>>>=8,o-=8}}return r!==-1&&(a[c++]=(s|r<<o)&255),a.subarray(0,c)}async function ci(e,t=!1){let i=e.getCachedMetadata(e.appId,["icon"])?.icon;return t&&i?(ri(e,i),i):i||await ri(e)}async function li(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.name;return t&&(i!==void 0||n?.description!==void 0)?(Ee(e),i):i!==void 0?i:(await Ee(e))?.name?.trim()||null}async function pi(e,t=!1){let n=e.getCachedMetadata(e.appId,["name","description"]),i=n?.description;return t&&(i!==void 0||n?.name!==void 0)?(Ee(e),i):i!==void 0?i:(await Ee(e))?.description?.trim()||null}async function ri(e,t=null){let n=e.getFaviconMetadata();if(!n)return null;if(t&&t.fx===n.rootHash)return t;try{let i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0});i.isCached||(await e.cacheFile(null,n.tag),i=await e.getFileCacheStatus(null,n.tag,{withMeta:!0}));let a=[];for await(let p of ke(e.appId,n.rootHash))a.push(p.evt.content);if(a.length===0)return null;let s=a.map(p=>sn(p)),o=new Blob(s,{type:n.contentType}),r=new FileReader,l=await new Promise((p,m)=>{r.onload=()=>p(r.result),r.onerror=m,r.readAsDataURL(o)}),d={fx:n.rootHash,url:l};return e.cacheMetadata(e.appId,{icon:d}),d}catch(i){return console.log("Failed to fetch icon:",i),null}}async function Ee(e){try{let t=await e.getFileCacheStatus("/",null,{withMeta:!0});t.isCached||await e.cacheFile("/",null);let n=[];for await(let p of ke(e.appId,t.fileRootHash))n.push(p.evt.content);if(n.length===0)return{name:void 0,description:void 0};let i=n.map(p=>sn(p)),a=new Blob(i,{type:t.contentType}),s=new FileReader,r=await new Promise((p,m)=>{s.onload=()=>p(s.result),s.onerror=m,s.readAsText(a)}),{name:c,description:l}=Po(r),d={};return c!==void 0&&(d.name=c),l!==void 0&&(d.description=l),Object.keys(d).length>0&&e.cacheMetadata(e.appId,d),{name:c,description:l}}catch(t){return console.log("Failed to fetch HTML metadata:",t),{name:void 0,description:void 0}}}function Po(e){let t,n;try{let i=/<title[^>]*>([\s\S]*?)<\/title>/i,a=e.match(i);a&&a[1]&&(t=a[1].trim());let s=/<meta\s+[^>]*name\s*=\s*["']description["'][^>]*content\s*=\s*["']([^"']+)["'][^>]*>/i,o=e.match(s);if(o&&o[1]&&(n=o[1].trim()),!n){let r=/<meta\s+[^>]*content\s*=\s*["']([^"']+)["'][^>]*name\s*=\s*["']description["'][^>]*>/i,c=e.match(r);c&&c[1]&&(n=c[1].trim())}}catch(i){console.log("Error parsing HTML metadata:",i)}return{name:t,description:n}}function _o(e,t){if(!e||!t)throw new Error("Missing args");["name","description","icon"].forEach(n=>{let i=t[n];switch(n){case"icon":i=i?.fx&&i?.url&&{fx:i.fx,url:i.url};break;case"description":i=(i?.length??0)>255?`${i.slice(0,252)}...`:i;break;case"name":i=(i?.length??0)>100?`${i.slice(0,97)}...`:i;break}i&&xn(localStorage,`session_appById_${e}_${n}`,i)})}function Lo(e,t=["name","description","icon"]){if(!e)return;let n={};return t.forEach(i=>{let a=localStorage.getItem(`session_appById_${e}_${i}`);if(a){try{a=JSON.parse(a)}catch{console.log(`Error parsing "${i}" metadata from app "${e}"`);return}n[i]=a}}),n}function di(e){return e?/^(?:text\/|application\/json)[^;]*$/.test(e)?`${e}; charset=utf-8`:e:"application/octet-stream"}var fi=Symbol("createToken"),St,G,ui,Nt,Tt,rn,cn,xt,ot,mi,Be=class{constructor(t,n){V(this,G);V(this,Nt);V(this,Tt,{});V(this,xt,!1);V(this,ot,{});if(t!==fi)throw new Error("Use AppFileCacher.create(appAddress) to instantiate this class.");Object.assign(this,n)}static async create(t,n,{cacheMetadata:i=_o,getCachedMetadata:a=Lo}={}){if(A(this,St)[t])return A(this,St)[t];let s=Promise.withResolvers();A(this,St)[t]=s.promise,n??=Ut(t);let o,r;do o=await tn(t,n),o||(r++,console.log("Retrying bundle fetching"),await new Promise(l=>setTimeout(l,Math.pow(2,Math.min(10,r))*1e3)));while(!o&&r<20);o||(delete A(this,St)[t],s.reject(new Error(`Couldn't find bundle after ${r} attempts`)));let c=new this(fi,{appId:t,addressObj:n,bundle:o,cacheMetadata:i,getCachedMetadata:a});return s.resolve(c),s.promise}async getIcon(t=!1){return ci(this,t)}async getName(t=!1){return li(this,t)}async getDescription(t=!1){return pi(this,t)}async clearAppFiles(){await Y(this,G,ui).call(this),await ti(this.appId),await Fn(this.appId)}updateBundleMetadata(t){if(!t)throw new Error("Missing metadata arg");return we(this.bundle,{...this.bundle.meta,...t})}getFaviconMetadata(){if(A(this,Nt))return A(this,Nt);let t,n=this.bundle.tags.find(i=>i[0]==="file"&&/^favicon\.\w{3,}$/.test(i[2])&&(!!i[3]&&i[3].startsWith("image/")&&(t=i[3])||((t=an.getType(i[2]))||"").startsWith("image/")));if(n)return Rt(this,Nt,{rootHash:n[1],filename:n[2],mimeType:t,contentType:di(t),relayHints:[n[4]].filter(Boolean),tag:n})}getFileRootHash(t,n){if(n??=Yt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);return n[1]}async getFileCacheStatus(t,n,{withMeta:i=!1}={}){if(n??=Yt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let a=this.getFileRootHash(null,n),s=await ye(this.appId,a);if(!i)return{isCached:s.count===s.total};let o=n[3]&&n[3].startsWith("image/")?n[3]:an.getType(n[2]);return{...s,isCached:s.count===s.total,mimeType:o,contentType:di(o),isHtml:/^text\/html\b/.test(o),fileRootHash:a,fileTag:n}}async cacheFile(t,n,i,{shouldCacheMissingFiles:a=!navigator.connection?.metered}={}){if(n??=Yt(t,this.bundle.tags),!n)throw new Error(`No matching file tag found for path: ${t}`);let s=n[2],o=Y(this,G,rn).call(this,s);if(i&&(o.subscribers.add(i),o.result!==null&&i(o.result),o.error)){i({error:o.error});return}let r=Promise.withResolvers();return o.subscribers.add(({progress:c,error:l,newlyCachedChunkIndexRanges:d})=>{if(c>=100){if(r.resolve(),!a)return;this.cacheMissingAppFiles(s)}else l&&r.reject(l)}),Y(this,G,mi).call(this,s,n),r.promise}async cacheMissingAppFiles(t){if(!A(this,xt)){Rt(this,xt,!0);try{let n={...t&&{[t]:!0}},i=this.bundle.tags.filter(a=>a[0]!=="file"||!a[1]||!a[2]||n[a[2]]?!1:n[a[2]]=!0);for(let a of i){if(!A(this,xt))break;await this.cacheFile(`/${a[2]}`,a,null,{shouldCacheMissingFiles:!1})}}finally{Rt(this,xt,!1)}}}};St=new WeakMap,G=new WeakSet,ui=async function(){Rt(this,xt,!1);for(let t in A(this,Tt)){let n=A(this,Tt)[t],i=new Error("Cache operation aborted");n.error=i;for(let a of n.subscribers)try{a({error:i})}catch(s){console.log(s)}Y(this,G,cn).call(this,t)}Rt(this,ot,{})},Nt=new WeakMap,Tt=new WeakMap,rn=function(t){if(!t)throw new Error("No filename");return A(this,Tt)[t]??={subscribers:new Set,result:null,error:null}},cn=function(t){delete A(this,Tt)[t]},xt=new WeakMap,ot=new WeakMap,mi=async function(t,n){if(A(this,ot)[t])return;A(this,ot)[t]=!0;let i=Y(this,G,rn).call(this,t);try{let a=await _t([this.bundle.pubkey]),s=Array.from(a[this.bundle.pubkey]?.write||[]);s.length===0&&s.push(...ht);let o=new Kt(this.appId,n[1],s);for await(let c of o.run()){if(!A(this,ot)[t])break;if(c.error)throw c.error;let{progress:l,newlyCachedChunkIndexRanges:d}=c;i.result={progress:l,newlyCachedChunkIndexRanges:d};for(let p of i.subscribers)try{p({progress:l,newlyCachedChunkIndexRanges:d})}catch(m){console.log(m)}}if(!A(this,ot)[t]||i.result?.progress>=100)return;let r=new Error(`File caching incomplete, stopped at ${i.result?.progress??0}%`);i.error=r;for(let c of i.subscribers)try{c({error:r})}catch(l){console.log(l)}}catch(a){i.error=a;for(let s of i.subscribers)try{s({error:a})}catch(o){console.log(o)}}finally{Y(this,G,cn).call(this,t),delete A(this,ot)[t]}},V(Be,St,{});export{F as a,ms as b,ei as c,ke as d,Za as e,Xn as f,_t as g,Jn as h,we as i,Kt as j,sn as k,Be as l};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
