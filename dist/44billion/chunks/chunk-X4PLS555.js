import{a as R,b as A,c as S,d as N,f as O,k as v}from"./chunk-NID4PPA7.js";function P(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function j(e,r){return Array.isArray(r)?r.length===0?!0:e?r.every(t=>typeof t=="string"):r.every(t=>Number.isSafeInteger(t)):!1}function X(e){if(typeof e!="function")throw new Error("function expected");return!0}function g(e,r){if(typeof r!="string")throw new Error(`${e}: string expected`);return!0}function M(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function B(e){if(!Array.isArray(e))throw new Error("array expected")}function W(e,r){if(!j(!0,r))throw new Error(`${e}: array of strings expected`)}function F(e,r){if(!j(!1,r))throw new Error(`${e}: array of numbers expected`)}function Z(...e){let r=n=>n,t=(n,i)=>f=>n(i(f)),c=e.map(n=>n.encode).reduceRight(t,r),o=e.map(n=>n.decode).reduce(t,r);return{encode:c,decode:o}}function z(e){let r=typeof e=="string"?e.split(""):e,t=r.length;W("alphabet",r);let c=new Map(r.map((o,n)=>[o,n]));return{encode:o=>(B(o),o.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${e}`);return r[n]})),decode:o=>(B(o),o.map(n=>{g("alphabet.decode",n);let i=c.get(n);if(i===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return i}))}}function J(e=""){return g("join",e),{encode:r=>(W("join.decode",r),r.join(e)),decode:r=>(g("join.decode",r),r.split(e))}}var G=(e,r)=>r===0?e:G(r,e%r),m=(e,r)=>e+(r-G(e,r)),E=(()=>{let e=[];for(let r=0;r<40;r++)e.push(2**r);return e})();function T(e,r,t,c){if(B(e),r<=0||r>32)throw new Error(`convertRadix2: wrong from=${r}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(m(r,t)>32)throw new Error(`convertRadix2: carry overflow from=${r} to=${t} carryBits=${m(r,t)}`);let o=0,n=0,i=E[r],f=E[t]-1,p=[];for(let l of e){if(M(l),l>=i)throw new Error(`convertRadix2: invalid data word=${l} from=${r}`);if(o=o<<r|l,n+r>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${r}`);for(n+=r;n>=t;n-=t)p.push((o>>n-t&f)>>>0);let b=E[n];if(b===void 0)throw new Error("invalid carry");o&=b-1}if(o=o<<t-n&f,!c&&n>=r)throw new Error("Excess padding");if(!c&&o>0)throw new Error(`Non-zero padding: ${o}`);return c&&n>0&&p.push(o>>>0),p}function Q(e,r=!1){if(M(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(m(8,e)>32||m(e,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!P(t))throw new Error("radix2.encode input should be Uint8Array");return T(Array.from(t),8,e,!r)},decode:t=>(F("radix2.decode",t),Uint8Array.from(T(t,e,8,r)))}}function L(e){return X(e),function(...r){try{return e.apply(null,r)}catch{}}}var $=Z(z("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),J("")),D=[996825010,642813549,513874426,1027748829,705979059];function y(e){let r=e>>25,t=(e&33554431)<<5;for(let c=0;c<D.length;c++)(r>>c&1)===1&&(t^=D[c]);return t}function H(e,r,t=1){let c=e.length,o=1;for(let n=0;n<c;n++){let i=e.charCodeAt(n);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=y(o)^i>>5}o=y(o);for(let n=0;n<c;n++)o=y(o)^e.charCodeAt(n)&31;for(let n of r)o=y(o)^n;for(let n=0;n<6;n++)o=y(o);return o^=t,$.encode(T([o%E[30]],30,5,!1))}function Y(e){let r=e==="bech32"?1:734539939,t=Q(5),c=t.decode,o=t.encode,n=L(c);function i(s,a,d=90){g("bech32.encode prefix",s),P(a)&&(a=Array.from(a)),F("bech32.encode",a);let u=s.length;if(u===0)throw new TypeError(`Invalid prefix length ${u}`);let h=u+7+a.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);let w=s.toLowerCase(),x=H(w,a,r);return`${w}1${$.encode(a)}${x}`}function f(s,a=90){g("bech32.decode input",s);let d=s.length;if(d<8||a!==!1&&d>a)throw new TypeError(`invalid string length: ${d} (${s}). Expected (8..${a})`);let u=s.toLowerCase();if(s!==u&&s!==s.toUpperCase())throw new Error("String must be lowercase or uppercase");let h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');let w=u.slice(0,h),x=u.slice(h+1);if(x.length<6)throw new Error("Data must be at least 6 characters long");let C=$.decode(x).slice(0,-6),I=H(w,C,r);if(!x.endsWith(I))throw new Error(`Invalid checksum in ${s}: expected "${I}"`);return{prefix:w,words:C}}let p=L(f);function l(s){let{prefix:a,words:d}=f(s,!1);return{prefix:a,words:d,bytes:c(d)}}function b(s,a){return i(s,o(a))}return{encode:i,decode:f,encodeFromBytes:b,decodeToBytes:l,decodeUnsafe:p,fromWords:c,fromWordsUnsafe:n,toWords:o}}var k=Y("bech32");var q=5e3,de=new RegExp(`^\\+{1,3}[${S}]{48,${q}}$`),V=new TextEncoder,K=new TextDecoder,_={main:37448,next:37449,draft:37450},ee=Object.fromEntries(Object.entries(_).map(([e,r])=>[r,e])),U={main:"+",next:"++",draft:"+++"},re=Object.fromEntries(Object.entries(U).map(([e,r])=>[r,e]));function fe(e){if(!v(e.dTag))throw new Error("Invalid deduplication tag");let r=e.channel?U[e.channel]&&e.channel:ee[e.kind];if(!r)throw new Error("Wrong channel");let t=ne([[V.encode(e.dTag)],(e.relays||[]).map(n=>V.encode(n)),[A(e.pubkey)]]),c=N(t);return`${U[r]}${c}`}function ue(e){let r=e.match(/^\+*/)[0],t=re[r];if(!t)throw new Error("Invalid channel");let c=e.slice(r.length),o=te(O(c));if(!o[0]?.[0])throw new Error("Missing deduplication tag");if(!o[2]?.[0])throw new Error("Missing author pubkey");if(o[2][0].length!==32)throw new Error("Author pubkey should be 32 bytes");let n=K.decode(o[0][0]);if(!v(n))throw new Error("Invalid deduplication tag");return{dTag:n,pubkey:R(o[2][0]),kind:_[t],channel:t,relays:o[1]?o[1].map(i=>K.decode(i)):[]}}function ne(e){let r=[];return e.map((t,c)=>[c,t]).reverse().forEach(([t,c])=>{c.forEach(o=>{if(o.length>255)throw new Error("Value is too big");let n=new Uint8Array(o.length+2);n.set([t],0),n.set([o.length],1),n.set(o,2),r.push(n)})}),new Uint8Array(r.reduce((t,c)=>[...t,...c]))}function te(e){let r={},t=e,c,o,n;for(;t.length>0;){if(c=t[0],o=t[1],n=t.slice(2,2+o),t=t.slice(2+o),n.length<o)throw new Error(`not enough data to read on TLV ${c}`);r[c]??=[],r[c].push(n)}return r}function he(e){if(typeof e!="string"||!/^[0-9a-f]{64}$/i.test(e))throw new Error("Invalid pubkey hex string");let r=A(e),t=k.toWords(r);return k.encode("npub",t)}export{de as a,fe as b,ue as c,he as d};
/*! Bundled license information:

@scure/base/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
